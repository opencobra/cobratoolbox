<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="MATLAB R2016a"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><title>Convert a reconstruction into a flux balance analysis model </title><style type="text/css">
* {margin: 0; padding: 0;}
body {text-align: start; line-height: 17.2339992523193px; min-height: 0px; white-space: normal; color: rgb(0, 0, 0); font-family: Consolas, Inconsolata, Menlo, monospace; font-style: normal; font-size: 14px; font-weight: normal; text-decoration: none; white-space: normal; }
h1, h2 {font-weight: normal;}
.content { padding: 30px; }

.S0 { margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S1 { line-height: 26.3999996185303px; min-height: 24px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-size: 22px; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 15px; margin-right: 10px;  }
.S2 { min-height: 0px; font-weight: bold; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S3 { line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 15px; margin-bottom: 9px; margin-right: 10px;  }
.S4 { min-height: 0px; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S5 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 2px; margin-bottom: 9px; margin-right: 10px;  }
.S6 { line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 9px; margin-right: 10px;  }
.S7 { margin-left: 3px; margin-top: 10px; margin-bottom: 10px; margin-right: 3px;  }
.S8 { line-height: 15.5926666259766px; min-height: 18px; white-space: nowrap; font-size: 12.6666669845581px; white-space: nowrap; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S9 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S10 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S11 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(0, 0, 255); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S12 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S13 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S14 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(34, 139, 34); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S15 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(0, 0, 255); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S16 { color: rgb(64, 64, 64); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S17 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 10px; margin-bottom: 9px; margin-right: 10px;  }
.S18 { margin-left: 3px; margin-top: 10px; margin-bottom: 4px; margin-right: 3px;  }

.LineNodeBlock {margin: 10px 0 10px 0; background-color: #F7F7F7;}
.LineNodeBlock+.paragraphNode {margin-top: 10px;}
.lineNode {padding-left: 10px; border-left: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.inlineWrapper:first-child .lineNode,.inlineWrapper.outputs+.inlineWrapper .lineNode {padding-top: 5px; border-top: 1px solid #E9E9E9;}
.inlineWrapper:last-child .lineNode,.inlineWrapper.outputs .lineNode {padding-bottom: 5px; border-bottom: 1px solid #E9E9E9;}
.lineNode .textBox {white-space: pre;}
.outputGroup {margin: 2px 0 2px 0; padding: 2px 2px 2px 4px;}
.outputRegion {}
.outputParagraph {color: rgba(64, 64, 64, 1); padding: 10px 0 6px 17px; background: white; overflow-x: hidden;}
.inlineWrapper:last-child .outputParagraph {border-bottom-left-radius: 4px; border-bottom-right-radius: 4px;}
.outputParagraph:empty {margin: 0;}
.inlineElement .symbolicElement {margin-top: 1px; margin-bottom: 1px;}
.embeddedOutputsSymbolicElement .MathEquation {margin-top: 4px; margin-bottom: 4px;}
.embeddedOutputsSymbolicElement .MathEquation.displaySymbolicElement {margin-left: 15px;}
.embeddedOutputsSymbolicElement .MathEquation.inlineSymbolicElement {}
.embeddedOutputsSymbolicElement {overflow-x: auto; overflow-y: hidden;}
.embeddedOutputsSymbolicElement { overflow: initial !important;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {font-family: Consolas, Inconsolata, Menlo, monospace; font-size: 12px; white-space: pre; word-wrap: initial; min-height: 18px; max-height: 250px; overflow: auto;}
.textElement,.rtcDataTipElement .textElement {padding-top: 3px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement { max-height: none !important; overflow: initial !important;}
.veSpecifier {}
.veContainer {}
.veSpecifierBox {height: 400px; width: 500px;}
.veSpecifier .veTable {padding-top: 3px; padding-bottom: 4px;}
.veSpecifierBox .veSpecifier .veContainer {position: relative; width: 100%; height: 370px;}
.veSpecifierBox .dijitDialogPaneContent {width: 97% !important; height: 88% !important;}
.veSpecifier .veTable .rowHeadersWrapper {padding-bottom: 0;}
.veSpecifier .veTable .scroller .variableEditorRenderers {padding-right: 3px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;}
.veSpecifier .veTable .topHeaderWrapper,.veSpecifier .veTable .bottomRowHeaderWrapper {visibility: hidden; z-index: 0;}
.veMetaSummary {font-style: italic;}
.veSpecifier .veTable .scroller {overflow: hidden;}
.veSpecifier .veTable:hover .scroller {overflow: auto;}
.veSpecifier .veVariableName,.veSpecifier .veDimensionFont {font-family: Consolas, Inconsolata, Menlo, monospace; font-size: 12px;}
.veSpecifier .veVariableName {padding-top: 2px;}
.veSpecifier .veDimensionFont {font-style: italic; color: #9A9A9A;}
.veSpecifier .scroller::-webkit-scrollbar-track {background-color: white;}
.veSpecifier .scroller::-webkit-scrollbar-corner {background-color: white;}
.veSpecifier .veTable .topRowHeaderWrapper {border: none; background-color: #F8F9FA;}
.veSpecifier .mw_type_ListBase.showCellBorders,.veSpecifier .veTable .topHeaderWrapper,.veSpecifier .veTable .bottomRowHeaderWrapper,.veSpecifier .veTable .verticalScrollSpacer,.veSpecifier .veTable .horizontalScrollSpacer {border: none;}
.veSpecifier .veTable .dataScrollerNode {border: 1px solid #BFBFBF;}
.veSpecifier .veTable .columnHeaderNode,.veSpecifier .veTable .rowHeaderNode,.veSpecifier .veTable .dataBody {font-family: Arial; font-size: 13px;}
.veSpecifier .veTable .columnHeaderNode,.veSpecifier .veTable .rowHeaderNode {color: #7F7F7F;}
.veSpecifier .veTable .dataBody {color: #000000;}
.veSpecifier .veTable .columnHeaderNode .cell .drag,.veSpecifier .veTable .columnHeaderNode .cell .header,.veSpecifier .veTable .topHeaderWrapper,.veSpecifier .veTable .bottomRowHeaderWrapper {background-color: #F8F9FA;}
.veSpecifier .veTable .columnHeaderNode .cell .dragBorder {border-right: 1px solid #F8F9FA;}
.veSpecifier .veTable .rowHeaderNode .cell {padding-top: 3px; text-align: center; border-bottom: 1px solid #F8F9FA;}
.veSpecifier .veTable .dataBody .cell .plainText {text-align: right;}
.veSpecifier .veTable .dataBody .row .cell {border-bottom: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.embeddedOutputsVariableElement {font-family: Consolas, Inconsolata, Menlo, monospace; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; min-height: 18px; max-height: 250px; overflow: auto;}
.variableElement {}
.embeddedOutputsVariableElement.inlineElement {}
.inlineElement .variableElement {}
.variableNameElement {margin-bottom: 3px; display: inline-block;}
.variableValue { width: 100% !important; }
.embeddedOutputsMatrixElement {min-height: 18px; box-sizing: border-box; font-family: Consolas, Inconsolata, Menlo, monospace; font-size: 12px;}
.embeddedOutputsMatrixElement .matrixElement,.rtcDataTipElement .matrixElement {position: relative;}
.matrixElement .variableValue,.rtcDataTipElement .matrixElement .variableValue {white-space: pre; display: inline-block; vertical-align: top; overflow: hidden;}
.embeddedOutputsMatrixElement.inlineElement {}
.embeddedOutputsMatrixElement.inlineElement .topHeaderWrapper {display: none;}
.embeddedOutputsMatrixElement.inlineElement .veTable .body {padding-top: 0 !important; max-height: 100px;}
.inlineElement .matrixElement {max-height: 300px;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer,.rtcDataTipElement .matrixElement .valueContainer {white-space: nowrap; margin-bottom: 3px;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer .horizontalEllipsis.hide,.embeddedOutputsMatrixElement .matrixElement .verticalEllipsis.hide,.rtcDataTipElement .matrixElement .valueContainer .horizontalEllipsis.hide,.rtcDataTipElement .matrixElement .verticalEllipsis.hide {display: none;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer .horizontalEllipsis {margin-bottom: -3px;}
.matrixElement { max-height: none !important; }
.dijitTooltipDialog .dijitTooltipContainer .dijitTooltipContents .alertPlugin-alertMessage {min-width: 12px; max-width: 400px; max-height: 300px; overflow: auto;}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar {width: 11px; height: 11px;}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-track {background-color: rgba(0, 0, 0, 0);}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-corner {background-color: rgba(0, 0, 0, 0);}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-thumb {border-radius: 7px; background-color: rgba(0, 0, 0, 0.1); border: 2px solid rgba(0, 0, 0, 0); background-clip: padding-box;}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-thumb:hover {background-color: rgba(0, 0, 0, 0.2);}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0);}
.dijitTooltipDialog .alertPlugin-alertMessage:hover::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0.1);}
.dijitTooltipDialog .alertPlugin-alertMessage:hover::-webkit-scrollbar-thumb:hover {background-color: rgba(0, 0, 0, 0.2);}
.alertPlugin-alertLine {position: absolute; display: initial; width: 40px; text-align: right; cursor: text;}
.alertPlugin-onTextLine {visibility: hidden;}
.alertPlugin-hasTooltip .alertPlugin-warningImg,.alertPlugin-hasTooltip .alertPlugin-errorImg {cursor: pointer;}
.alertPlugin-alertLine .alertPlugin-warningElement,.alertPlugin-alertLine .alertPlugin-errorElement {display: inline-block; margin-right: 4px;}
.alertPlugin-isStale {-webkit-filter: opacity(0.4) grayscale(80%); filter: opacity(0.4) grayscale(80%);}
.diagnosticMessage-wrapper {font-family: Consolas, Inconsolata, Menlo, monospace; font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {color: rgb(255,100,0); text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {color: rgb(230,0,0); text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart {white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {white-space: pre;}
.embeddedOutputsWarningElement{min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsErrorElement {min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.variableNameElement .headerElement {color: rgb(179, 179, 179); font-style: italic;}
.variableNameElement .headerElement .headerDataType {color: rgb(147, 176, 230);}
</style></head><body><div class = "content"><div class = 'SectionBlock containment active'><h1 class = "S1"><span class = "S2">Convert a reconstruction into a flux balance analysis model </span></h1><h2 class = "S3"><span class = "S4">Author: Ronan Fleming, Ines Thiele, University of Luxembourg</span></h2><h2 class = "S3"><span class = "S4">Reviewers: </span></h2><h2 class = "S3"><span class = "S4">INTRODUCTION</span></h2><div class = "S5"><span class = "S4">Even with quality control during the reconstruction process, it is not appropriate to assume that any reconstruction can be converted directly into a model and used to make predictions. A model must satisfy certain assumptions before it can be used to make reliable predictions. Depending on the type of model model, these assumptions will be different. Each assumption should be chemically or biologically motivated and expressed in an unambiguous manner and preferably both intuitively and mathematically. Flux balance analysis is a mathematical method widely used for studying genome-scale biochemical network. Here one aims to predict steady-state reaction fluxes, where there is a balance between production and consumption of each molecular species that is not exchanged across the specified boundary of a system. In this situation, one might obtain erroneous predictions if the system boundary is incorrectly specified. If a reconstruction contains one or more supposedly mass balanced reactions, but which are actually not mass balanced, such reactions in a model can lead to inadvertent leakage of a metabolite from the model, in violation of mass balance. Similarly, when generating a model for flux balance analysis, it is important to ensure that the network is flux consistent, that is, each reaction can carry a non-zero steady state flux. </span></div><div class = "S5"><span class = "S4">Given a reconstruction with </span><span style="vertical-align:-5px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAmCAYAAADTGStiAAACR0lEQVRYR+3WSciNURgH8N+HRIoUKWsSycbGQpSQEjYKIUTGhSTTV6ZkSBkWEiHKPGyQTCuKnQU7ZWFhQUJmSdFT59brdYdz9fk+i3vq7d7O/zzP/5xn+J/TpotGWxfxahF3WuRbof7vQz0cJzECy3EeP5vZ9d/keBCOYgK+pm8B7v1L4t7Yi2lYgRc4hpdYhle55M2cONbOwTasxq0U3pE4jkdYj8855M0Q98AqPMXtUk6DPDa1D287mjjHX/aaZk6c7TRnYYu4EqVN2FUI2WxcRB8sSa00EJewBa/T2phbjIUYjAsJj3b7bdQKdTdMxCl8wswkFIfQN3kYk353YDuG4AS6l/Do+834XmSul+Nh6ZQhEuuwIYnFw+R8Z+rbaK34Hyc/iJuIjRfxuXiTSzwuyeAR/MCVkiyGszN4jOc4UAOPjTVFHBIYpDHm42xJNIr40qRexYuigoeqhdJ9yTlxr6RCK3E56fC7gmFP7MGaGnjkOXIfRdqO3bnFFdV5LhXYvHTaom1/nMZUNMIn424u8WhcL1T0k5LhqJTzmI6Kr4V/QLTis1ziWakHb6T8FsMcPqbjKmrhFfuISlwsH3OIo8W2pi8qdWOpBxvhxfxG/0Zb/fE6qdbH/VKFRgjjWROvjeJohA9I+Z+CGbhW7dKoRhwKFFIXeR6P+yXDRngl/0MxFg9yiSfhTnpRVCuMRnhFWIJvURKZEKCGWh29uT9VbVwI70s29fBifitmh7EW33IEpFp0OnSu9RDo0HDWc9YKdaeF+hcX8own8LjcZAAAAABJRU5ErkJggg==" width="15" height="19" /></span><span class = "S4"> reactants involved in </span><span style="vertical-align:-5px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAmCAYAAADAzmuWAAAB30lEQVRIS+3VS6hPURTH8c+VAUlGMmSgRMrAxECUGJoprzCgrldJHpFEKaIwIqIYyKMY3RRSopiZmCkToUiR8o5o1To6Tv9znP//3y3d7q49OWf322t912+tPWCY1sAw6RoV/kN2FEXXKGbiAmZhI67gV5NV2zCegrNYhC+51+F+P8LjcQxLsQkvcQ6vMYg3deJNEce/lTiIbbiV6c/GeTzGbnzqJN4kPBZb8BS3K0xDPC49jnfdCvc1RtoUr6cLRo7wXhwuMViBa5iAtWm9abiOA3hR5VWHYgwW4yI+Yhk+4CRC8BvmpVic2Vq1XRPjGRllNMWujOwGYsfaiaN4hFV4Xo66SXhBtu0ZRAbRwuUZsRqXehGOlg3RWHuyGX6UoiqEg/OGRPXP6TYuhTbjHtbgVaVARYGPYD9+tkExGZezgDEmY7qV10ScygsLx/x1oI7xXAyVHPGkIjw1L44AwjHV/7XP/3Jcxd2s+NuK8BLcwc2M+n0bH0cWYfrYp7EDX7vhG2c7oZiU8zZS7IlvnfD0xBCcF+JBJdqiceZgPh62nccFv3ghouLPavjG5/XZJN/bMN6OEzlgqsYPdPtwqCQUz1Q8XZ/b+LhTdl19GzmDvqu027qib9E6H//fwr8B9DNmJyVpOgkAAAAASUVORK5CYII=" width="11" height="19" /></span><span class = "S4"> reactions, this tutorial demonstrates a method to identify and extract the largest subset of the reconstruction whose internal reactions are both stoichoimetrically and flux consistent and whose external reactions are flux consistent. This model is then mathematically consistent with the basic requirements for generation of predictions using flux balance analysis. The identification of the component of the reconstruction that does not satisfy the aforementioned modelling conditions is also useful for targeting reconstruction effort towards resolving stoichiometric inconsistency or resolving flux inconsistency. The example used in this tutorial illustrates the process of extracting a model consistent with flux balance analsis, from a ReconX reconstruction.</span></div><h2 class = "S3"><span class = "S4">PROCEDURE</span></h2></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">Select reconstruction to convert into a model and enter parameters</span></h2><div class = "S5"><span class = "S4">Load the ReconX reconstruction, and save the original reconstruction in the workspace, unless it is already loaded into the workspace. </span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">clear </span><span class = "S10">model</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">~exist(</span><span class = "S12">'modelOrig'</span><span class = "S9">,</span><span class = "S12">'var'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S14">%select your own model, or use Recon2.0model instead</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        filename=</span><span class = "S10">'Recon3D_301.mat'</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        load(filename);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        model=Recon3D;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">else</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        filename</span><span class = "S9">=</span><span class = "S12">'Recon2.0model.mat'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S9">exist(</span><span class = "S12">'Recon2.0model.mat'</span><span class = "S9">,</span><span class = "S12">'file'</span><span class = "S13">)==2</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            model = readCbModel(filename);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    model.csense(1:size(model.S,1),1)=</span><span class = "S12">'E'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    modelOrig = model;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">else</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    model=modelOrig;</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsVariableStringElement" uid="F1EB452A" data-testid="output_0" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><span class="variableNameElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">filename = </span>'Recon3D_301.mat'</div></div></div></div></div></div><div class = "S17"><span class = "S4">Set the level of pri</span><span class = "S4">nting, zero for silent, higher for more output.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">printLevel=2;</span></div></div></div><div class = "S17"><span class = "S4">Choose the directory to place the results</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">basePath=</span><span class = "S12">'~/work/sbgCloud/'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S14">%resultsPath=[basePath '/programReconstruction/projects/recon2models/results/reconXs/' model.modelID];</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">resultsPath=[basePath </span><span class = "S12">'/courses/2019_Leiden_COBRA/practicalsDemo/Day4/' </span><span class = "S13">model.modelID];</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">resultsFileName=[resultsPath filesep model.modelID];</span></div></div></div><div class = "S17"><span class = "S4">Create and enter the folder for the results if it does not already exist</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">~exist(resultsPath,</span><span class = "S12">'dir'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    mkdir(resultsPath)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">cd(resultsPath)</span></div></div></div><div class = "S17"><span class = "S4">Opt</span><span class = "S4">ionally create a diary to save the output in case it is very long, this makes it easier to search, especially when debugging the process during the early stages.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    diary</span><span class = "S9">(</span><span class = "S9">[resultsFileName </span><span class = "S12">'_diary.txt'</span><span class = "S13">])</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">Ove</span><span class = "S4">rview some of the key properties of the reconstruction</span></h2><div class = "S5"><span class = "S4">Noting the initial size of the reconstruction is useful for comparisons later with subsets derived according to mathematical specifications.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">[nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S9">fprintf(</span><span class = "S12">'%6s\t%6s\n'</span><span class = "S9">,</span><span class = "S12">'#mets'</span><span class = "S9">,</span><span class = "S12">'#rxns'</span><span class = "S13">)</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="84B00C66" data-testid="output_1" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"> #mets	 #rxns</div></div></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S9">fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet,nRxn,</span><span class = "S12">' totals.'</span><span class = "S13">)</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="9D4A5123" data-testid="output_2" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">  8399	 13543	 totals.</div></div></div></div></div><div class = "S17"><span class = "S4">Make sure the stoichiometric matrix i</span><span class = "S4">s stored in a sparse format as this accelerates computations with large networks</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">model.S=sparse(model.S);</span></div></div></div><h2 class = "S3"><span class = "S4">Check in case the reconstruction is a model that is already ready for flux balance analysis</span></h2><div class = "S5"><span class = "S4">There is no need to run </span><span class = "S4">this live script any further if the reconstruction already satisfies the conditions necessary for flux balance analysis. That is if all internal reactants and reactions are stoichiometrically consistent, and all reactions are flux consistent, then the reconstruction satisfies the criteria to designate it a model ready for flux balance analysis.</span></div><div class = "S5"><span class = "S4">SIntMetBool                     m x 1 Boolean of metabolites heuristically though to be involved in mass balanced reactions.</span></div><div class = "S5"><span class = "S4">SIntRxnBool                     n x 1 Boolean of reactions heuristically though to be mass balanced.</span></div><div class = "S5"><span class = "S4">SConsistentMetBool        m x 1 Boolean vector indicating consistent mets</span></div><div class = "S5"><span class = "S4">SConsistentRxnBool        n x 1 Boolean vector indicating consistent rxns</span></div><div class = "S5"><span class = "S4">fluxConsistentMetBool     m x 1 Boolean vector indicating flux consistent mets</span></div><div class = "S5"><span class = "S4">fluxConsistentRxnBool     n x 1 Boolean vector indicating flux consistent rxns</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">all(isfield(model,{</span><span class = "S12">'SIntMetBool'</span><span class = "S9">,</span><span class = "S12">'SIntRxnBool'</span><span class = "S9">,</span><span class = "S12">'SConsistentMetBool'</span><span class = "S9">,</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S12">'SConsistentRxnBool'</span><span class = "S9">,</span><span class = "S12">'fluxConsistentMetBool'</span><span class = "S9">,</span><span class = "S12">'fluxConsistentRxnBool'</span><span class = "S13">}))</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S9">all(model.SIntMetBool &amp; model.SConsistentMetBool)</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            &amp;&amp; nnz(model.SIntRxnBool &amp; model.SConsistentRxnBool)==nnz(model.SIntRxnBool)</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            &amp;&amp; all(model.fluxConsistentMetBool)</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            &amp;&amp; all(model.fluxConsistentRxnBool)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        fullyStoichAndFluxConsistent=1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'Reconstruction is a model that is already ready for flux balance analysis'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">return</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">else</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    fullyStoichAndFluxConsistent=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'Reconstruction must be tested to check if it is ready for flux balance analysis'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="CE0D3807" data-testid="output_3" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">Reconstruction must be tested to check if it is ready for flux balance analysis</div></div></div></div></div><h2 class = "S3"><span class = "S4">Manually remove certain reactions from the reconstruction </span></h2><div class = "S5"><span class = "S4">Bef</span><span class = "S4">ore attempting to algorithmically remove stoichiometrically or flux inconsistent supposed internal reactions from a reconstruction to generate a model, there is an option to review the content of the reconstruction and manually identify reactions for removal. That is, there are two options:</span></div><div class = "S5"><span class = "S4">A. Skip manual review of reconstruction content. Move to the next step.</span></div><div class = "S5"><span class = "S4">B. Review the content of the reconstruction and omit any reactions that are assumed to be stoichiometrically or flux inconsistent. With respect to stoichiometric inconsistency, such reactions may be obviously mass imbalanced and not satisfy the heuristic conditions for indentification as an exernal reaction. Alternatively, such reactions may be identified by a previous pass through of this tutorial as being of unknown stoichometric consistent (model.unknownSConsistencyRxnBool(j)==1), after the largest stoichiometrically consistent subset of the network has been is identified. This is an iterative process where multiple rounds of identification of the largest stoichiometrically consistent set and manual curation of the remainder that is of unknown stoichiometric consistency is necessary.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">strcmp(filename,</span><span class = "S12">'Recon3.0model'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    modelOrig=model;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if</span><span class = "S11"> </span><span class = "S13">1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S14">%Rename some of the biomass reactions to make them more obviously exchange</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S14">%reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            model.rxns{strcmp(model.rxns,</span><span class = "S12">'biomass_reaction'</span><span class = "S9">)}= </span><span class = "S12">'EX_biomass_reaction'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            model.rxns{strcmp(model.rxns,</span><span class = "S12">'biomass_maintenance'</span><span class = "S9">)}= </span><span class = "S12">'EX_biomass_maintenance'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            model.rxns{strcmp(model.rxns,</span><span class = "S12">'biomass_maintenance_noTrTr'</span><span class = "S9">)}= </span><span class = "S12">'EX_biomass_maintenance_noTrTr'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S14">%ATP hydrolysis is not imbalanced like all the other demand reactions so</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S14">%give it a different accronym ATPM = ATP Maintenance</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            bool=strcmp(</span><span class = "S12">'DM_atp_c_'</span><span class = "S13">,model.rxns);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            model.rxns{bool}=</span><span class = "S12">'ATPM'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [model,removeMetBool,removeRxnBool] = manuallyAdaptRecon3(model,printLevel);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">else</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [model,removeMetBool,removeRxnBool] = manuallyAdaptRecon3Ines(model,printLevel);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    [nMet0,nRxn0]=size(modelOrig.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    [nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">nMet0==nMet &amp;&amp; nRxn0==nRxn &amp;&amp; printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'--- Manually removing rows and columns of the stoichiometric matrix----'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%6s\t%6s\n'</span><span class = "S9">,</span><span class = "S12">'#mets'</span><span class = "S9">,</span><span class = "S12">'#rxns'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0,nRxn0,</span><span class = "S12">' totals.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0-nMet,nRxn0-nRxn,</span><span class = "S12">' manually removed.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet,nRxn,</span><span class = "S12">' remaining.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div></div><h2 class = "S3"><span class = "S4">Remove </span><span class = "S4">any trivial rows and columns of the stoichiometric matrix</span></h2><div class = "S5"><span class = "S4">Rem</span><span class = "S4">ove any zero rows or columns of the stoichiometric matrix</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">modelOrig=model;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">model=removeTrivialStoichiometry(model);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">[nMet0,nRxn0]=size(modelOrig.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">[nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">nMet0==nMet &amp;&amp; nRxn0==nRxn &amp;&amp; printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'---Checking for Remove any trivial rows and columns of the stoichiometric matrix----'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6s\t%6s\n'</span><span class = "S9">,</span><span class = "S12">'#mets'</span><span class = "S9">,</span><span class = "S12">'#rxns'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0,nRxn0,</span><span class = "S12">' totals.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0-nMet,nRxn0-nRxn,</span><span class = "S12">' duplicates removed.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet,nRxn,</span><span class = "S12">' remaining.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="BCBF9546" data-testid="output_4" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">---Checking for Remove any trivial rows and columns of the stoichiometric matrix----</div></div><div class="inlineElement embeddedOutputsTextElement" uid="BB3BB80C" data-testid="output_5" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"> #mets	 #rxns</div></div><div class="inlineElement embeddedOutputsTextElement" uid="4138FA47" data-testid="output_6" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">  8399	 13543	 totals.</div></div><div class="inlineElement embeddedOutputsTextElement" uid="CB9A06AB" data-testid="output_7" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     0	     0	 duplicates removed.</div></div><div class="inlineElement embeddedOutputsTextElement" uid="6E89F1F2" data-testid="output_8" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">  8399	 13543	 remaining.</div></div></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><div class = "S5"><span class = "S4">Che</span><span class = "S4">ck for duplicate columns by detecting the columns of the  S matrix that are identical upto scalar multiplication.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">modelOrig=model;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">dupDetectMethod</span><span class = "S9">=</span><span class = "S12">'FR'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">dupDetectMethod=</span><span class = "S12">'S'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">removeFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">[</span><span class = "S9">modelOut</span><span class = "S9">,removedRxnInd, </span><span class = "S9">keptRxnInd</span><span class = "S13">] = checkDuplicateRxn(model,dupDetectMethod,removeFlag,printLevel-2);</span></div></div></div><div class = "S17"><span class = "S4">Remove any du</span><span class = "S4">plicate reac</span><span class = "S4">tions, and</span><span class = "S4"> uniquely involved reactants, from the stoichiometric matrix</span><span class = "S4">. </span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">length</span><span class = "S13">(removedRxnInd)&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    irrevFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    metFlag=1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S14">%set all reactions reversible that are duplicates</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    model.lb(removedRxnInd)=-model.ub(removedRxnInd);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S14">%remove duplicates</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    model = removeRxns(model,model.rxns(removedRxnInd),irrevFlag,metFlag);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div></div><div class = "S17"><span class = "S4">Display the statistics on the duplicate reactions, </span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">[nMet0,nRxn0]=size(modelOrig.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">[nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">nMet0==nMet &amp;&amp; nRxn0==nRxn &amp;&amp; printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'---Remove any duplicate reactions----'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    [nMet0,nRxn0]=size(modelOrig.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    [nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6s\t%6s\n'</span><span class = "S9">,</span><span class = "S12">'#mets'</span><span class = "S9">,</span><span class = "S12">'#rxns'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0,nRxn0,</span><span class = "S12">' totals.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0-nMet,nRxn0-nRxn,</span><span class = "S12">' duplicates removed.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet,nRxn,</span><span class = "S12">' remaining.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="61DF51F6" data-testid="output_9" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">---Remove any duplicate reactions----</div></div><div class="inlineElement embeddedOutputsTextElement" uid="94AEDF9B" data-testid="output_10" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"> #mets	 #rxns</div></div><div class="inlineElement embeddedOutputsTextElement" uid="7AB4EB61" data-testid="output_11" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">  8399	 13543	 totals.</div></div><div class="inlineElement embeddedOutputsTextElement" uid="159100F6" data-testid="output_12" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     0	     0	 duplicates removed.</div></div><div class="inlineElement embeddedOutputsTextElement" uid="E01817DF" data-testid="output_13" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">  8399	 13543	 remaining.</div></div></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">Rem</span><span class = "S4">ove any duplicate reactions upto protons</span></h2><div class = "S5"><span class = "S4">Remove reactions reactions that differ only in the number of protons involved as substrates or products. Also remove exclusively involved reactants.</span></div><div class = "S5"><span class = "S4">Save a temporary model for testing, before making any changes.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">modelH=model;</span></div></div></div><div class = "S17"><span class = "S4">Find the prot</span><span class = "S4">on indicies in different compartments. A proton, with index i, is asumed to be represented by an abbreviation within model.mets{i} like h[*], where * denotes the compartment symbol.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">nMetChars=zeros(length(modelH.mets),1);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">for </span><span class = "S13">m=1:length(modelH.mets)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    nMetChars(m,1)=length(modelH.mets{m});</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">protonMetBool=strncmp(modelH.mets,</span><span class = "S12">'h'</span><span class = "S9">,1) &amp; nMetChars==length(</span><span class = "S12">'h[*]'</span><span class = "S13">);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">printLevel&gt;2</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    disp(modelH.mets(protonMetBool))</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div></div><div class = "S17"><span class = "S4">    Zero out the proton stoichiometr</span><span class = "S4">ic coefficients from the temporary model for testing</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">modelH.S(protonMetBool,:)=0;</span></div></div></div><div class = "S17"><span class = "S4">Check for duplicate columns, </span><span class = "S4">upto protons, by detecting the columns of the  S matrix that are identical upto scalar multiplication.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">dupDetectMethod=</span><span class = "S12">'FR'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">removeFlag=0;</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S13">[modelOut,removedRxnInd, keptRxnInd] = checkDuplicateRxn(modelH,dupDetectMethod,removeFlag,printLevel-1);</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement scrollableOutput" uid="328EA1BF" data-testid="output_14" data-width="984" style="width: 1014px; max-height: 364px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">Checking for reaction duplicates by stoichiometry (up to orientation) ...
     Keep: 	25HVITD2t	25hvitd2[c] 	-&gt;	25hvitd2[e] 
Duplicate: 	25HVITD2tin	25hvitd2[e] 	-&gt;	25hvitd2[c] 
     Keep: 	25HVITD2tin_m	25hvitd2[c] 	-&gt;	25hvitd2[m] 
Duplicate: 	25HVITD2tm	25hvitd2[m] 	-&gt;	25hvitd2[c] 
     Keep: 	25HVITD3t	25hvitd3[c] 	-&gt;	25hvitd3[e] 
Duplicate: 	25HVITD3tin	25hvitd3[e] 	-&gt;	25hvitd3[c] 
     Keep: 	25HVITD3tin_m	25hvitd3[c] 	-&gt;	25hvitd3[m] 
Duplicate: 	25HVITD3tm	25hvitd3[m] 	-&gt;	25hvitd3[c] 
     Keep: 	3MOBt2im	3mob[c] 	-&gt;	3mob[m] 
Duplicate: 	HMR_3746	3mob[c] 	&lt;=&gt;	3mob[m] 
     Keep: 	5MTHFt	5mthf[e] 	&lt;=&gt;	5mthf[c] 
Duplicate: 	MTHFTe	5mthf[c] 	-&gt;	5mthf[e] 
     Keep: 	ADNt	adn[e] 	&lt;=&gt;	adn[c] 
Duplicate: 	ADNCNT3tc	adn[e] 	&lt;=&gt;	adn[c] 
     Keep: 	ADPRIBt	adprib[e] 	-&gt;	adprib[c] 
Duplicate: 	ADPRIBte	adprib[c] 	&lt;=&gt;	adprib[e] 
     Keep: 	ALAt4	na1[e] + ala_L[e] 	-&gt;	na1[c] + ala_L[c] 
Duplicate: 	HMR_9605	na1[e] + ala_L[e] 	-&gt;	na1[c] + ala_L[c] 
     Keep: 	ALCD21_D	nad[c] + 12ppd_R[c] 	-&gt;	nadh[c] + lald_D[c] 
Duplicate: 	PPDOx	nadh[c] + lald_D[c] 	-&gt;	nad[c] + 12ppd_R[c] 
     Keep: 	ALCD22_D	nad[c] + lald_D[c] 	-&gt;	nadh[c] + mthgxl[c] 
Duplicate: 	LALDO2x	nadh[c] + mthgxl[c] 	-&gt;	nad[c] + lald_D[c] 
     Keep: 	ATPasel	h2o[c] + atp[c] 	-&gt;	adp[c] + pi[c] 
Duplicate: 	DM_atp_c_	h2o[c] + atp[c] 	-&gt;	adp[c] + pi[c] </div></div><div class="inlineElement embeddedOutputsWarningElement" uid="36CC4ECD" data-testid="output_15" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-warningType" style="white-space: normal; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;">Warning: BTNt2 has more than one replicate</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"></div></div></div><div class="inlineElement embeddedOutputsTextElement scrollableOutput" uid="5290E9EE" data-testid="output_16" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     Keep: 	BTNt2	btn[e] 	&lt;=&gt;	btn[c] 
Duplicate: 	BTNTe	btn[c] 	-&gt;	btn[e] 
     Keep: 	C14STRr	nadph[r] + 44mctr[r] 	-&gt;	nadp[r] + 44mzym[r] 
Duplicate: 	r0780	nadp[r] + 44mzym[r] 	&lt;=&gt;	nadph[r] + 44mctr[r] 
     Keep: 	C160CPT1	crn[c] + pmtcoa[c] 	&lt;=&gt;	coa[c] + pmtcrn[c] 
Duplicate: 	C160CPT2rbc	coa[c] + pmtcrn[c] 	&lt;=&gt;	crn[c] + pmtcoa[c] 
     Keep: 	C161CPT2	coa[m] + hdcecrn[m] 	&lt;=&gt;	crn[m] + hdcoa[m] 
Duplicate: 	r0446	crn[m] + hdcoa[m] 	&lt;=&gt;	coa[m] + hdcecrn[m] 
     Keep: 	C181CPT1	crn[c] + odecoa[c] 	&lt;=&gt;	coa[c] + odecrn[c] 
Duplicate: 	C181CPT2rbc	coa[c] + odecrn[c] 	&lt;=&gt;	crn[c] + odecoa[c] 
     Keep: 	CITtam	cit[c] + mal_L[m] 	&lt;=&gt;	cit[m] + mal_L[c] 
Duplicate: 	HMR_4964	cit[c] + mal_L[m] 	-&gt;	cit[m] + mal_L[c] 
     Keep: 	CRNt	crn[e] 	&lt;=&gt;	crn[c] 
Duplicate: 	CRNtHa	crn[c] 	-&gt;	crn[e] 
     Keep: 	CRNtuNa	na1[e] + crn[e] 	-&gt;	na1[c] + crn[c] 
Duplicate: 	CRNCT2te	na1[c] + crn[c] 	&lt;=&gt;	na1[e] + crn[e] 
     Keep: 	CRVNCtr	crvnc[e] 	&lt;=&gt;	crvnc[c] 
Duplicate: 	CE0328te	crvnc[c] 	&lt;=&gt;	crvnc[e] 
     Keep: 	CYSt4	na1[e] + cys_L[e] 	-&gt;	na1[c] + cys_L[c] 
Duplicate: 	CYSSNAT5tc	na1[e] + cys_L[e] 	&lt;=&gt;	na1[c] + cys_L[c] 
     Keep: 	CYTDt	cytd[e] 	&lt;=&gt;	cytd[c] 
Duplicate: 	CYTDt2r	cytd[e] 	&lt;=&gt;	cytd[c] 
     Keep: 	DALAt2r	ala_D[e] 	&lt;=&gt;	ala_D[c] 
Duplicate: 	ALA-DTDe	ala_D[c] 	-&gt;	ala_D[e] 
     Keep: 	DMHPTCRNte	dmhptcrn[c] 	&lt;=&gt;	dmhptcrn[e] 
Duplicate: 	DMHPTCRNtr	dmhptcrn[e] 	&lt;=&gt;	dmhptcrn[c] 
     Keep: 	DNDPt10m	dadp[c] + dcdp[m] 	-&gt;	dcdp[c] + dadp[m] 
Duplicate: 	DNDPt29m	dcdp[c] + dadp[m] 	-&gt;	dadp[c] + dcdp[m] 
     Keep: 	DNDPt11m	dadp[c] + dgdp[m] 	-&gt;	dgdp[c] + dadp[m] 
Duplicate: 	DNDPt35m	dgdp[c] + dadp[m] 	-&gt;	dadp[c] + dgdp[m] 
     Keep: 	DNDPt14m	dtdp[m] + dudp[c] 	-&gt;	dtdp[c] + dudp[m] 
Duplicate: 	DNDPt22m	dtdp[c] + dudp[m] 	-&gt;	dtdp[m] + dudp[c] 
     Keep: 	DNDPt15m	dgdp[m] + dudp[c] 	-&gt;	dgdp[c] + dudp[m] 
Duplicate: 	DNDPt33m	dgdp[c] + dudp[m] 	-&gt;	dgdp[m] + dudp[c] 
     Keep: 	DNDPt16m	dadp[m] + dudp[c] 	-&gt;	dadp[c] + dudp[m] 
Duplicate: 	DNDPt8m	dadp[c] + dudp[m] 	-&gt;	dadp[m] + dudp[c] 
     Keep: 	DNDPt17m	dcdp[m] + dudp[c] 	-&gt;	dcdp[c] + dudp[m] 
Duplicate: 	DNDPt26m	dcdp[c] + dudp[m] 	-&gt;	dcdp[m] + dudp[c] 
     Keep: 	DNDPt23m	dgdp[m] + dtdp[c] 	-&gt;	dgdp[c] + dtdp[m] 
Duplicate: 	DNDPt34m	dgdp[c] + dtdp[m] 	-&gt;	dgdp[m] + dtdp[c] 
     Keep: 	DNDPt24m	dadp[m] + dtdp[c] 	-&gt;	dadp[c] + dtdp[m] 
Duplicate: 	DNDPt9m	dadp[c] + dtdp[m] 	-&gt;	dadp[m] + dtdp[c] 
     Keep: 	DNDPt25m	dcdp[m] + dtdp[c] 	-&gt;	dcdp[c] + dtdp[m] 
Duplicate: 	DNDPt27m	dcdp[c] + dtdp[m] 	-&gt;	dcdp[m] + dtdp[c] 
     Keep: 	DNDPt28m	dcdp[c] + dgdp[m] 	-&gt;	dgdp[c] + dcdp[m] 
Duplicate: 	DNDPt36m	dgdp[c] + dcdp[m] 	-&gt;	dcdp[c] + dgdp[m] 
     Keep: 	DOPAtu	dopa[e] 	&lt;=&gt;	dopa[c] 
Duplicate: 	DOPAENT4tc	dopa[e] 	&lt;=&gt;	dopa[c] 
     Keep: 	EBP2r	zymstnl[r] 	-&gt;	lthstrl[r] 
Duplicate: 	r1381	lthstrl[r] 	&lt;=&gt;	zymstnl[r] 
     Keep: 	FE2t	fe2[e] 	-&gt;	fe2[c] 
Duplicate: 	FE2DMT1	fe2[e] 	-&gt;	fe2[c] 
     Keep: 	FE2tm	fe2[c] 	-&gt;	fe2[m] 
Duplicate: 	HMR_5420	fe2[c] 	-&gt;	fe2[m] 
     Keep: 	FUCFUCFUCGALACGLC13GALACGLCGAL14ACGLCGALGLUSIDEte	fucfucfucgalacglc13galacglcgal14acglcgalgluside_hs[e] 	&lt;=&gt;	fucfucfucgalacglc13galacglcgal14acglcgalgluside_hs[c] 
Duplicate: 	HMR_9651	fucfucfucgalacglc13galacglcgal14acglcgalgluside_hs[c] 	&lt;=&gt;	fucfucfucgalacglc13galacglcgal14acglcgalgluside_hs[e] 
     Keep: 	FUCFUCFUCGALACGLCGAL14ACGLCGALGLUSIDEte	fucfucfucgalacglcgal14acglcgalgluside_hs[e] 	&lt;=&gt;	fucfucfucgalacglcgal14acglcgalgluside_hs[c] 
Duplicate: 	HMR_9645	fucfucfucgalacglcgal14acglcgalgluside_hs[c] 	&lt;=&gt;	fucfucfucgalacglcgal14acglcgalgluside_hs[e] 
     Keep: 	FUCGALFUCGALACGLCGALGLUSIDEte	fucgalfucgalacglcgalgluside_hs[e] 	&lt;=&gt;	fucgalfucgalacglcgalgluside_hs[c] 
Duplicate: 	HMR_9643	fucgalfucgalacglcgalgluside_hs[c] 	&lt;=&gt;	fucgalfucgalacglcgalgluside_hs[e] 
     Keep: 	GALFUCGALACGLCGAL14ACGLCGALGLUSIDEte	galfucgalacglcgal14acglcgalgluside_hs[e] 	&lt;=&gt;	galfucgalacglcgal14acglcgalgluside_hs[c] 
Duplicate: 	HMR_9646	galfucgalacglcgal14acglcgalgluside_hs[c] 	&lt;=&gt;	galfucgalacglcgal14acglcgalgluside_hs[e] 
     Keep: 	GALt1r	gal[e] 	&lt;=&gt;	gal[c] 
Duplicate: 	GALt2_2	gal[e] 	&lt;=&gt;	gal[c] 
     Keep: 	GDPtg	gdp[c] 	&lt;=&gt;	gdp[g] 
Duplicate: 	HMR_7743	gdp[c] 	&lt;=&gt;	gdp[g] </div></div><div class="inlineElement embeddedOutputsWarningElement" uid="C5994662" data-testid="output_17" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-warningType" style="white-space: normal; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;">Warning: GLCt1r has more than one replicate</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"></div></div></div><div class="inlineElement embeddedOutputsTextElement" uid="18024E25" data-testid="output_18" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     Keep: 	GLCt1r	glc_D[e] 	&lt;=&gt;	glc_D[c] 
Duplicate: 	GLCGLUT2	glc_D[c] 	-&gt;	glc_D[e] 
     Keep: 	GLNtm	gln_L[c] 	-&gt;	gln_L[m] 
Duplicate: 	HMR_5101	gln_L[c] 	-&gt;	gln_L[m] 
     Keep: 	GLYC3Ptm	glyc3p[c] 	-&gt;	glyc3p[m] 
Duplicate: 	GLYC3Ptmc	glyc3p[m] 	&lt;=&gt;	glyc3p[c] 
     Keep: 	GLYt4	na1[e] + gly[e] 	-&gt;	na1[c] + gly[c] 
Duplicate: 	GLYSNAT5tc	na1[e] + gly[e] 	&lt;=&gt;	na1[c] + gly[c] 
     Keep: 	GSNt	gsn[e] 	&lt;=&gt;	gsn[c] 
Duplicate: 	GSNt2r	gsn[e] 	&lt;=&gt;	gsn[c] 
     Keep: 	HISt4	na1[e] + his_L[e] 	-&gt;	na1[c] + his_L[c] 
Duplicate: 	HISSNAT5tc	na1[e] + his_L[e] 	&lt;=&gt;	na1[c] + his_L[c] 
     Keep: 	HIStiDF	his_L[e] 	-&gt;	his_L[c] 
Duplicate: 	HISCAT1	his_L[c] 	&lt;=&gt;	his_L[e] 
     Keep: 	HSD17B7r	nadph[r] + estrone[r] 	-&gt;	nadp[r] + estradiol[r] 
Duplicate: 	HMR_2041	nadph[r] + estrone[r] 	-&gt;	nadp[r] + estradiol[r] </div></div><div class="inlineElement embeddedOutputsWarningElement" uid="DE9D074B" data-testid="output_19" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-warningType" style="white-space: normal; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;">Warning: Htg has more than one replicate</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"></div></div></div><div class="inlineElement embeddedOutputsTextElement" uid="53BB2AE6" data-testid="output_20" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     Keep: 	Htg		&lt;=&gt;	
Duplicate: 	Htmi		-&gt;	
     Keep: 	INSt	ins[e] 	&lt;=&gt;	ins[c] 
Duplicate: 	INSt2	ins[e] 	&lt;=&gt;	ins[c] 
     Keep: 	L_LACtcm	lac_L[c] 	-&gt;	lac_L[m] 
Duplicate: 	L_LACtm	lac_L[c] 	-&gt;	lac_L[m] 
     Keep: 	LNLCCPT1	crn[c] + lnlccoa[c] 	&lt;=&gt;	coa[c] + lnlccrn[c] 
Duplicate: 	LNLCCPT2rbc	coa[c] + lnlccrn[c] 	&lt;=&gt;	crn[c] + lnlccoa[c] </div></div><div class="inlineElement embeddedOutputsWarningElement" uid="14B3E87B" data-testid="output_21" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-warningType" style="white-space: normal; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;">Warning: NACUP has more than one replicate</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"></div></div></div><div class="inlineElement embeddedOutputsTextElement" uid="3CF737C1" data-testid="output_22" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     Keep: 	NACUP	nac[e] 	-&gt;	nac[c] 
Duplicate: 	NACHORCTL3le	nac[e] 	-&gt;	nac[c] 
     Keep: 	NADHtpu	nadh[c] 	-&gt;	nadh[x] 
Duplicate: 	NADtpu	nadh[x] 	-&gt;	nadh[c] 
     Keep: 	NAt	na1[e] 	&lt;=&gt;	na1[c] 
Duplicate: 	NAt3_1	na1[c] 	&lt;=&gt;	na1[e] 
     Keep: 	NCAMUP	ncam[e] 	-&gt;	ncam[c] 
Duplicate: 	NCAMDe	ncam[c] 	-&gt;	ncam[e] 
     Keep: 	NH4t3r	nh4[c] 	&lt;=&gt;	nh4[e] 
Duplicate: 	NH4tb	nh4[e] 	&lt;=&gt;	nh4[c] 
     Keep: 	NOt	no[e] 	&lt;=&gt;	no[c] 
Duplicate: 	NODe	no[c] 	&lt;=&gt;	no[e] 
     Keep: 	OCTAt	octa[e] 	&lt;=&gt;	octa[c] 
Duplicate: 	OCTAte	octa[c] 	&lt;=&gt;	octa[e] </div></div><div class="inlineElement embeddedOutputsWarningElement" uid="3CC73B4E" data-testid="output_23" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-warningType" style="white-space: normal; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;">Warning: ORNt4m has more than one replicate</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"></div></div></div><div class="inlineElement embeddedOutputsTextElement" uid="59F5892D" data-testid="output_24" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     Keep: 	ORNt4m	orn[m] + citr_L[c] 	&lt;=&gt;	orn[c] + citr_L[m] 
Duplicate: 	r2412	orn[c] + citr_L[m] 	-&gt;	orn[m] + citr_L[c] 
     Keep: 	P5CRxm	nadh[m] + 1pyr5c[m] 	-&gt;	nad[m] + pro_L[m] 
Duplicate: 	PRO1xm	nad[m] + pro_L[m] 	-&gt;	nadh[m] + 1pyr5c[m] 
     Keep: 	PItx	pi[c] 	&lt;=&gt;	pi[x] 
Duplicate: 	HMR_5344	pi[c] 	&lt;=&gt;	pi[x] 
     Keep: 	PRODt2r	pro_D[e] 	&lt;=&gt;	pro_D[c] 
Duplicate: 	PRO_Dtde	pro_D[c] 	&lt;=&gt;	pro_D[e] 
     Keep: 	RIBt	rib_D[e] 	&lt;=&gt;	rib_D[c] 
Duplicate: 	RIBt2	rib_D[e] 	-&gt;	rib_D[c] 
     Keep: 	SRTNtu	srtn[e] 	&lt;=&gt;	srtn[c] 
Duplicate: 	SRTNENT4tc	srtn[e] 	&lt;=&gt;	srtn[c] 
     Keep: 	SUCCtp	succ[c] 	&lt;=&gt;	succ[x] 
Duplicate: 	SUCCTD	succ[x] 	&lt;=&gt;	succ[c] 
     Keep: 	TAGt	tag_hs[e] 	&lt;=&gt;	tag_hs[c] 
Duplicate: 	TAGHSTDe	tag_hs[c] 	-&gt;	tag_hs[e] </div></div><div class="inlineElement embeddedOutputsWarningElement" uid="5340B537" data-testid="output_25" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-warningType" style="white-space: normal; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;">Warning: THYMDt1 has more than one replicate</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"></div></div></div><div class="inlineElement embeddedOutputsTextElement" uid="4F03B4B4" data-testid="output_26" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     Keep: 	THYMDt1	thymd[e] 	-&gt;	thymd[c] 
Duplicate: 	THMDt2r	thymd[e] 	&lt;=&gt;	thymd[c] 
     Keep: 	TRDRm	nadph[m] + trdox[m] 	-&gt;	nadp[m] + trdrd[m] 
Duplicate: 	r1433	nadp[m] + trdrd[m] 	-&gt;	nadph[m] + trdox[m] 
     Keep: 	URIt	uri[e] 	&lt;=&gt;	uri[c] 
Duplicate: 	URIt2r	uri[e] 	&lt;=&gt;	uri[c] 
     Keep: 	VITD3t	vitd3[c] 	-&gt;	vitd3[e] 
Duplicate: 	VITD3t2	vitd3[e] 	-&gt;	vitd3[c] </div></div><div class="inlineElement embeddedOutputsWarningElement" uid="CCB5B6C8" data-testid="output_27" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-warningType" style="white-space: normal; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;">Warning: VITD3tm has more than one replicate</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(255, 100, 0); font-size: 12px;"></div></div></div><div class="inlineElement embeddedOutputsTextElement scrollableOutput" uid="91A471E8" data-testid="output_28" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     Keep: 	VITD3tm	vitd3[m] 	-&gt;	vitd3[c] 
Duplicate: 	HMR_2116	vitd3[c] 	&lt;=&gt;	vitd3[m] 
     Keep: 	XOLEST2te	xolest2_hs[e] 	&lt;=&gt;	xolest2_hs[c] 
Duplicate: 	XOLEST2HSTDle	xolest2_hs[c] 	-&gt;	xolest2_hs[e] 
     Keep: 	r0276	nh4[c] + nadp[c] + imp[c] 	&lt;=&gt;	nadph[c] + gmp[c] 
Duplicate: 	GMPR	nadph[c] + gmp[c] 	-&gt;	nh4[c] + nadp[c] + imp[c] 
     Keep: 	r0488	2 nadp[c] + coa[c] + mev_R[c] 	&lt;=&gt;	2 nadph[c] + hmgcoa[c] 
Duplicate: 	HMGCOARc	2 nadph[c] + hmgcoa[c] 	-&gt;	2 nadp[c] + coa[c] + mev_R[c] 
     Keep: 	r0537	ethamp[c] + hxdcal[c] 	-&gt;	sph1p[c] 
Duplicate: 	SGPL11c	sph1p[c] 	-&gt;	ethamp[c] + hxdcal[c] 
     Keep: 	r0561	coa[m] + 2mpdhl[m] 	-&gt;	ibcoa[m] + dhlam[m] 
Duplicate: 	RE3326M	ibcoa[m] + dhlam[m] 	&lt;=&gt;	coa[m] + 2mpdhl[m] 
     Keep: 	r0808	HC00004[c] 	-&gt;	HC00004[e] 
Duplicate: 	HC00004t1e	HC00004[e] 	-&gt;	HC00004[c] 
     Keep: 	r0817	citr_L[c] 	&lt;=&gt;	citr_L[e] 
Duplicate: 	CITRtr	citr_L[e] 	&lt;=&gt;	citr_L[c] 
     Keep: 	r0839	orot[e] 	&lt;=&gt;	orot[c] 
Duplicate: 	OROte	orot[e] 	-&gt;	orot[c] 
     Keep: 	r0899	ala_B[c] 	&lt;=&gt;	ala_B[e] 
Duplicate: 	BALAPAT1tc	ala_B[e] 	-&gt;	ala_B[c] 
     Keep: 	r0913	icit[m] + mal_L[c] 	&lt;=&gt;	mal_L[m] + icit[c] 
Duplicate: 	r2387	mal_L[m] + icit[c] 	-&gt;	icit[m] + mal_L[c] 
     Keep: 	r0915	cit[c] + succ[m] 	&lt;=&gt;	cit[m] + succ[c] 
Duplicate: 	r2382	cit[c] + succ[m] 	-&gt;	cit[m] + succ[c] 
     Keep: 	r0944	spmd[c] 	&lt;=&gt;	spmd[e] 
Duplicate: 	SPMTDe	spmd[e] 	&lt;=&gt;	spmd[c] 
     Keep: 	r1050	chsterol[e] 	&lt;=&gt;	chsterol[c] 
Duplicate: 	CHOLESTTDe	chsterol[c] 	-&gt;	chsterol[e] 
     Keep: 	r1067	his_L[l] 	-&gt;	his_L[c] 
Duplicate: 	HIShPTtc	his_L[l] 	-&gt;	his_L[c] 
     Keep: 	r1078	tyr_L[c] 	-&gt;	tyr_L[m] 
Duplicate: 	HMR_5099	tyr_L[c] 	&lt;=&gt;	tyr_L[m] 
     Keep: 	r1127	HC00005[c] 	-&gt;	HC00005[r] 
Duplicate: 	HC00005t1r	HC00005[r] 	-&gt;	HC00005[c] 
     Keep: 	r1128	HC00009[c] 	-&gt;	HC00009[r] 
Duplicate: 	HC00009t1r	HC00009[r] 	-&gt;	HC00009[c] 
     Keep: 	r1129	HC00004[c] 	-&gt;	HC00004[r] 
Duplicate: 	HC00004t1r	HC00004[r] 	-&gt;	HC00004[c] 
     Keep: 	r1131	HC00006[c] 	-&gt;	HC00006[r] 
Duplicate: 	HC00006t1r	HC00006[r] 	-&gt;	HC00006[c] 
     Keep: 	r1132	HC00007[c] 	-&gt;	HC00007[r] 
Duplicate: 	HC00007t1r	HC00007[r] 	-&gt;	HC00007[c] 
     Keep: 	r1133	HC00008[c] 	-&gt;	HC00008[r] 
Duplicate: 	HC00008t1r	HC00008[r] 	-&gt;	HC00008[c] 
     Keep: 	r1147	akg[c] + icit[m] 	&lt;=&gt;	akg[m] + icit[c] 
Duplicate: 	r2385	akg[m] + icit[c] 	-&gt;	akg[c] + icit[m] 
     Keep: 	r1155	2obut[c] 	-&gt;	2obut[m] 
Duplicate: 	r1454	2obut[m] 	-&gt;	2obut[c] 
     Keep: 	r1423	pi[c] 	-&gt;	pi[e] 
Duplicate: 	PIt6b	pi[e] 	&lt;=&gt;	pi[c] 
     Keep: 	r1427	his_L[c] 	-&gt;	his_L[m] 
Duplicate: 	r2416	his_L[m] 	-&gt;	his_L[c] 
     Keep: 	r1429	glyc3p[c] 	&lt;=&gt;	glyc3p[x] 
Duplicate: 	GLY3Pt	glyc3p[x] 	-&gt;	glyc3p[c] 
     Keep: 	r1441	trdrd[c] 	-&gt;	trdrd[m] 
Duplicate: 	HMR_6618	trdrd[c] 	&lt;=&gt;	trdrd[m] 
     Keep: 	r1455	phe_L[c] 	-&gt;	phe_L[m] 
Duplicate: 	r1456	phe_L[m] 	-&gt;	phe_L[c] 
     Keep: 	r1618	tyr_L[c] + phe_L[e] 	&lt;=&gt;	phe_L[c] + tyr_L[e] 
Duplicate: 	TYRPHELAT2tc	phe_L[c] + tyr_L[e] 	-&gt;	tyr_L[c] + phe_L[e] 
     Keep: 	r1619	cys_L[c] + phe_L[e] 	&lt;=&gt;	cys_L[e] + phe_L[c] 
Duplicate: 	CYSPHELAT2tc	cys_L[e] + phe_L[c] 	-&gt;	cys_L[c] + phe_L[e] 
     Keep: 	r1620	leu_L[c] + phe_L[e] 	&lt;=&gt;	leu_L[e] + phe_L[c] 
Duplicate: 	LEUPHELAT2tc	leu_L[e] + phe_L[c] 	&lt;=&gt;	leu_L[c] + phe_L[e] 
     Keep: 	r1622	asn_L[c] + phe_L[e] 	&lt;=&gt;	asn_L[e] + phe_L[c] 
Duplicate: 	ASNPHELAT2tc	asn_L[e] + phe_L[c] 	-&gt;	asn_L[c] + phe_L[e] 
     Keep: 	r1623	phe_L[e] + val_L[c] 	&lt;=&gt;	phe_L[c] + val_L[e] 
Duplicate: 	VALPHELAT2tc	phe_L[c] + val_L[e] 	-&gt;	phe_L[e] + val_L[c] 
     Keep: 	r1624	thr_L[c] + phe_L[e] 	&lt;=&gt;	thr_L[e] + phe_L[c] 
Duplicate: 	THRPHELAT2tc	thr_L[e] + phe_L[c] 	-&gt;	thr_L[c] + phe_L[e] 
     Keep: 	r1626	ile_L[c] + phe_L[e] 	&lt;=&gt;	ile_L[e] + phe_L[c] 
Duplicate: 	ILEPHELAT2tc	ile_L[e] + phe_L[c] 	-&gt;	ile_L[c] + phe_L[e] 
     Keep: 	r1644	leu_L[e] + val_L[c] 	&lt;=&gt;	leu_L[c] + val_L[e] 
Duplicate: 	VALLAT1tc	leu_L[c] + val_L[e] 	-&gt;	leu_L[e] + val_L[c] 
     Keep: 	r1647	ile_L[c] + leu_L[e] 	&lt;=&gt;	ile_L[e] + leu_L[c] 
Duplicate: 	ILELAT1tc	ile_L[e] + leu_L[c] 	-&gt;	ile_L[c] + leu_L[e] 
     Keep: 	r1668	arg_L[e] + his_L[c] 	&lt;=&gt;	arg_L[c] + his_L[e] 
Duplicate: 	HISyLATthc	arg_L[c] + his_L[e] 	-&gt;	arg_L[e] + his_L[c] 
     Keep: 	r2009	ala_L[c] + arg_L[e] 	-&gt;	ala_L[e] + arg_L[c] 
Duplicate: 	ALAyLATthc	ala_L[e] + arg_L[c] 	-&gt;	ala_L[c] + arg_L[e] 
     Keep: 	r2010	gln_L[c] + arg_L[e] 	-&gt;	gln_L[e] + arg_L[c] 
Duplicate: 	GLNyLATthc	gln_L[e] + arg_L[c] 	-&gt;	gln_L[c] + arg_L[e] 
     Keep: 	r2012	arg_L[e] + met_L[c] 	-&gt;	arg_L[c] + met_L[e] 
Duplicate: 	METyLATthc	arg_L[c] + met_L[e] 	-&gt;	arg_L[e] + met_L[c] 
     Keep: 	r2014	arg_L[e] + phe_L[c] 	-&gt;	arg_L[c] + phe_L[e] 
Duplicate: 	PHEyLATthc	arg_L[c] + phe_L[e] 	-&gt;	arg_L[e] + phe_L[c] 
     Keep: 	r2017	arg_L[e] + leu_L[c] 	-&gt;	arg_L[c] + leu_L[e] 
Duplicate: 	LEUyLAThtc	arg_L[c] + leu_L[e] 	-&gt;	arg_L[e] + leu_L[c] 
     Keep: 	r2073	zn2[e] 	-&gt;	zn2[c] 
Duplicate: 	r2465	zn2[c] 	-&gt;	zn2[e] 
     Keep: 	r2346	wharachd[e] 	&lt;=&gt;	wharachd[c] 
Duplicate: 	WHARACHDtd	wharachd[c] 	&lt;=&gt;	wharachd[e] 
     Keep: 	r2355	HC02203[e] 	&lt;=&gt;	HC02203[c] 
Duplicate: 	C05953td	HC02203[c] 	&lt;=&gt;	HC02203[e] 
     Keep: 	r2364	HC02213[e] 	&lt;=&gt;	HC02213[c] 
Duplicate: 	C06439td	HC02213[c] 	&lt;=&gt;	HC02213[e] 
     Keep: 	r2373	akg[c] + cit[m] 	&lt;=&gt;	akg[m] + cit[c] 
Duplicate: 	r2381	akg[m] + cit[c] 	-&gt;	akg[c] + cit[m] 
     Keep: 	r2374	cit[m] + oxa[c] 	&lt;=&gt;	cit[c] + oxa[m] 
Duplicate: 	r2384	cit[c] + oxa[m] 	-&gt;	cit[m] + oxa[c] 
     Keep: 	r2375	icit[m] + succ[c] 	&lt;=&gt;	icit[c] + succ[m] 
Duplicate: 	r2386	icit[c] + succ[m] 	-&gt;	icit[m] + succ[c] 
     Keep: 	r2376	icit[m] + oxa[c] 	&lt;=&gt;	icit[c] + oxa[m] 
Duplicate: 	r2388	icit[c] + oxa[m] 	-&gt;	icit[m] + oxa[c] 
     Keep: 	r2377	akg[c] + HC00342[m] 	&lt;=&gt;	akg[m] + HC00342[c] 
Duplicate: 	r2389	akg[m] + HC00342[c] 	-&gt;	akg[c] + HC00342[m] 
     Keep: 	r2378	succ[c] + HC00342[m] 	&lt;=&gt;	succ[m] + HC00342[c] 
Duplicate: 	r2390	succ[m] + HC00342[c] 	-&gt;	succ[c] + HC00342[m] 
     Keep: 	r2379	mal_L[c] + HC00342[m] 	&lt;=&gt;	mal_L[m] + HC00342[c] 
Duplicate: 	r2391	mal_L[m] + HC00342[c] 	-&gt;	mal_L[c] + HC00342[m] 
     Keep: 	r2380	oxa[c] + HC00342[m] 	&lt;=&gt;	HC00342[c] + oxa[m] 
Duplicate: 	r2392	HC00342[c] + oxa[m] 	-&gt;	oxa[c] + HC00342[m] 
     Keep: 	r2395	lys_L[m] + arg_L[c] 	-&gt;	lys_L[c] + arg_L[m] 
Duplicate: 	r2399	lys_L[c] + arg_L[m] 	-&gt;	lys_L[m] + arg_L[c] 
     Keep: 	r2396	orn[c] + lys_L[m] 	-&gt;	lys_L[c] + orn[m] 
Duplicate: 	r2403	lys_L[c] + orn[m] 	-&gt;	orn[c] + lys_L[m] 
     Keep: 	r2397	lys_L[m] + his_L[c] 	-&gt;	lys_L[c] + his_L[m] 
Duplicate: 	r2406	lys_L[c] + his_L[m] 	-&gt;	lys_L[m] + his_L[c] 
     Keep: 	r2398	lys_L[m] + citr_L[c] 	-&gt;	lys_L[c] + citr_L[m] 
Duplicate: 	r2410	lys_L[c] + citr_L[m] 	-&gt;	lys_L[m] + citr_L[c] 
     Keep: 	r2400	orn[c] + arg_L[m] 	-&gt;	arg_L[c] + orn[m] 
Duplicate: 	r2404	arg_L[c] + orn[m] 	-&gt;	orn[c] + arg_L[m] 
     Keep: 	r2401	arg_L[m] + his_L[c] 	-&gt;	arg_L[c] + his_L[m] 
Duplicate: 	r2407	arg_L[c] + his_L[m] 	-&gt;	arg_L[m] + his_L[c] 
     Keep: 	r2402	arg_L[m] + citr_L[c] 	-&gt;	arg_L[c] + citr_L[m] 
Duplicate: 	r2411	arg_L[c] + citr_L[m] 	-&gt;	arg_L[m] + citr_L[c] 
     Keep: 	r2405	orn[m] + his_L[c] 	-&gt;	orn[c] + his_L[m] 
Duplicate: 	r2408	orn[c] + his_L[m] 	-&gt;	orn[m] + his_L[c] 
     Keep: 	r2409	citr_L[c] + his_L[m] 	-&gt;	citr_L[m] + his_L[c] 
Duplicate: 	r2413	citr_L[m] + his_L[c] 	-&gt;	citr_L[c] + his_L[m] 
     Keep: 	r2471	ser_L[e] 	-&gt;	ser_L[c] 
Duplicate: 	r2526	ser_L[e] 	&lt;=&gt;	ser_L[c] 
     Keep: 	r2516	lac_L[x] 	&lt;=&gt;	lac_L[c] 
Duplicate: 	LACLt	lac_L[x] 	-&gt;	lac_L[c] 
     Keep: 	RE3628M	dc2coa[m] 	&lt;=&gt;	dece3coa[m] 
Duplicate: 	FAOXC101m	dece3coa[m] 	-&gt;	dc2coa[m] 
     Keep: 	BCRNe	3bcrn[c] 	-&gt;	3bcrn[e] 
Duplicate: 	3BCRNtr	3bcrn[e] 	&lt;=&gt;	3bcrn[c] 
     Keep: 	C101CRNe	c101crn[c] 	-&gt;	c101crn[e] 
Duplicate: 	C101CRNtr	c101crn[e] 	&lt;=&gt;	c101crn[c] 
     Keep: 	C10CRNe	c10crn[c] 	-&gt;	c10crn[e] 
Duplicate: 	C10CRNtr	c10crn[e] 	&lt;=&gt;	c10crn[c] 
     Keep: 	C10DCe	c10dc[c] 	-&gt;	c10dc[e] 
Duplicate: 	C10DCtr	c10dc[e] 	&lt;=&gt;	c10dc[c] 
     Keep: 	C12DCe	c12dc[c] 	-&gt;	c12dc[e] 
Duplicate: 	C12DCtr	c12dc[e] 	&lt;=&gt;	c12dc[c] 
     Keep: 	C141OHe	3tetd7ecoacrn[c] 	-&gt;	3tetd7ecoacrn[e] 
Duplicate: 	3TETD7ECOACRNtr	3tetd7ecoacrn[e] 	&lt;=&gt;	3tetd7ecoacrn[c] 
     Keep: 	C142OHe	3ttetddcoacrn[c] 	-&gt;	3ttetddcoacrn[e] 
Duplicate: 	3TTETDDCOACRNtr	3ttetddcoacrn[e] 	&lt;=&gt;	3ttetddcoacrn[c] 
     Keep: 	C162OHe	3thexddcoacrn[c] 	-&gt;	3thexddcoacrn[e] 
Duplicate: 	3THEXDDCOACRNtr	3thexddcoacrn[e] 	&lt;=&gt;	3thexddcoacrn[c] 
     Keep: 	C16DCe	c16dc[c] 	-&gt;	c16dc[e] 
Duplicate: 	C16DCtr	c16dc[e] 	&lt;=&gt;	c16dc[c] 
     Keep: 	C3DCe	c3dc[c] 	-&gt;	c3dc[e] 
Duplicate: 	C3DCtr	c3dc[e] 	&lt;=&gt;	c3dc[c] 
     Keep: 	C4CRNe	c4crn[c] 	-&gt;	c4crn[e] 
Duplicate: 	C4CRNtr	c4crn[e] 	&lt;=&gt;	c4crn[c] 
     Keep: 	C4DCe	c4dc[c] 	-&gt;	c4dc[e] 
Duplicate: 	C4DCtr	c4dc[e] 	&lt;=&gt;	c4dc[c] 
     Keep: 	C5DCe	c5dc[c] 	-&gt;	c5dc[e] 
Duplicate: 	C5DCtr	c5dc[e] 	&lt;=&gt;	c5dc[c] 
     Keep: 	C6CRNe	c6crn[c] 	-&gt;	c6crn[e] 
Duplicate: 	C6CRNtr	c6crn[e] 	&lt;=&gt;	c6crn[c] 
     Keep: 	C6DCe	c6dc[c] 	-&gt;	c6dc[e] 
Duplicate: 	C6DCtr	c6dc[e] 	&lt;=&gt;	c6dc[c] 
     Keep: 	C81CRNe	c81crn[c] 	-&gt;	c81crn[e] 
Duplicate: 	C81CRNtr	c81crn[e] 	&lt;=&gt;	c81crn[c] 
     Keep: 	C8CRNe	c8crn[c] 	-&gt;	c8crn[e] 
Duplicate: 	C8CRNtr	c8crn[e] 	&lt;=&gt;	c8crn[c] 
     Keep: 	C8DCe	c8dc[c] 	-&gt;	c8dc[e] 
Duplicate: 	C8DCtr	c8dc[e] 	&lt;=&gt;	c8dc[c] 
     Keep: 	DDCRNe	3ddcrn[c] 	-&gt;	3ddcrn[e] 
Duplicate: 	3DDCRNtr	3ddcrn[e] 	&lt;=&gt;	3ddcrn[c] 
     Keep: 	DDECCRNe	ddeccrn[c] 	-&gt;	ddeccrn[e] 
Duplicate: 	DDECCRNtr	ddeccrn[e] 	&lt;=&gt;	ddeccrn[c] 
     Keep: 	DDECE1CRNe	ddece1crn[c] 	-&gt;	ddece1crn[e] 
Duplicate: 	DDECE1CRNtr	ddece1crn[e] 	&lt;=&gt;	ddece1crn[c] 
     Keep: 	DECCRNe	3deccrn[c] 	-&gt;	3deccrn[e] 
Duplicate: 	3DECCRNtr	3deccrn[e] 	&lt;=&gt;	3deccrn[c] 
     Keep: 	DECDICRNe	decdicrn[c] 	-&gt;	decdicrn[e] 
Duplicate: 	DECDICRNtr	decdicrn[e] 	&lt;=&gt;	decdicrn[c] 
     Keep: 	HEDCECRNe	3hdececrn[c] 	-&gt;	3hdececrn[e] 
Duplicate: 	3HDECECRNtr	3hdececrn[e] 	&lt;=&gt;	3hdececrn[c] 
     Keep: 	HEXDCRNe	3hexdcrn[c] 	-&gt;	3hexdcrn[e] 
Duplicate: 	3HEXDCRNtr	3hexdcrn[e] 	&lt;=&gt;	3hexdcrn[c] 
     Keep: 	HIVCRNe	3ivcrn[c] 	-&gt;	3ivcrn[e] 
Duplicate: 	3IVCRNtr	3ivcrn[e] 	&lt;=&gt;	3ivcrn[c] 
     Keep: 	HOCTDEC2CRNe	3octdec2crn[c] 	-&gt;	3octdec2crn[e] 
Duplicate: 	3OCTDEC2CRNtr	3octdec2crn[e] 	&lt;=&gt;	3octdec2crn[c] 
     Keep: 	HOCTDECCRNe	3octdeccrn[c] 	-&gt;	3octdeccrn[e] 
Duplicate: 	3OCTDECCRNtr	3octdeccrn[e] 	&lt;=&gt;	3octdeccrn[c] 
     Keep: 	HTDCRNe	3tdcrn[c] 	-&gt;	3tdcrn[e] 
Duplicate: 	3TDCRNtr	3tdcrn[e] 	&lt;=&gt;	3tdcrn[c] 
     Keep: 	IVCRNe	ivcrn[c] 	-&gt;	ivcrn[e] 
Duplicate: 	IVCRNtr	ivcrn[e] 	&lt;=&gt;	ivcrn[c] 
     Keep: 	OCTDECE1CRNe	3octdece1crn[c] 	-&gt;	3octdece1crn[e] 
Duplicate: 	3OCTDECE1CRNtr	3octdece1crn[e] 	&lt;=&gt;	3octdece1crn[c] 
     Keep: 	TDCRNe	ttdcrn[c] 	-&gt;	ttdcrn[e] 
Duplicate: 	TTDCRNtr	ttdcrn[e] 	&lt;=&gt;	ttdcrn[c] 
     Keep: 	TETDEC2CRNe	tetdec2crn[c] 	-&gt;	tetdec2crn[e] 
Duplicate: 	TETDEC2CRntr	tetdec2crn[e] 	&lt;=&gt;	tetdec2crn[c] 
     Keep: 	TETDECE1CRNe	tetdece1crn[c] 	-&gt;	tetdece1crn[e] 
Duplicate: 	TETDECE1CRNtr	tetdece1crn[e] 	&lt;=&gt;	tetdece1crn[c] 
     Keep: 	TIGCRNe	c51crn[c] 	-&gt;	c51crn[e] 
Duplicate: 	C51CRNtr	c51crn[e] 	&lt;=&gt;	c51crn[c] 
     Keep: 	CARPEPT1tc	carn[e] 	-&gt;	carn[c] 
Duplicate: 	CARNtr	carn[e] 	&lt;=&gt;	carn[c] 
     Keep: 	CBLTDe	adocbl[c] 	-&gt;	adocbl[e] 
Duplicate: 	CBLtle	adocbl[e] 	-&gt;	adocbl[c] 
     Keep: 	FOLTle	fol[e] 	-&gt;	fol[c] 
Duplicate: 	r0963	fol[e] 	-&gt;	fol[c] 
     Keep: 	GLYPROPEPT1tc	glypro[e] 	-&gt;	glypro[c] 
Duplicate: 	GLYPROt	glypro[c] 	&lt;=&gt;	glypro[e] 
     Keep: 	LEULEUPEPT1tc	leuleu[e] 	-&gt;	leuleu[c] 
Duplicate: 	LEULEUt	leuleu[c] 	&lt;=&gt;	leuleu[e] 
     Keep: 	PNTORDe	pnto_R[c] 	-&gt;	pnto_R[e] 
Duplicate: 	PNTOte	pnto_R[e] 	&lt;=&gt;	pnto_R[c] 
     Keep: 	PROGLYPEPT1tc	progly[e] 	-&gt;	progly[c] 
Duplicate: 	PROGLyt	progly[c] 	&lt;=&gt;	progly[e] 
     Keep: 	SBTle	sbt_D[e] 	-&gt;	sbt_D[c] 
Duplicate: 	SBT_Dtde	sbt_D[c] 	&lt;=&gt;	sbt_D[e] 
     Keep: 	TAUPAT1c	taur[e] 	-&gt;	taur[c] 
Duplicate: 	TAURCHAe	taur[c] 	-&gt;	taur[e] 
     Keep: 	GLYCTDle	glyc[e] 	&lt;=&gt;	glyc[c] 
Duplicate: 	GLYCt	glyc[c] 	&lt;=&gt;	glyc[e] 
     Keep: 	KHte	k[e] 	&lt;=&gt;	k[c] 
Duplicate: 	r1492	k[c] 	-&gt;	k[e] 
     Keep: 	PHEMEe	pheme[c] 	-&gt;	pheme[e] 
Duplicate: 	PHEMEt	pheme[e] 	-&gt;	pheme[c] 
     Keep: 	SPRMTDe	sprm[e] 	&lt;=&gt;	sprm[c] 
Duplicate: 	SPRMt2r	sprm[e] 	&lt;=&gt;	sprm[c] 
     Keep: 	BALABETAtc2	cala[e] 	&lt;=&gt;	cala[c] 
Duplicate: 	CALAtr	cala[e] 	&lt;=&gt;	cala[c] 
     Keep: 	CRTNtr	crtn[e] 	&lt;=&gt;	crtn[c] 
Duplicate: 	HMR_9619	crtn[e] 	-&gt;	crtn[c] 
     Keep: 	ALAPAT4te	ala_L[e] 	&lt;=&gt;	ala_L[c] 
Duplicate: 	ALAt2r	ala_L[e] 	&lt;=&gt;	ala_L[c] 
     Keep: 	PROPAT4te	pro_L[e] 	&lt;=&gt;	pro_L[c] 
Duplicate: 	PROt2r	pro_L[e] 	&lt;=&gt;	pro_L[c] 
     Keep: 	5AOPt	5aop[c] 	&lt;=&gt;	5aop[e] 
Duplicate: 	5AOPt2	5aop[e] 	-&gt;	5aop[c] 
     Keep: 	ABT_Dt	abt_D[e] 	&lt;=&gt;	abt_D[c] 
Duplicate: 	ABT_Dt2	abt_D[e] 	&lt;=&gt;	abt_D[c] 
     Keep: 	ELAIDCRNtd	elaidcrn[c] 	&lt;=&gt;	elaidcrn[e] 
Duplicate: 	ELAIDCRNtr	elaidcrn[e] 	&lt;=&gt;	elaidcrn[c] 
     Keep: 	HC02149td	pcrn[c] 	&lt;=&gt;	pcrn[e] 
Duplicate: 	PCRNtr	pcrn[e] 	&lt;=&gt;	pcrn[c] 
     Keep: 	LNLCCRNtd	lnlccrn[c] 	&lt;=&gt;	lnlccrn[e] 
Duplicate: 	LNLCCRNtr	lnlccrn[e] 	&lt;=&gt;	lnlccrn[c] 
     Keep: 	PCSsec	pcs[c] 	-&gt;	pcs[e] 
Duplicate: 	PCSup	pcs[e] 	-&gt;	pcs[c] 
     Keep: 	3HCINNMup	3hcinnm[e] 	-&gt;	3hcinnm[c] 
Duplicate: 	3HCINNMsec	3hcinnm[c] 	-&gt;	3hcinnm[e] 
     Keep: 	3HPPAup	3hppa[e] 	-&gt;	3hppa[c] 
Duplicate: 	3HPPAsec	3hppa[c] 	-&gt;	3hppa[e] 
     Keep: 	PACALDtm	pacald[c] 	&lt;=&gt;	pacald[m] 
Duplicate: 	HMR_4684	pacald[c] 	&lt;=&gt;	pacald[m] 
     Keep: 	ACNAMt2	acnam[e] 	-&gt;	acnam[c] 
Duplicate: 	ACNAMtr	acnam[c] 	-&gt;	acnam[e] 
     Keep: 	ETHAt	etha[e] 	&lt;=&gt;	etha[c] 
Duplicate: 	ETHAtr	etha[c] 	-&gt;	etha[e] 
     Keep: 	THMtrbc	thm[e] 	&lt;=&gt;	thm[c] 
Duplicate: 	THMt3	thm[e] 	&lt;=&gt;	thm[c] 
     Keep: 	BUTt2r	but[e] 	&lt;=&gt;	but[c] 
Duplicate: 	HMR_0155	but[e] 	&lt;=&gt;	but[c] 
     Keep: 	DIGALSGALSIDESECt	digalsgalside_hs[c] 	-&gt;	digalsgalside_hs[e] 
Duplicate: 	DIGALSGALSIDEt1e	digalsgalside_hs[e] 	-&gt;	digalsgalside_hs[c] 
     Keep: 	PAIL_hs_SECt	pail_hs[c] 	-&gt;	pail_hs[e] 
Duplicate: 	PAIL_hs_t1e	pail_hs[e] 	-&gt;	pail_hs[c] 
     Keep: 	PAILPALM_HSSECt	pailpalm_hs[c] 	-&gt;	pailpalm_hs[e] 
Duplicate: 	PAILPALM_HSt1e	pailpalm_hs[e] 	-&gt;	pailpalm_hs[c] 
     Keep: 	PAILR_HSSECt	pailar_hs[c] 	-&gt;	pailar_hs[e] 
Duplicate: 	PAILR_HSt1e	pailar_hs[e] 	-&gt;	pailar_hs[c] 
     Keep: 	PAILSTE_HSSECt	pailste_hs[c] 	-&gt;	pailste_hs[e] 
Duplicate: 	PAILSTE_HSt1e	pailste_hs[e] 	-&gt;	pailste_hs[c] 
     Keep: 	SPHMYLN180241_hs_SECt	sphmyln180241_hs[c] 	-&gt;	sphmyln180241_hs[e] 
Duplicate: 	SPHMYLN180241_hs_t1	sphmyln180241_hs[e] 	-&gt;	sphmyln180241_hs[c] 
     Keep: 	SPHMYLN18114_hs_SECt	sphmyln18114_hs[c] 	-&gt;	sphmyln18114_hs[e] 
Duplicate: 	SPHMYLN18114_hs_t1	sphmyln18114_hs[e] 	-&gt;	sphmyln18114_hs[c] 
     Keep: 	SPHMYLN18115_hs_SECt	sphmyln18115_hs[c] 	-&gt;	sphmyln18115_hs[e] 
Duplicate: 	SPHMYLN18115_hs_t1	sphmyln18115_hs[e] 	-&gt;	sphmyln18115_hs[c] 
     Keep: 	SPHMYLN18116_hs_SECt	sphmyln18116_hs[c] 	-&gt;	sphmyln18116_hs[e] 
Duplicate: 	SPHMYLN18116_hs_t1	sphmyln18116_hs[e] 	-&gt;	sphmyln18116_hs[c] 
     Keep: 	SPHMYLN181161_hs_SECt	sphmyln181161_hs[c] 	-&gt;	sphmyln181161_hs[e] 
Duplicate: 	SPHMYLN181161_hs_t1	sphmyln181161_hs[e] 	-&gt;	sphmyln181161_hs[c] 
     Keep: 	SPHMYLN18117_hs_SECt	sphmyln18117_hs[c] 	-&gt;	sphmyln18117_hs[e] 
Duplicate: 	SPHMYLN18117_hs_t1	sphmyln18117_hs[e] 	-&gt;	sphmyln18117_hs[c] 
     Keep: 	SPHMYLN18118_hs_SECt	sphmyln18118_hs[c] 	-&gt;	sphmyln18118_hs[e] 
Duplicate: 	SPHMYLN18118_hs_t1	sphmyln18118_hs[e] 	-&gt;	sphmyln18118_hs[c] 
     Keep: 	SPHMYLN181181_hs_SECt	sphmyln181181_hs[c] 	-&gt;	sphmyln181181_hs[e] 
Duplicate: 	SPHMYLN181181_hs_t1	sphmyln181181_hs[e] 	-&gt;	sphmyln181181_hs[c] 
     Keep: 	SPHMYLN18120_hs_SECt	sphmyln18120_hs[c] 	-&gt;	sphmyln18120_hs[e] 
Duplicate: 	SPHMYLN18120_hs_t1	sphmyln18120_hs[e] 	-&gt;	sphmyln18120_hs[c] 
     Keep: 	SPHMYLN181201_hs_SECt	sphmyln181201_hs[c] 	-&gt;	sphmyln181201_hs[e] 
Duplicate: 	SPHMYLN181201_hs_t1	sphmyln181201_hs[e] 	-&gt;	sphmyln181201_hs[c] 
     Keep: 	SPHMYLN18121_hs_SECt	sphmyln18121_hs[c] 	-&gt;	sphmyln18121_hs[e] 
Duplicate: 	SPHMYLN18121_hs_t1	sphmyln18121_hs[e] 	-&gt;	sphmyln18121_hs[c] 
     Keep: 	SPHMYLN18122_hs_SECt	sphmyln18122_hs[c] 	-&gt;	sphmyln18122_hs[e] 
Duplicate: 	SPHMYLN18122_hs_t1	sphmyln18122_hs[e] 	-&gt;	sphmyln18122_hs[c] 
     Keep: 	SPHMYLN181221_hs_SECt	sphmyln181221_hs[c] 	-&gt;	sphmyln181221_hs[e] 
Duplicate: 	SPHMYLN181221_hs_t1	sphmyln181221_hs[e] 	-&gt;	sphmyln181221_hs[c] 
     Keep: 	SPHMYLN18123_hs_SECt	sphmyln18123_hs[c] 	-&gt;	sphmyln18123_hs[e] 
Duplicate: 	SPHMYLN18123_hs_t1	sphmyln18123_hs[e] 	-&gt;	sphmyln18123_hs[c] 
     Keep: 	SPHMYLN1824_hs_SECt	sphmyln1824_hs[c] 	-&gt;	sphmyln1824_hs[e] 
Duplicate: 	SPHMYLN1824_hs_t1	sphmyln1824_hs[e] 	-&gt;	sphmyln1824_hs[c] 
     Keep: 	SPHMYLN1825_hs_SECt	sphmyln1825_hs[c] 	-&gt;	sphmyln1825_hs[e] 
Duplicate: 	SPHMYLN1825_hs_t1	sphmyln1825_hs[e] 	-&gt;	sphmyln1825_hs[c] 
     Keep: 	3AIBt1	3aib[e] 	&lt;=&gt;	3aib[c] 
Duplicate: 	HMR_8090	3aib[c] 	-&gt;	3aib[e] 
     Keep: 	2HXIC_Lt1e	2hxic_L[e] 	-&gt;	2hxic_L[c] 
Duplicate: 	2HXIC_Lt2e	2hxic_L[c] 	-&gt;	2hxic_L[e] 
     Keep: 	MMAt2e	mma[c] 	&lt;=&gt;	mma[e] 
Duplicate: 	MMAte	mma[e] 	&lt;=&gt;	mma[c] 
     Keep: 	CE4890te2	CE4890[c] 	&lt;=&gt;	CE4890[e] 
Duplicate: 	CE4890te	CE4890[c] 	&lt;=&gt;	CE4890[e] 
     Keep: 	MLTHFte	mlthf[e] 	-&gt;	mlthf[c] 
Duplicate: 	MLTHFte3	mlthf[e] 	-&gt;	mlthf[c] 
     Keep: 	TYMte2	tym[c] 	&lt;=&gt;	tym[e] 
Duplicate: 	TYMte	tym[c] 	&lt;=&gt;	tym[e] 
     Keep: 	1A25DHVITD3te	1a25dhvitd3[e] 	-&gt;	1a25dhvitd3[c] 
Duplicate: 	1A25DHVITD3t2e	1a25dhvitd3[c] 	-&gt;	1a25dhvitd3[e] 
     Keep: 	ORN_Dtx	orn_D[x] 	&lt;=&gt;	orn_D[c] 
Duplicate: 	HMR_9179	orn_D[c] 	&lt;=&gt;	orn_D[x] 
     Keep: 	ORN_Dte	orn_D[c] 	&lt;=&gt;	orn_D[e] 
Duplicate: 	HMR_9180	orn_D[c] 	&lt;=&gt;	orn_D[e] 
     Keep: 	HC00005te	HC00005[c] 	-&gt;	HC00005[e] 
Duplicate: 	HC00005t1e	HC00005[e] 	-&gt;	HC00005[c] 
     Keep: 	HC00006te	HC00006[c] 	-&gt;	HC00006[e] 
Duplicate: 	HC00006t1e	HC00006[e] 	-&gt;	HC00006[c] 
     Keep: 	HC00007te	HC00007[c] 	-&gt;	HC00007[e] 
Duplicate: 	HC00007t1e	HC00007[e] 	-&gt;	HC00007[c] 
     Keep: 	HC00008te	HC00008[c] 	-&gt;	HC00008[e] 
Duplicate: 	HC00008t1e	HC00008[e] 	-&gt;	HC00008[c] 
     Keep: 	HC00009te	HC00009[c] 	-&gt;	HC00009[e] 
Duplicate: 	HC00009t1e	HC00009[e] 	-&gt;	HC00009[c] 
     Keep: 	NO2te	no2[e] 	&lt;=&gt;	no2[c] 
Duplicate: 	HMR_6991	no2[c] 	&lt;=&gt;	no2[e] 
     Keep: 	HMR_0025	M01268[n] 	-&gt;	M01268[c] 
Duplicate: 	HMR_0030	M01268[c] 	-&gt;	M01268[n] 
     Keep: 	HMR_9581	M02035[c] 	&lt;=&gt;	M02035[e] 
Duplicate: 	HMR_9582	M02035[e] 	-&gt;	M02035[c] 
     Keep: 	HMR_9583	M02467[c] 	&lt;=&gt;	M02467[e] 
Duplicate: 	HMR_9584	M02467[e] 	-&gt;	M02467[c] 
     Keep: 	HMR_0031	0.0024 ak2gchol_hs[c] + 0.0008 dak2gpe_hs[c] + 0.0016 pail_hs[c] + 0.19 dag_hs[c] + 0.0092 pchol_hs[c] + 0.0034 pe_hs[c] + 0.005 chsterol[c] + 0.0006 lpchol_hs[c] + 0.0002 ps_hs[c] + 0.0004 sphmyln_hs[c] + 0.34 xolest2_hs[c] + 0.005 HC02065[c] + 0.44 M02958[c] + 0.0014 M00511[c] 	-&gt;	M02392[c] 
Duplicate: 	HMR_0032	M02392[c] 	-&gt;	0.0024 ak2gchol_hs[c] + 0.0008 dak2gpe_hs[c] + 0.0016 pail_hs[c] + 0.19 dag_hs[c] + 0.0092 pchol_hs[c] + 0.0034 pe_hs[c] + 0.005 chsterol[c] + 0.0006 lpchol_hs[c] + 0.0002 ps_hs[c] + 0.0004 sphmyln_hs[c] + 0.34 xolest2_hs[c] + 0.005 HC02065[c] + 0.44 M02958[c] + 0.0014 M00511[c] 
     Keep: 	ALLOP2tu	allop[e] 	-&gt;	allop[c] 
Duplicate: 	ALLOPtepvb	allop[e] 	&lt;=&gt;	allop[c] 
     Keep: 	ATVACIDMCTtu	atvacid[e] 	&lt;=&gt;	atvacid[c] 
Duplicate: 	ATVACIDtdu	atvacid[e] 	&lt;=&gt;	atvacid[c] 
     Keep: 	OXYPthc	oxyp[e] 	&lt;=&gt;	oxyp[c] 
Duplicate: 	OXYPtepv	oxyp[c] 	&lt;=&gt;	oxyp[e] 
     Keep: 	PVSHtu	pvs[e] 	&lt;=&gt;	pvs[c] 
Duplicate: 	PVStep	pvs[c] 	&lt;=&gt;	pvs[e] </div></div></div></div></div><div class = "S17"><span class = "S4">Remove any du</span><span class = "S4">plicate reactions from the stoichiometric matrix, but do not remove the protons.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">length</span><span class = "S13">(removedRxnInd)&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    irrevFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    metFlag=0;</span><span class = "S14">%dont remove the protons</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    model = removeRxns(model,model.rxns(removedRxnInd),irrevFlag,metFlag);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div></div><div class = "S17"><span class = "S4">Display statistics of the removed reactions</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    [nMet0,nRxn0]=size(modelOrig.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    [nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6s\t%6s\n'</span><span class = "S9">,</span><span class = "S12">'#mets'</span><span class = "S9">,</span><span class = "S12">'#rxns'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0,nRxn0,</span><span class = "S12">' totals.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0-nMet,nRxn0-nRxn,</span><span class = "S12">' duplicate reactions upto protons removed.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet,nRxn,</span><span class = "S12">' remaining.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="7E173EC3" data-testid="output_29" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"> #mets	 #rxns</div></div><div class="inlineElement embeddedOutputsTextElement" uid="2F5206D6" data-testid="output_30" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">  8399	 13543	 totals.</div></div><div class="inlineElement embeddedOutputsTextElement" uid="D94654DD" data-testid="output_31" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">     0	   253	 duplicate reactions upto protons removed.</div></div><div class="inlineElement embeddedOutputsTextElement" uid="979140B9" data-testid="output_32" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">  8399	 13290	 remaining.</div></div></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S14">%model size</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">[nMet,nRxn]=size(model.S);</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">Heuristically identify exc</span><span class = "S4">hange reactions and metabolites exclusively involved in exchange reactions</span></h2><div class = "S5"><span class = "S4">An </span><span class = "S4">external reacti</span><span class = "S4">on is one tha</span><span class = "S4">t is heuristically ide</span><span class = "S4">ntified by a </span><span class = "S4">s</span><span class = "S4">ingle stoichiometric coefficient in the corresponding column of </span><span class = "S4"> </span><span class = "S4">S, or an (abbreviated) reaction name matching a pattern (e.g. prefix EX_) or an external subsystem assignment. Any remaining reaction is assumed to be an internal reaction. If a reaction is not external then it is denoted an internal reaction. External reactants are exclusively involved in exchange reactions, and internal reactants otherwise. The findSExRxnInd function finds the external reactions in the model which export or import mass from or to the model, e.g. Exchange reactions, Demand reactions, Sink reactions.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">~isfield(model,</span><span class = "S12">'SIntMetBool'</span><span class = "S9">)  ||  ~isfield(model,</span><span class = "S12">'SIntRxnBool'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">     model = findSExRxnInd(model,[],printLevel-1);</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="918C949A" data-testid="output_33" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">Assuming biomass reaction is: biomass_reaction</div></div></div></div></div><h2 class = "S3"><span class = "S4">EXPECTED RESULTS</span></h2><div class = "S5"><span class = "S4">In </span><span class = "S4">the returned model, model.SIntRxnBool, is a boolean of reactions heuristically though to be mass balanced, while model.SIntMetBool is a boolean of metabolites heuristically though to be involved in mass balanced reactions.</span></div><h2 class = "S3"><span class = "S4">CAUTION</span></h2><div class = "S5"><span class = "S4">The aforementioned assignments of external and internal reactions and reactants is the result of a heuristic and might result in one or more errors, either due to misspecification or because the names of external reactions and external subsystems often vary between laboratories. </span></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">Find the reactions that are flux inconsistent </span></h2><div class = "S5"><span class = "S4">Ultimately we seek to identify the set of stoichiometrically consistent reactions that are also flux consistent, with no bounds on reaction rates. However, finiding the stoichiometrically consistent subset can be demanding for large models so first we identify the subset of reactions that are flux consistent and focus on them.</span></div><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">modelOrig=model;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">model.lb(~model.SIntRxnBool)=-1000;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">model.ub(~model.SIntRxnBool)= 1000;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S9">~isfield(model,</span><span class = "S12">'fluxConsistentMetBool'</span><span class = "S9">) || ~isfield(model,</span><span class = "S12">'fluxConsistentRxnBool'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        param.epsilon=1e-4;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        param.modeFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        param.method=</span><span class = "S12">'null_fastcc'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%param.method='fastcc';</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        [fluxConsistentMetBool,fluxConsistentRxnBool,</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fluxInConsistentMetBool,fluxInConsistentRxnBool,model]</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            = findFluxConsistentSubset(model,param,printLevel);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S14">% Remove reactions that are flux inconsistent</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">any(fluxInConsistentRxnBool)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        irrevFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        metFlag=1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        model = removeRxns(model,model.rxns(fluxInConsistentRxnBool),irrevFlag,metFlag);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [nMet0,nRxn0]=size(modelOrig.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'-------'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%6s\t%6s\n'</span><span class = "S9">,</span><span class = "S12">'#mets'</span><span class = "S9">,</span><span class = "S12">'#rxns'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0,nRxn0,</span><span class = "S12">' totals.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet0-nMet,nRxn0-nRxn,</span><span class = "S12">' flux inconsistent reactions removed.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet,nRxn,</span><span class = "S12">' remaining.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'-------'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S11">if </span><span class = "S13">printLevel&gt;1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                </span><span class = "S11">for </span><span class = "S13">n=1:nRxn0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                    </span><span class = "S11">if </span><span class = "S13">fluxInConsistentRxnBool(n)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                        fprintf(</span><span class = "S12">'%15s\t%-100s\n'</span><span class = "S13">,modelOrig.rxns{n},modelOrig.rxnNames{n})</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%revise model size</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%Recompute</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%Heuristically identify exchange reactions and metabolites exclusively involved in exchange reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%finds the reactions in the model which export/import from the model</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%boundary i.e. mass unbalanced reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%e.g. Exchange reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%     Demand reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%     Sink reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        model = findSExRxnInd(model,[],0);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'------end------'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsTextElement" uid="E0A0924D" data-testid="output_34" data-width="984" style="width: 1014px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"> 12164	Total reactions
  5970	Reversible reactions.
  6194	Irreversible reactions.
 11475	Flux consistent reactions, without flipping.
   290	Flux inconsistent irreversible reactions, without flipping.
   399	Flux inconsistent reactions, without flipping.
 11792	Flux consistent reactions.
    82	Flux inconsistent reversible reactions left to flip.
 11794	Flux consistent reactions.
    80	Flux inconsistent reversible reactions left to flip.
 11796	Flux consistent reactions.
    78	Flux inconsistent reversible reactions left to flip.
 11798	Flux consistent reactions.
    38	Flux inconsistent reversible reactions left to flip.</div></div></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">Fin</span><span class = "S4">d mas</span><span class = "S4">s leaks or siphons within the heuristically internal part, without using the bounds given by the model</span></h2><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    modelBoundsFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    leakParams.epsilon=1e-4;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    leakParams.method=</span><span class = "S12">'dc'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    leakParams.theta=0.5;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    [leakMetBool,leakRxnBool,siphonMetBool,siphonRxnBool,leakY,siphonY,statp,statn] =</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        findMassLeaksAndSiphons(model,model.SIntMetBool,model.SIntRxnBool,</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        modelBoundsFlag,leakParams,printLevel);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">Fin</span><span class = "S4">d the maximal set of reactions that are stoichiometrically consistent</span></h2><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S9">~isfield(model,</span><span class = "S12">'SConsistentMetBool'</span><span class = "S9">) || ~isfield(model,</span><span class = "S12">'SConsistentRxnBool'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S9">strcmp(model.modelID,</span><span class = "S12">'HMRdatabase2_00'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        massBalanceCheck=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">else</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        massBalanceCheck=1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        [SConsistentMetBool,SConsistentRxnBool,SInConsistentMetBool,SInConsistentRxnBool,unknownSConsistencyMetBool,unknownSConsistencyRxnBool,model]</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            =findStoichConsistentSubset(model,massBalanceCheck,printLevel);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">else</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%print out problematic reactions to file</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        resultsFileName</span><span class = "S9">=</span><span class = "S13">[resultsPath filesep model.modelID];</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        [SConsistentMetBool,SConsistentRxnBool,SInConsistentMetBool,SInConsistentRxnBool,unknownSConsistencyMetBool,unknownSConsistencyRxnBool,model]</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            =findStoichConsistentSubset(model,massBalanceCheck,printLevel,resultsFileName);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">rxnBool=model.SInConsistentRxnBool &amp; model.SIntRxnBool;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">any(rxnBool)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'Stoichiometrically inconsistent heuristically non-exchange reactions:'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">for </span><span class = "S13">n=1:nRxn</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">rxnBool(n)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%20s\t%50s\t%s\n'</span><span class = "S13">,model.rxns{n},model.rxnNames{n},model.subSystems{n})</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'--------------'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">    </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">rxnBool=model.unknownSConsistencyRxnBool &amp; model.SIntRxnBool;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S11">if </span><span class = "S13">any(rxnBool)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'Unknown consistency heuristically non-exchange reactions:'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">for </span><span class = "S13">n=1:nRxn</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">rxnBool(n)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%20s\t%50s\t%s\n'</span><span class = "S13">,model.rxns{n},model.rxnNames{n},model.subSystems{n})</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'--------------'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S15">end</span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S6"><span class = "S4">San</span><span class = "S4">ity check of stoichiometric and flux consistency of model</span><span class = "S4"> with open external reactions</span></h2><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S11">if</span><span class = "S9">  all(model.SIntMetBool &amp; model.SConsistentMetBool)</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            &amp;&amp; nnz(model.SIntRxnBool &amp; model.SConsistentRxnBool)==nnz(model.SIntRxnBool)</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            &amp;&amp; all(model.fluxConsistentMetBool)</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            &amp;&amp; all(model.fluxConsistentRxnBool)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [nMet,nRxn]=size(model.S);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">printLevel&gt;1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%6s\t%6s\n'</span><span class = "S9">,</span><span class = "S12">'#mets'</span><span class = "S9">,</span><span class = "S12">'#rxns'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nMet,nRxn,</span><span class = "S12">' totals.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nnz(~model.SIntMetBool),nnz(~model.SIntRxnBool),</span><span class = "S12">' heuristically exchange.'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        checksPassed=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%Check that all heuristically non-exchange reactions are also stoichiometrically consistent</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%exchange reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        model.EXRxnBool=strncmp(</span><span class = "S12">'EX_'</span><span class = "S13">, model.rxns, 3)==1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%demand reactions going out of model</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        model.DMRxnBool=strncmp(</span><span class = "S12">'DM_'</span><span class = "S13">, model.rxns, 3)==1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%sink reactions going into or out of model</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        model.SinkRxnBool=strncmp(</span><span class = "S12">'sink_'</span><span class = "S13">, model.rxns, 5)==1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%all heuristic non-exchanges, i.e., supposedly all external reactions</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        bool=~(model.EXRxnBool | model.DMRxnBool | model.SinkRxnBool);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">nnz(bool &amp; model.SIntRxnBool &amp; model.SConsistentRxnBool)==nnz(model.SConsistentRxnBool)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            checksPassed=checksPassed+1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S11">if </span><span class = "S13">printLevel&gt;1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nnz(model.SIntMetBool),nnz(model.SIntRxnBool),</span><span class = "S12">' All internally stoichiometrically consistent. (Check 1: minimum cardinality of conservation relaxation vector.)'</span><span class = "S13">);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%Check for mass leaks or siphons in the stoichiometrically consistent part</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%There should be no leaks or siphons in the stiochiometrically consistent part</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        modelBoundsFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        leakParams.epsilon=1e-4;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        leakParams.eta = getCobraSolverParams(</span><span class = "S12">'LP'</span><span class = "S9">, </span><span class = "S12">'feasTol'</span><span class = "S13">)*100;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        leakParams.method=</span><span class = "S12">'dc'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        [leakMetBool,leakRxnBool,siphonMetBool,siphonRxnBool,leakY,siphonY,statp,statn]</span><span class = "S15">...</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            =findMassLeaksAndSiphons(model,model.SConsistentMetBool,model.SConsistentRxnBool,modelBoundsFlag,leakParams,printLevel);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">nnz(leakMetBool)==0 &amp;&amp; nnz(leakRxnBool)==0 &amp;&amp; nnz(siphonMetBool)==0 &amp;&amp; nnz(siphonRxnBool)==0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            checksPassed=checksPassed+1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S11">if </span><span class = "S13">printLevel&gt;1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nnz(leakMetBool | siphonMetBool),nnz(leakRxnBool | siphonRxnBool),</span><span class = "S12">' No internal leaks or siphons. (Check 2: leak/siphon tests.)'</span><span class = "S13">);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%Check that the maximal conservation vector is nonzero for each the</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%internal stoichiometric matrix</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        maxCardinalityConsParams.epsilon=1e-4;</span><span class = "S14">%1/epsilon is the largest mass considered, needed for numerical stability</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        maxCardinalityConsParams.method = </span><span class = "S12">'quasiConcave'</span><span class = "S9">;</span><span class = "S14">%seems to work the best, but sometimes infeasible</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        maxCardinalityConsParams.theta = 0.5;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        maxCardinalityConsParams.eta=getCobraSolverParams(</span><span class = "S12">'LP'</span><span class = "S9">, </span><span class = "S12">'feasTol'</span><span class = "S13">)*100;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [maxConservationMetBool,maxConservationRxnBool,solution]=maxCardinalityConservationVector(model.S(model.SConsistentMetBool,model.SConsistentRxnBool), maxCardinalityConsParams);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">nnz(maxConservationMetBool)==size(model.S,1) &amp;&amp; nnz(maxConservationRxnBool)==nnz(model.SIntRxnBool)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            checksPassed=checksPassed+1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S11">if </span><span class = "S13">printLevel&gt;1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nnz(maxConservationMetBool),nnz(maxConservationRxnBool),</span><span class = "S12">' All internally stoichiometrically consistent. (Check 3: maximim cardinality conservation vector.)'</span><span class = "S13">);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S14">%Check that each of the reactions in the model (with open external reactions) is flux consistent</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        modelOpen=model;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        modelOpen.lb(~model.SIntRxnBool)=-1000;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        modelOpen.ub(~model.SIntRxnBool)= 1000;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        param.epsilon=1e-4;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        param.modeFlag=0;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        param.method=</span><span class = "S12">'null_fastcc'</span><span class = "S13">;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        [fluxConsistentMetBool,fluxConsistentRxnBool,fluxInConsistentMetBool,fluxInConsistentRxnBool,modelOpen] = findFluxConsistentSubset(modelOpen,param,printLevel-2);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">nnz(fluxConsistentMetBool)==size(model.S,1) &amp;&amp; nnz(fluxConsistentRxnBool)==size(model.S,2)</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            checksPassed=checksPassed+1;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S11">if </span><span class = "S13">printLevel&gt;1</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                fprintf(</span><span class = "S12">'%6u\t%6u\t%s\n'</span><span class = "S9">,nnz(fluxConsistentMetBool),nnz(fluxConsistentRxnBool),</span><span class = "S12">' All flux consistent. (Check 4: maximim cardinality constrained right nullspace.)'</span><span class = "S13">);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">        </span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S11">if </span><span class = "S13">checksPassed==4</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S14">%save the model with open exchanges as the default generic</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S14">%model</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S13">            model=modelOpen;</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S11">if </span><span class = "S13">printLevel&gt;0</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">                fprintf(</span><span class = "S12">'%s\n'</span><span class = "S9">,</span><span class = "S12">'Open external reactions is stoichiometrically and flux consistent. A flux balance model generated from a reconstruction. GREAT!!!!'</span><span class = "S13">);</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">            </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        </span><span class = "S15">end</span></div></div><div class = 'inlineWrapper'><div class = "S8 lineNode"><span class = "S9">        save([resultsFileName </span><span class = "S12">'_consistent.mat'</span><span class = "S9">],</span><span class = "S12">'model'</span><span class = "S13">)</span></div></div><div class = 'inlineWrapper outputs'><div class = "S8 lineNode"><span class = "S9">    </span><span class = "S15">end</span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement embeddedOutputsErrorElement" uid="DEAEDB4C" data-testid="output_35" data-width="984" style="width: 1014px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="diagnosticMessage-wrapper diagnosticMessage-errorType" style="white-space: normal; font-style: normal; color: rgb(230, 0, 0); font-size: 12px;"><div class="diagnosticMessage-messagePart" style="white-space: pre-wrap; font-style: normal; color: rgb(230, 0, 0); font-size: 12px;">Reference to non-existent field 'SConsistentMetBool'.</div><div class="diagnosticMessage-stackPart" style="white-space: pre; font-style: normal; color: rgb(230, 0, 0); font-size: 12px;"></div></div></div></div></div></div><h2 class = "S3"><span class = "S4">R</span><span class = "S4">EFE</span><span class = "S4">RENCES</span></h2><div class = "S5"><span class = "S4">Gevorgyan, A., Poolman, M. G., Fell D., Detection of stoichiometric inconsistencies in biomolecular models. Bioinformatics, 24(19):224551, 2008.</span></div><div class = "S5"><span class = "S4">Flem</span><span class = "S4">ing, R.M.T., et al., Cardinality optimisation in constraint-based modelling: Application to Recon 3D (submitted), 2017.</span></div><div class = "S5"><span class = "S4">Brunk, E. et al. Recon 3D: A resource enabling a three-dimensional view of gene variation in human metabolism. (submitted) 2017.</span></div></div></div>
<!-- 
##### SOURCE BEGIN #####
%% *Convert a reconstruction into a flux balance analysis model *
%% *Author: Ronan Fleming, Ines Thiele, University of Luxembourg*
%% *Reviewers: *
%% INTRODUCTION
% Even with quality control during the reconstruction process, it is not appropriate 
% to assume that any reconstruction can be converted directly into a model and 
% used to make predictions. A model must satisfy certain assumptions before it 
% can be used to make reliable predictions. Depending on the type of model model, 
% these assumptions will be different. Each assumption should be chemically or 
% biologically motivated and expressed in an unambiguous manner and preferably 
% both intuitively and mathematically. Flux balance analysis is a mathematical 
% method widely used for studying genome-scale biochemical network. Here one aims 
% to predict steady-state reaction fluxes, where there is a balance between production 
% and consumption of each molecular species that is not exchanged across the specified 
% boundary of a system. In this situation, one might obtain erroneous predictions 
% if the system boundary is incorrectly specified. If a reconstruction contains 
% one or more supposedly mass balanced reactions, but which are actually not mass 
% balanced, such reactions in a model can lead to inadvertent leakage of a metabolite 
% from the model, in violation of mass balance. Similarly, when generating a model 
% for flux balance analysis, it is important to ensure that the network is flux 
% consistent, that is, each reaction can carry a non-zero steady state flux. 
% 
% Given a reconstruction with $$\hat{m}$$ reactants involved in $$\hat{n}$$ 
% reactions, this tutorial demonstrates a method to identify and extract the largest 
% subset of the reconstruction whose internal reactions are both stoichoimetrically 
% and flux consistent and whose external reactions are flux consistent. This model 
% is then mathematically consistent with the basic requirements for generation 
% of predictions using flux balance analysis. The identification of the component 
% of the reconstruction that does not satisfy the aforementioned modelling conditions 
% is also useful for targeting reconstruction effort towards resolving stoichiometric 
% inconsistency or resolving flux inconsistency. The example used in this tutorial 
% illustrates the process of extracting a model consistent with flux balance analsis, 
% from a ReconX reconstruction.
%% PROCEDURE
%% Select reconstruction to convert into a model and enter parameters
% Load the ReconX reconstruction, and save the original reconstruction in the 
% workspace, unless it is already loaded into the workspace. 
%%
clear model
if ~exist('modelOrig','var')
    %select your own model, or use Recon2.0model instead
    if 1
        filename='Recon3D_301.mat'
        load(filename);
        model=Recon3D;
    else
        filename='Recon2.0model.mat';
        if exist('Recon2.0model.mat','file')==2
            model = readCbModel(filename);
        end
    end
    model.csense(1:size(model.S,1),1)='E';
    modelOrig = model;
else
    model=modelOrig;
end
%% 
% Set the level of printing, zero for silent, higher for more output.

printLevel=2;
%% 
% Choose the directory to place the results

basePath='~/work/sbgCloud/';
%resultsPath=[basePath '/programReconstruction/projects/recon2models/results/reconXs/' model.modelID];
resultsPath=[basePath '/courses/2019_Leiden_COBRA/practicalsDemo/Day4/' model.modelID];
resultsFileName=[resultsPath filesep model.modelID];
%% 
% Create and enter the folder for the results if it does not already exist

if ~exist(resultsPath,'dir')
    mkdir(resultsPath)
end
cd(resultsPath)
%% 
% Optionally create a diary to save the output in case it is very long, 
% this makes it easier to search, especially when debugging the process during 
% the early stages.

if 0
    diary([resultsFileName '_diary.txt'])
end
%% Overview some of the key properties of the reconstruction
% Noting the initial size of the reconstruction is useful for comparisons later 
% with subsets derived according to mathematical specifications.
%%
[nMet,nRxn]=size(model.S);
fprintf('%6s\t%6s\n','#mets','#rxns')
fprintf('%6u\t%6u\t%s\n',nMet,nRxn,' totals.')
%% 
% Make sure the stoichiometric matrix is stored in a sparse format as this 
% accelerates computations with large networks

model.S=sparse(model.S);
%% Check in case the reconstruction is a model that is already ready for flux balance analysis
% There is no need to run this live script any further if the reconstruction 
% already satisfies the conditions necessary for flux balance analysis. That is 
% if all internal reactants and reactions are stoichiometrically consistent, and 
% all reactions are flux consistent, then the reconstruction satisfies the criteria 
% to designate it a model ready for flux balance analysis.
% 
% SIntMetBool                     m x 1 Boolean of metabolites heuristically 
% though to be involved in mass balanced reactions.
% 
% SIntRxnBool                     n x 1 Boolean of reactions heuristically 
% though to be mass balanced.
% 
% SConsistentMetBool        m x 1 Boolean vector indicating consistent mets
% 
% SConsistentRxnBool        n x 1 Boolean vector indicating consistent rxns
% 
% fluxConsistentMetBool     m x 1 Boolean vector indicating flux consistent 
% mets
% 
% fluxConsistentRxnBool     n x 1 Boolean vector indicating flux consistent 
% rxns

if all(isfield(model,{'SIntMetBool','SIntRxnBool','SConsistentMetBool',...
        'SConsistentRxnBool','fluxConsistentMetBool','fluxConsistentRxnBool'}))
    if all(model.SIntMetBool & model.SConsistentMetBool)...
            && nnz(model.SIntRxnBool & model.SConsistentRxnBool)==nnz(model.SIntRxnBool)...
            && all(model.fluxConsistentMetBool)...
            && all(model.fluxConsistentRxnBool)
        fullyStoichAndFluxConsistent=1;
        fprintf('%s\n','Reconstruction is a model that is already ready for flux balance analysis')
    end
    return
else
    fullyStoichAndFluxConsistent=0;
    fprintf('%s\n','Reconstruction must be tested to check if it is ready for flux balance analysis')
end
%% Manually remove certain reactions from the reconstruction 
% Before attempting to algorithmically remove stoichiometrically or flux inconsistent 
% supposed internal reactions from a reconstruction to generate a model, there 
% is an option to review the content of the reconstruction and manually identify 
% reactions for removal. That is, there are two options:
% 
% A. Skip manual review of reconstruction content. Move to the next step.
% 
% B. Review the content of the reconstruction and omit any reactions that 
% are assumed to be stoichiometrically or flux inconsistent. With respect to stoichiometric 
% inconsistency, such reactions may be obviously mass imbalanced and not satisfy 
% the heuristic conditions for indentification as an exernal reaction. Alternatively, 
% such reactions may be identified by a previous pass through of this tutorial 
% as being of unknown stoichometric consistent (model.unknownSConsistencyRxnBool(j)==1), 
% after the largest stoichiometrically consistent subset of the network has been 
% is identified. This is an iterative process where multiple rounds of identification 
% of the largest stoichiometrically consistent set and manual curation of the 
% remainder that is of unknown stoichiometric consistency is necessary.

if strcmp(filename,'Recon3.0model')
    modelOrig=model;
    if 0
        if 1
            %Rename some of the biomass reactions to make them more obviously exchange
            %reactions
            model.rxns{strcmp(model.rxns,'biomass_reaction')}= 'EX_biomass_reaction';
            model.rxns{strcmp(model.rxns,'biomass_maintenance')}= 'EX_biomass_maintenance';
            model.rxns{strcmp(model.rxns,'biomass_maintenance_noTrTr')}= 'EX_biomass_maintenance_noTrTr';
            
            %ATP hydrolysis is not imbalanced like all the other demand reactions so
            %give it a different accronym ATPM = ATP Maintenance
            bool=strcmp('DM_atp_c_',model.rxns);
            model.rxns{bool}='ATPM';
        end
        [model,removeMetBool,removeRxnBool] = manuallyAdaptRecon3(model,printLevel);
    else
        [model,removeMetBool,removeRxnBool] = manuallyAdaptRecon3Ines(model,printLevel);
    end
    [nMet0,nRxn0]=size(modelOrig.S);
    [nMet,nRxn]=size(model.S);
    if nMet0==nMet && nRxn0==nRxn && printLevel>0
        fprintf('%s\n','REPLACE_WITH_DASH_DASH- Manually removing rows and columns of the stoichiometric matrixREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH')
        fprintf('%6s\t%6s\n','#mets','#rxns')
        fprintf('%6u\t%6u\t%s\n',nMet0,nRxn0,' totals.')
        fprintf('%6u\t%6u\t%s\n',nMet0-nMet,nRxn0-nRxn,' manually removed.')
        fprintf('%6u\t%6u\t%s\n',nMet,nRxn,' remaining.')
    end
end
%% Remove any trivial rows and columns of the stoichiometric matrix
% Remove any zero rows or columns of the stoichiometric matrix

modelOrig=model;
model=removeTrivialStoichiometry(model);
[nMet0,nRxn0]=size(modelOrig.S);
[nMet,nRxn]=size(model.S);
if nMet0==nMet && nRxn0==nRxn && printLevel>0
    fprintf('%s\n','REPLACE_WITH_DASH_DASH-Checking for Remove any trivial rows and columns of the stoichiometric matrixREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH')
    fprintf('%6s\t%6s\n','#mets','#rxns')
    fprintf('%6u\t%6u\t%s\n',nMet0,nRxn0,' totals.')
    fprintf('%6u\t%6u\t%s\n',nMet0-nMet,nRxn0-nRxn,' duplicates removed.')
    fprintf('%6u\t%6u\t%s\n',nMet,nRxn,' remaining.')
end
%% 
% Check for duplicate columns by detecting the columns of the  S matrix 
% that are identical upto scalar multiplication.
%%
modelOrig=model;
dupDetectMethod='FR';
dupDetectMethod='S';
removeFlag=0;
[modelOut,removedRxnInd, keptRxnInd] = checkDuplicateRxn(model,dupDetectMethod,removeFlag,printLevel-2);
%% 
% Remove any duplicate reactions, and uniquely involved reactants, from 
% the stoichiometric matrix. 

if length(removedRxnInd)>0
    irrevFlag=0;
    metFlag=1;
    %set all reactions reversible that are duplicates
    model.lb(removedRxnInd)=-model.ub(removedRxnInd);
    %remove duplicates
    model = removeRxns(model,model.rxns(removedRxnInd),irrevFlag,metFlag);
end
%% 
% Display the statistics on the duplicate reactions, 

[nMet0,nRxn0]=size(modelOrig.S);
[nMet,nRxn]=size(model.S);
if nMet0==nMet && nRxn0==nRxn && printLevel>0
    fprintf('%s\n','REPLACE_WITH_DASH_DASH-Remove any duplicate reactionsREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH')
    [nMet0,nRxn0]=size(modelOrig.S);
    [nMet,nRxn]=size(model.S);
    fprintf('%6s\t%6s\n','#mets','#rxns')
    fprintf('%6u\t%6u\t%s\n',nMet0,nRxn0,' totals.')
    fprintf('%6u\t%6u\t%s\n',nMet0-nMet,nRxn0-nRxn,' duplicates removed.')
    fprintf('%6u\t%6u\t%s\n',nMet,nRxn,' remaining.')
end
%% Remove any duplicate reactions upto protons
% Remove reactions reactions that differ only in the number of protons involved 
% as substrates or products. Also remove exclusively involved reactants.
% 
% Save a temporary model for testing, before making any changes.
%%
modelH=model;
%% 
% Find the proton indicies in different compartments. A proton, with index 
% i, is asumed to be represented by an abbreviation within model.mets{i} like 
% h[*], where * denotes the compartment symbol.

nMetChars=zeros(length(modelH.mets),1);
for m=1:length(modelH.mets)
    nMetChars(m,1)=length(modelH.mets{m});
end
protonMetBool=strncmp(modelH.mets,'h',1) & nMetChars==length('h[*]');
if printLevel>2
    disp(modelH.mets(protonMetBool))
end
%% 
%     Zero out the proton stoichiometric coefficients from the temporary 
% model for testing

modelH.S(protonMetBool,:)=0;
%% 
% Check for duplicate columns, upto protons, by detecting the columns of 
% the  S matrix that are identical upto scalar multiplication.

dupDetectMethod='FR';
removeFlag=0;
[modelOut,removedRxnInd, keptRxnInd] = checkDuplicateRxn(modelH,dupDetectMethod,removeFlag,printLevel-1);
%% 
% Remove any duplicate reactions from the stoichiometric matrix, but do 
% not remove the protons.

if length(removedRxnInd)>0
    irrevFlag=0;
    metFlag=0;%dont remove the protons
    model = removeRxns(model,model.rxns(removedRxnInd),irrevFlag,metFlag);
end
%% 
% Display statistics of the removed reactions

if printLevel>0
    [nMet0,nRxn0]=size(modelOrig.S);
    [nMet,nRxn]=size(model.S);
    fprintf('%6s\t%6s\n','#mets','#rxns')
    fprintf('%6u\t%6u\t%s\n',nMet0,nRxn0,' totals.')
    fprintf('%6u\t%6u\t%s\n',nMet0-nMet,nRxn0-nRxn,' duplicate reactions upto protons removed.')
    fprintf('%6u\t%6u\t%s\n',nMet,nRxn,' remaining.')
end
%model size
[nMet,nRxn]=size(model.S);
%% Heuristically identify exchange reactions and metabolites exclusively involved in exchange reactions
% An external reaction is one that is heuristically identified by a single stoichiometric 
% coefficient in the corresponding column of  S, or an (abbreviated) reaction 
% name matching a pattern (e.g. prefix EX_) or an external subsystem assignment. 
% Any remaining reaction is assumed to be an internal reaction. If a reaction 
% is not external then it is denoted an internal reaction. External reactants 
% are exclusively involved in exchange reactions, and internal reactants otherwise. 
% The findSExRxnInd function finds the external reactions in the model which export 
% or import mass from or to the model, e.g. Exchange reactions, Demand reactions, 
% Sink reactions.
%%
if ~isfield(model,'SIntMetBool')  ||  ~isfield(model,'SIntRxnBool')
     model = findSExRxnInd(model,[],printLevel-1);
end
%% EXPECTED RESULTS
% In the returned model, model.SIntRxnBool, is a boolean of reactions heuristically 
% though to be mass balanced, while model.SIntMetBool is a boolean of metabolites 
% heuristically though to be involved in mass balanced reactions.
%% CAUTION
% The aforementioned assignments of external and internal reactions and reactants 
% is the result of a heuristic and might result in one or more errors, either 
% due to misspecification or because the names of external reactions and external 
% subsystems often vary between laboratories. 
%% Find the reactions that are flux inconsistent 
% Ultimately we seek to identify the set of stoichiometrically consistent reactions 
% that are also flux consistent, with no bounds on reaction rates. However, finiding 
% the stoichiometrically consistent subset can be demanding for large models so 
% first we identify the subset of reactions that are flux consistent and focus 
% on them.
%%
modelOrig=model;
model.lb(~model.SIntRxnBool)=-1000;
model.ub(~model.SIntRxnBool)= 1000;
if 1
    if ~isfield(model,'fluxConsistentMetBool') || ~isfield(model,'fluxConsistentRxnBool')
        param.epsilon=1e-4;
        param.modeFlag=0;
        param.method='null_fastcc';
        %param.method='fastcc';
        [fluxConsistentMetBool,fluxConsistentRxnBool,...
            fluxInConsistentMetBool,fluxInConsistentRxnBool,model]...
            = findFluxConsistentSubset(model,param,printLevel);
    end
    % Remove reactions that are flux inconsistent
    if any(fluxInConsistentRxnBool)
        irrevFlag=0;
        metFlag=1;
        model = removeRxns(model,model.rxns(fluxInConsistentRxnBool),irrevFlag,metFlag);
        [nMet0,nRxn0]=size(modelOrig.S);
        [nMet,nRxn]=size(model.S);
        
        if printLevel>0
            fprintf('%s\n','REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-')
            fprintf('%6s\t%6s\n','#mets','#rxns')
            fprintf('%6u\t%6u\t%s\n',nMet0,nRxn0,' totals.')
            fprintf('%6u\t%6u\t%s\n',nMet0-nMet,nRxn0-nRxn,' flux inconsistent reactions removed.')
            fprintf('%6u\t%6u\t%s\n',nMet,nRxn,' remaining.')
            fprintf('%s\n','REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-')
            if printLevel>1
                for n=1:nRxn0
                    if fluxInConsistentRxnBool(n)
                        fprintf('%15s\t%-100s\n',modelOrig.rxns{n},modelOrig.rxnNames{n})
                    end
                end
            end
        end
        %revise model size
        [nMet,nRxn]=size(model.S);
        
        %Recompute
        %Heuristically identify exchange reactions and metabolites exclusively involved in exchange reactions
        %finds the reactions in the model which export/import from the model
        %boundary i.e. mass unbalanced reactions
        %e.g. Exchange reactions
        %     Demand reactions
        %     Sink reactions
        
        model = findSExRxnInd(model,[],0);
        if printLevel>0
            fprintf('%s\n','REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHendREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH')
        end
    end
end
%% Find mass leaks or siphons within the heuristically internal part, without using the bounds given by the model
%%
if 1
    modelBoundsFlag=0;
    leakParams.epsilon=1e-4;
    leakParams.method='dc';
    leakParams.theta=0.5;
    [leakMetBool,leakRxnBool,siphonMetBool,siphonRxnBool,leakY,siphonY,statp,statn] =...
        findMassLeaksAndSiphons(model,model.SIntMetBool,model.SIntRxnBool,...
        modelBoundsFlag,leakParams,printLevel);
end
%% Find the maximal set of reactions that are stoichiometrically consistent
%%
if ~isfield(model,'SConsistentMetBool') || ~isfield(model,'SConsistentRxnBool')
    if strcmp(model.modelID,'HMRdatabase2_00')
        massBalanceCheck=0;
    else
        massBalanceCheck=1;
    end
    if 1
        [SConsistentMetBool,SConsistentRxnBool,SInConsistentMetBool,SInConsistentRxnBool,unknownSConsistencyMetBool,unknownSConsistencyRxnBool,model]...
            =findStoichConsistentSubset(model,massBalanceCheck,printLevel);
    else
        %print out problematic reactions to file
        resultsFileName=[resultsPath filesep model.modelID];
        [SConsistentMetBool,SConsistentRxnBool,SInConsistentMetBool,SInConsistentRxnBool,unknownSConsistencyMetBool,unknownSConsistencyRxnBool,model]...
            =findStoichConsistentSubset(model,massBalanceCheck,printLevel,resultsFileName);
    end
end
    
rxnBool=model.SInConsistentRxnBool & model.SIntRxnBool;
if any(rxnBool)
    if printLevel>0
        fprintf('%s\n','Stoichiometrically inconsistent heuristically non-exchange reactions:')
    end
    for n=1:nRxn
        if rxnBool(n)
            fprintf('%20s\t%50s\t%s\n',model.rxns{n},model.rxnNames{n},model.subSystems{n})
        end
    end
    if printLevel>0
        fprintf('%s\n','REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH')
    end
end
    
rxnBool=model.unknownSConsistencyRxnBool & model.SIntRxnBool;
if any(rxnBool)
    if printLevel>0
        fprintf('%s\n','Unknown consistency heuristically non-exchange reactions:')
    end
    for n=1:nRxn
        if rxnBool(n)
            fprintf('%20s\t%50s\t%s\n',model.rxns{n},model.rxnNames{n},model.subSystems{n})
        end
    end
    if printLevel>0
        fprintf('%s\n','REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH')
    end
end
%% Sanity check of stoichiometric and flux consistency of model with open external reactions
%%
    if  all(model.SIntMetBool & model.SConsistentMetBool)...
            && nnz(model.SIntRxnBool & model.SConsistentRxnBool)==nnz(model.SIntRxnBool)...
            && all(model.fluxConsistentMetBool)...
            && all(model.fluxConsistentRxnBool)
        
        [nMet,nRxn]=size(model.S);
        if printLevel>1
            fprintf('%6s\t%6s\n','#mets','#rxns')
            fprintf('%6u\t%6u\t%s\n',nMet,nRxn,' totals.')
            fprintf('%6u\t%6u\t%s\n',nnz(~model.SIntMetBool),nnz(~model.SIntRxnBool),' heuristically exchange.')
        end
        
        checksPassed=0;
        %Check that all heuristically non-exchange reactions are also stoichiometrically consistent
        
        %exchange reactions
        model.EXRxnBool=strncmp('EX_', model.rxns, 3)==1;
        %demand reactions going out of model
        model.DMRxnBool=strncmp('DM_', model.rxns, 3)==1;
        %sink reactions going into or out of model
        model.SinkRxnBool=strncmp('sink_', model.rxns, 5)==1;
        %all heuristic non-exchanges, i.e., supposedly all external reactions
        bool=~(model.EXRxnBool | model.DMRxnBool | model.SinkRxnBool);
        if nnz(bool & model.SIntRxnBool & model.SConsistentRxnBool)==nnz(model.SConsistentRxnBool)
            checksPassed=checksPassed+1;
            if printLevel>1
                fprintf('%6u\t%6u\t%s\n',nnz(model.SIntMetBool),nnz(model.SIntRxnBool),' All internally stoichiometrically consistent. (Check 1: minimum cardinality of conservation relaxation vector.)');
            end
        end
        
        %Check for mass leaks or siphons in the stoichiometrically consistent part
        %There should be no leaks or siphons in the stiochiometrically consistent part
        modelBoundsFlag=0;
        leakParams.epsilon=1e-4;
        leakParams.eta = getCobraSolverParams('LP', 'feasTol')*100;
        leakParams.method='dc';
        [leakMetBool,leakRxnBool,siphonMetBool,siphonRxnBool,leakY,siphonY,statp,statn]...
            =findMassLeaksAndSiphons(model,model.SConsistentMetBool,model.SConsistentRxnBool,modelBoundsFlag,leakParams,printLevel);
        
        if nnz(leakMetBool)==0 && nnz(leakRxnBool)==0 && nnz(siphonMetBool)==0 && nnz(siphonRxnBool)==0
            checksPassed=checksPassed+1;
            if printLevel>1
                fprintf('%6u\t%6u\t%s\n',nnz(leakMetBool | siphonMetBool),nnz(leakRxnBool | siphonRxnBool),' No internal leaks or siphons. (Check 2: leak/siphon tests.)');
            end
        end
        
        %Check that the maximal conservation vector is nonzero for each the
        %internal stoichiometric matrix
        maxCardinalityConsParams.epsilon=1e-4;%1/epsilon is the largest mass considered, needed for numerical stability
        maxCardinalityConsParams.method = 'quasiConcave';%seems to work the best, but sometimes infeasible
        maxCardinalityConsParams.theta = 0.5;
        maxCardinalityConsParams.eta=getCobraSolverParams('LP', 'feasTol')*100;
        [maxConservationMetBool,maxConservationRxnBool,solution]=maxCardinalityConservationVector(model.S(model.SConsistentMetBool,model.SConsistentRxnBool), maxCardinalityConsParams);
        
        if nnz(maxConservationMetBool)==size(model.S,1) && nnz(maxConservationRxnBool)==nnz(model.SIntRxnBool)
            checksPassed=checksPassed+1;
            if printLevel>1
                fprintf('%6u\t%6u\t%s\n',nnz(maxConservationMetBool),nnz(maxConservationRxnBool),' All internally stoichiometrically consistent. (Check 3: maximim cardinality conservation vector.)');
            end
        end
        
        %Check that each of the reactions in the model (with open external reactions) is flux consistent
        modelOpen=model;
        modelOpen.lb(~model.SIntRxnBool)=-1000;
        modelOpen.ub(~model.SIntRxnBool)= 1000;
        param.epsilon=1e-4;
        param.modeFlag=0;
        param.method='null_fastcc';
        [fluxConsistentMetBool,fluxConsistentRxnBool,fluxInConsistentMetBool,fluxInConsistentRxnBool,modelOpen] = findFluxConsistentSubset(modelOpen,param,printLevel-2);
        
        if nnz(fluxConsistentMetBool)==size(model.S,1) && nnz(fluxConsistentRxnBool)==size(model.S,2)
            checksPassed=checksPassed+1;
            if printLevel>1
                fprintf('%6u\t%6u\t%s\n',nnz(fluxConsistentMetBool),nnz(fluxConsistentRxnBool),' All flux consistent. (Check 4: maximim cardinality constrained right nullspace.)');
            end
        end
        
        if checksPassed==4
            %save the model with open exchanges as the default generic
            %model
            model=modelOpen;
            if printLevel>0
                fprintf('%s\n','Open external reactions is stoichiometrically and flux consistent. A flux balance model generated from a reconstruction. GREAT!!!!');
            end
        end
        save([resultsFileName '_consistent.mat'],'model')
    end
%% REFERENCES
% Gevorgyan, A., Poolman, M. G., Fell D., Detection of stoichiometric inconsistencies 
% in biomolecular models. Bioinformatics, 24(19):224551, 2008.
% 
% Fleming, R.M.T., et al., Cardinality optimisation in constraint-based modelling: 
% Application to Recon 3D (submitted), 2017.
% 
% Brunk, E. et al. Recon 3D: A resource enabling a three-dimensional view 
% of gene variation in human metabolism. (submitted) 2017.
##### SOURCE END #####
--></body></html>