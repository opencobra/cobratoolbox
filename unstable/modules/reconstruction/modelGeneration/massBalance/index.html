

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>massBalance &mdash; The COBRA Toolbox</title>
  

  
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/cobra.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="The COBRA Toolbox" href="../../../../index.html"/>
        <link rel="up" title="modelGeneration" href="../index.html"/>
        <link rel="next" title="basicPhysicochemicalData" href="basicPhysicochemicalData/index.html"/>
        <link rel="prev" title="GREEDY" href="../fluxConsistency/GREEDY/index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>
  <link href="../../../../_static/css/easy-autocomplete.min.css" rel="stylesheet" type="text/css">
  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="../../../../_static/js/jquery.easy-autocomplete.min.js" type="text/javascript" ></script>
</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html">
          

          
            
            <img src="https://prince.lcsb.uni.lu/img/logos/logo.png" class="logo" />
          
          </a>
          <h1>The COBRA Toolbox</h1>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" id="simple"/>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
    <script>
    	var options = {

		url: "../../../../_static/json/functions.json",

		getValue: "name",

		list: {
            onKeyEnterEvent: function(item) {
                    return "_static/../" + item.website_url
            },
            maxNumberOfElements: 10,
			match: {
					enabled: true,
			},
            sort: {
			    enabled: true
		    }
		},

    	template: {
	    	type: "custom",
		    method: function(value, item) {
                return "<a href='../../../../search.html?q=" + item.name + "&check_keywords=yes&area=default'>" + value + "</a>" + "<a href='../../../../_static/../" + item.website_url + "' ><img src='../../../../_static/link.svg'/></a>";
		    }
	    },

		theme: "square"

	};

	$("#simple").easyAutocomplete(options);


    </script>
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../../../index.html">The COBRA Toolbox</a></li>
              </ul>
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Functions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../base/index.html">Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dataIntegration/index.html">Data integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design/index.html">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis/index.html">Analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Reconstruction</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../rBioNet/index.html">rBioNet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fastGapFill/index.html">fastGapFill</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../growthExpMatch/index.html">growthExpMatch</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">modelGeneration</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../fluxConsistency/index.html">fluxConsistency</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">massBalance</a><ul>
<li class="toctree-l5"><a class="reference internal" href="basicPhysicochemicalData/index.html">basicPhysicochemicalData</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../modelVerification/index.html">modelVerification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stoichConsistency/index.html">stoichConsistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../refinement/index.html">Refinement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../comparison/index.html">Comparison</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../visualization/index.html">Visualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cite.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../funding.html">Funding</a></li>
</ul>

          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">The COBRA Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Functions</a> &raquo;</li>
        
          <li><a href="../../index.html">Reconstruction</a> &raquo;</li>
        
          <li><a href="../index.html">modelGeneration</a> &raquo;</li>
        
      <li>massBalance</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="massbalance">
<span id="id1"></span><h1>massBalance<a class="headerlink" href="#massbalance" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="basicPhysicochemicalData/index.html">basicPhysicochemicalData</a></li>
</ul>
</div>
<span class="target" id="module-src.reconstruction.modelGeneration.massBalance"></span><dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.checkBalance">
<code class="descname">checkBalance</code><span class="sig-paren">(</span><em>model</em>, <em>element</em>, <em>printLevel</em>, <em>fileName</em>, <em>missingFormulaeBool</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/checkBalance.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.checkBalance" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks whether a set of reactions is elementally balanced.
Note that exchange reactions are not elementally balanced.</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[dE ,E, missingFormulaeBool] = checkBalance(model, element, printLevel, fileName, missingFormulaeBool)</div></blockquote>
<p><strong>Inputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
COBRA model structure:<ul>
<li>.S - Stoichiometric matrix</li>
<li>.metForumlas - Metabolite formulas</li>
</ul>
</li>
<li><strong>element</strong> &#8211;
Abbreviation of element e.g. C or Mg</li>
</ul>
</div></blockquote>
<p><strong>Optional inputs</strong></p>
<blockquote>
<div><ul>
<li><p class="first"><strong>printLevel</strong> &#8211;
{-1, (0), 1} where:</p>
<p>-1 = print out missing formulae to a file;
0 = silent;
1 = print out  missing formulae to screen reactions to screen</p>
</li>
<li><p class="first"><strong>fileName</strong> &#8211;
name of the file</p>
</li>
<li><p class="first"><strong>missingFormulaeBool</strong> &#8211;
boolean variable for missing formulae</p>
</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>dE</strong> &#8211;
<cite>n</cite> x 1 vector of net change in elements per reaction <cite>bal = E*S</cite>
If <cite>isnan(dE(n))</cite> then the reaction involves a metabolite without a formula.</li>
<li><strong>E</strong> &#8211;
<cite>m</cite> x 1 vector with number of elements in each metabolite</li>
<li><strong>missingFormulaeBool</strong> &#8211;
boolean variable for missing formulae</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.checkFormulaValidty">
<code class="descname">checkFormulaValidty</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/checkFormulaValidty.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.checkFormulaValidty" title="Permalink to this definition">¶</a></dt>
<dd><p>Assesses whether metabolites in model are likely to be documented in databases.</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[dbBool, noDocMets] = checkFormulaValidty(model)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
Model structure array</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>dbBool</strong> &#8211;
A boolean vector where the number of rows is equal to the number of
metabolites in model. Contains a logical 1 in rows for metabolites that
are likely to be documented in databases and a logical 0 elsewhere.</li>
<li><strong>noDocMets</strong> &#8211;
A cell array containing a list of all metabolites in model that
are not likely to be documented in any database.</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.checkMassChargeBalance">
<code class="descname">checkMassChargeBalance</code><span class="sig-paren">(</span><em>model</em>, <em>printLevel</em>, <em>fileName</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/checkMassChargeBalance.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.checkMassChargeBalance" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests for a list of reactions if these reactions are
mass-balanced by adding all elements on left hand side and comparing them
with the sums of elements on the right hand side of the reaction.
A reaction is considered elementally imbalanced if any of the molecular
species involved is missing a chemical formula.</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[massImbalance, imBalancedMass, imBalancedCharge, imBalancedRxnBool, Elements, missingFormulaeBool, balancedMetBool] = checkMassChargeBalance(model, printLevel, fileName)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
COBRA model structure:<ul>
<li>.S - <cite>m</cite> x <cite>n</cite> stoichiometric matrix</li>
<li>.metForumlas - <cite>m</cite> x 1 cell array of metabolite formulas</li>
<li>.metCharges - <cite>m</cite> x 1 double array of charges</li>
<li>model.SIntRxnBool - Boolean of reactions heuristically though to be mass balanced. (optional)</li>
</ul>
</li>
</ul>
</div></blockquote>
<p><strong>Optional inputs</strong></p>
<blockquote>
<div><ul>
<li><p class="first"><strong>printLevel</strong> &#8211;
{-1, (0), 1} where:</p>
<p>-1 = print out diagnostics on problem reactions to a file,
0 = silent,
1 = print elements as they are checked (display progress),
2 = also print out diagnostics on problem reactions to screen</p>
</li>
<li><p class="first"><strong>fileName</strong> &#8211;
name of the file</p>
</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>massImbalance</strong> &#8211;
<cite>nRxn</cite> x <cite>nElement</cite> matrix with mass imbalance
for each element checked. 0 if balanced.</li>
<li><strong>imBalancedMass</strong> &#8211;
<cite>nRxn</cite> x 1 cell with charge imbalance
e.g. -3 H means three hydrogens disappear in the reaction.</li>
<li><strong>imBalancedCharge</strong> &#8211;
<cite>nRxn</cite> x 1 vector with charge imbalance, empty if no imbalanced reactions</li>
<li><strong>imBalancedRxnBool</strong> &#8211;
boolean vector indicating imbalanced reactions (including exchange reactions!)</li>
<li><strong>Elements</strong> &#8211;
<cite>nElement</cite> x 1 cell array of element abbreviations checked</li>
<li><strong>missingFormulaeBool</strong> &#8211;
<cite>nMet</cite> x 1 boolean vector indicating metabolites without formulae</li>
<li><strong>balancedMetBool</strong> &#8211;
boolean vector indicating metabolites exclusively involved in balanced reactions</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.computeElementalMatrix">
<code class="descname">computeElementalMatrix</code><span class="sig-paren">(</span><em>model</em>, <em>metList</em>, <em>warnings</em>, <em>generalFormula</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/computeElementalMatrix.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.computeElementalMatrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes elemental matrix</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[Ematrix, element] = computeElementalMatrix(model, metList, warnings, generalFormula)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
COBRA model structure (must define <cite>.mets</cite> and <cite>.metFormulas</cite>)</li>
</ul>
</div></blockquote>
<p><strong>Optional inputs</strong></p>
<blockquote>
<div><ul>
<li><p class="first"><strong>metList</strong> &#8211;
Cell array of which metabolites to search for
(Default = all metabolites in model)</p>
</li>
<li><p class="first"><strong>warnings</strong> &#8211;
Display warnings if there are errors with the
formula. (Default = true)</p>
</li>
<li><p class="first"><strong>generalFormula</strong> &#8211;
* (default) false to return composition for  [C N O H P other] only.
* true to support formulae with brackets, decimal places and any chemical elements</p>
<blockquote>
<div><p>including undefined groups (e.g., &#8216;([H2O]2(CuSO4))2Generic_element0.5&#8217;).</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>Ematrix</strong> &#8211;
<cite>m x 6</cite> matrix of order [C N O H P other] if genericFormula = 0
<cite>m x e</cite> matrix if genericFormula = 1 given e elements in the chemical formulae</li>
<li><strong>elements</strong> &#8211;
cell array of elements corresponding to the columns of Ematrix</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.computeMW">
<code class="descname">computeMW</code><span class="sig-paren">(</span><em>model</em>, <em>metList</em>, <em>warnings</em>, <em>generalFormula</em>, <em>isotopeAbundance</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/computeMW.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.computeMW" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes molecular weight and elemental matrix of compounds</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[MW, Ematrix, elements, knownWeights, unknownElements] = computeMW(model, metList, warnings, generalFormula, isotopeAbundance)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
COBRA model structure (must define .mets and .metFormulas)</li>
</ul>
</div></blockquote>
<p><strong>Optional inputs</strong></p>
<blockquote>
<div><ul>
<li><p class="first"><strong>metList</strong> &#8211;
Cell array of which metabolites to search for. (Default = all metabolites in model)</p>
</li>
<li><p class="first"><strong>warnings</strong> &#8211;
Display warnings if there are errors with the formula. (Default = true)</p>
</li>
<li><p class="first"><strong>generalFormula</strong> &#8211;
* (default) false to calculate MWs for formulae containing consisting of common</p>
<blockquote>
<div><p>biological elements using their mass numbers (instead of the standard atomic mass)</p>
</div></blockquote>
<ul class="simple">
<li>true to support formulae with brackets, decimal places and any chemical elements
including undefined groups (e.g., &#8216;([H2O]2(CuSO4))2Generic_element0.5&#8217;).
MW = NaN for any formulae with chemical elements of unknown weights
except the reserved formula &#8216;Mass0&#8217; for denoting truly massless metabolites (e.g., photon)</li>
</ul>
</li>
<li><p class="first"><strong>(isotopeAbundance is used only if genericFormula = true)</strong></p>
</li>
<li><p class="first"><strong>isotopeAbundance</strong> &#8211;
* (default) false to use standard atomic weights
* true to use the weights of naturally predominant isotopes for biological</p>
<blockquote>
<div><p>elements and standard weights for other elements.</p>
</div></blockquote>
<ul class="simple">
<li><dl class="first docutils">
<dt><cite>m</cite> x 3 cell arrray with user defined isotope abundance:</dt>
<dd>isotopeAbundance{i, 1} = &#8216;Atomic_Symbol&#8217;;
isotopeAbundance{i, 2} = Mass_Number;
isotopeAbundance{i, 3} = abundance;
(where sum of abundances of all isotopes of an element must be one)</dd>
</dl>
</li>
</ul>
</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>MW</strong> &#8211;
Vector of molecular weights</li>
<li><strong>Ematrix</strong> &#8211;
* <cite>m</cite> x 6 matrix of order [C N O H P other] if genericFormula = false
* <cite>m</cite> x <cite>e</cite> matrix if genericFormula = true given <cite>e</cite> elements in the chemical formulae</li>
<li><strong>element</strong> &#8211;
cell array of elements corresponding to the columns of Ematrix</li>
<li><strong>(knownWeights and unknownElements are non-empty only if genericFormula = true)</strong></li>
<li><strong>knownWeights</strong> &#8211;
MWs for the part whose MW is computable ofr each of the formulae</li>
<li><strong>unknownElements</strong> &#8211;
cell arrary of elements without known atomic weights that appear in the formulae</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.computeMetFormulae">
<code class="descname">computeMetFormulae</code><span class="sig-paren">(</span><em>model</em>, <em>varargin</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/computeMetFormulae.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.computeMetFormulae" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the chemical formulas for metabolites without formulas using a set of metabolites with
known formulae by minimizing the overall inconsistency in elemental balance. They are combined with the
conserved moiety vectors identified from the left null space of S-matrix to return the general formulae.
Known formulae for all external mets (including sink/demand) suffice to infer the formulae for all
metabolites. More mets with known formulae will reveal more inconsistency in mass balance.
This is particularly useful for checking the molecular weight of the biomass produced in the model,
which should be curated to have MW = 1000 g/mol for prediction fidelity.
Metabolites that may have adjustable stoichiometries (e.g., H+, H2O) can be supplied to fill up inconsistency.</p>
<p><strong>Usage</strong></p>
<blockquote>
<div><dl class="docutils">
<dt>Find unknown chemical formulae for all metabolites:</dt>
<dd>[model, metFormulae, elements, metEle, rxnBal, S_fill, solInfo, LP] = computeMetFormulae(model, &#8216;parameter&#8217;, value, ... )</dd>
<dt>Find the min/max possible MW of a particular metabolite of interest:</dt>
<dd>[mwRange, metFormulae, elements, metEle, rxnBal, S_fill, solInfo, LP] = computeMetFormulae(model, &#8216;metMwRange&#8217;, met, ...)</dd>
<dt>Also support direct input in the following order:</dt>
<dd>[...] = computeMetFormulae(model, knownMets, balancedRxns, fillMets, calcCMs, nameCMs, deadCMs, metMwRange, LPparams, ...)</dd>
</dl>
</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
COBRA model</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>OPTIONAL INPUTS (support name-value argument input):</dt>
<dd><dl class="first docutils">
<dt>kownMets:       Known metabolites (cell array of strings or vector of met IDs)</dt>
<dd>[default all mets with nonempty .metFormulas]</dd>
<dt>balancedRxns:   The set of reactions for inferring formulae (cell array of strings or vector of rxn IDs)</dt>
<dd>[default all non-exchange reactions]</dd>
<dt>fillMets:       The chemical formulas for compounds for freely filling the imbalance, e.g. {&#8216;HCharge1&#8217;, &#8216;H2O&#8217;}.</dt>
<dd>&#8216;none&#8217; not to have any. [default &#8216;HCharge1&#8217; if charge info exists else &#8216;H&#8217;]</dd>
<dt>calcCMs:        Calculate conserved moieties from the left null space of S. Options:</dt>
<dd><ul class="first simple">
<li><dl class="first docutils">
<dt>&#8216;efmtool&#8217;: Use EFMtool (most comprehensive, recommanded, but computational</dt>
<dd>cost may be high if there are many deadend mets)</dd>
</dl>
</li>
<li>&#8216;null&#8217;:    Use the rational basis computed by Matlab</li>
<li><dl class="first docutils">
<dt>N:         Directly supply the matrix <span class="math">\(N\)</span> for conserved moieties</dt>
<dd>(from rational basis or the set of extreme rays)</dd>
</dl>
</li>
<li>false:     Not to find conserved moieties and return minimal formulae</li>
</ul>
<p class="last">[default &#8216;efmtool&#8217; if &#8216;CalculateFluxModes.m&#8217; is in path, else switch to &#8216;null&#8217;]</p>
</dd>
<dt>nameCMs:        Name the identified conserved moieties or not [default 0]</dt>
<dd><ul class="first last simple">
<li>0:  The program assigns default names for conserved moieties (Conserve_a, Conserve_b, ...)</li>
<li>1:  Name true conserved moieties interactively (exclude dead end mets).</li>
<li>2:  Name all interactively (including dead end)</li>
</ul>
</dd>
</dl>
<p>deadCMs:        true to include dead end metabolites when finding conserved moieties (default true)
metMwRange:     the metabolite of interest (or its ID) for which the range of possible molecular weights is determined</p>
<blockquote>
<div>(if supplied, inputs &#8216;fillMets&#8217;, ... , &#8216;deadCMs&#8217; are all not used)</div></blockquote>
<p class="last">LPparams:       Additional parameters for <cite>solveCobraLP</cite>. See <cite>solveCobraLP</cite> for details</p>
</dd>
</dl>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul>
<li><p class="first"><strong>model</strong> &#8211;
COBRA model with updated formulas and charges (1st output if &#8216;metMwRange&#8217; is not called)</p>
</li>
<li><p class="first"><strong>mwRange</strong> &#8211;
range for the MW of the metabolite of interest (1st output if &#8216;metMwRange&#8217; is called)</p>
</li>
<li><p class="first"><strong>metFormulae</strong> &#8211;
Formulae for unknown mets (#unknown mets x 2 cell array) if &#8216;metMwRange&#8217; is not called
Cell array of two chemical formulae for the min/max MW of the metabolite of interest if &#8216;metMwRange&#8217; is called</p>
</li>
<li><p class="first"><strong>elements</strong> &#8211;
Elements corresponding to the row of rxnBal, the coloumn of metEle</p>
</li>
<li><p class="first"><strong>metEle</strong> &#8211;
Chemical formulas in matrix (#metKnown x #elements)</p>
</li>
<li><p class="first"><strong>rxnBal</strong> &#8211;
Elemental balance of rxns (#elements x #rxns)</p>
</li>
<li><p class="first"><strong>S_fill</strong> &#8211;
Adjustment of the S-matrix by &#8216;metFill&#8217; (#metFill x #rxns in the input)</p>
</li>
<li><p class="first"><strong>solInfo</strong> &#8211;
Info for the solutions for each of the optimization problems solved:
* metUnknown:    mets whose formulae are being solved for (#met_unknown x 1 cell)
* metFill:       metabolite formulae used to automatically fill inconsistency
* rxns:          reactions with elemental balance imposed
* elements:      the chemical elements present in the model&#8217;s formulae.
* eleConnect:    connected components partitioning solInfo.elements (#elements x #components logical matrix).</p>
<blockquote>
<div><p>Elements in the same component mean that they are connected
by some &#8216;metFill&#8217; and are optimized in the same round.</p>
</div></blockquote>
<ul class="simple">
<li>metEleUnknown: the formulae found for unknown metabolites in different steps (#met_unknown x #elements)</li>
<li>S_fill:        solution for S_fill in each step</li>
<li>solEachEle:    structure of solutions, one for each connected componenets of elements</li>
<li>feasTol:       tolerance used to determine solution feasibility</li>
<li><dl class="first docutils">
<dt>stat:          minIncon/minFill/minForm/mixed/infeasible stating where the final solution metEleUnknwon</dt>
<dd>is obtained from. Ideally minForm if no numerical issue on feasibility.
(minIncon/minMw/maxMw/minMw &amp; maxMw if calling with option &#8216;metMwRange&#8217;)</dd>
</dl>
</li>
<li>N:             the minimal conserved moiety vectors</li>
</ul>
</li>
<li><p class="first"><strong>LP</strong> &#8211;
LP problem structure for solveCobraLP (#components x 1)</p>
</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.elementalMatrixToFormulae">
<code class="descname">elementalMatrixToFormulae</code><span class="sig-paren">(</span><em>Ematrix</em>, <em>elements</em>, <em>dMax</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/elementalMatrixToFormulae.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.elementalMatrixToFormulae" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the elemental composition matrix into chemical formulae</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>metForm = elementalMatrixToFormulae(elements, Ematrix, dMax)</div></blockquote>
<p><strong>Inputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>Ematrix</strong> &#8211;
elemental composition (<cite>M</cite> x <cite>E</cite> matrix) for <cite>M</cite> metabolites and <cite>E</cite> elements</li>
<li><strong>elements</strong> &#8211;
cell array of elements corresponding to the columns of Ematrix</li>
</ul>
</div></blockquote>
<p><strong>Optional input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>dMax</strong> &#8211;
the maximum number of decimal places for the stoichiometry (default 12)</li>
</ul>
</div></blockquote>
<p>Siu Hung Joshua Chan Nov 2016</p>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.findSExRxnInd">
<code class="descname">findSExRxnInd</code><span class="sig-paren">(</span><em>model</em>, <em>nRealMet</em>, <em>printLevel</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/findSExRxnInd.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.findSExRxnInd" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a model with boolean vectors indicating internal vs external (exchange/demand/sink) reactions.
Finds the reactions in the model which export/import from the model boundary</p>
<p>e.g. Exchange reactions,
Demand reactions,
Sink reactions</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>model = findSExRxnInd(model, nRealMet, printLevel)</div></blockquote>
<p>model.SIntRxnBool         Boolean of reactions heuristically though to be mass balanced.</p>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
structure with:<ul>
<li>model.biomassRxnAbbr - abbreviation of biomass reaction</li>
</ul>
</li>
</ul>
</div></blockquote>
<p><strong>Optional inputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>nRealMet</strong> &#8211;
specified in case extra rows in <cite>S</cite> which dont correspond to metabolties</li>
<li><strong>printLevel</strong> &#8211;
verbose level</li>
</ul>
</div></blockquote>
<p><strong>Output</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
structure with:<ul>
<li>.SIntRxnBool - Boolean of reactions heuristically though to be mass balanced.</li>
<li>.SIntMetBool - Boolean of metabolites heuristically though to be involved in mass balanced reactions.</li>
<li>.SOnlyIntMetBool - Boolean of metabolites heuristically though only to be involved in mass balanced reactions.</li>
<li>.SExMetBool - Boolean of metabolites heuristically though to be involved in mass imbalanced reactions.</li>
<li>.SOnlyExMetBool - Boolean of metabolites heuristically though only to be involved in mass imbalanced reactions.</li>
<li>.biomassBool - Boolean of biomass reaction</li>
<li>.DMRxnBool - Boolean of demand reactions. Prefix <cite>DM_</cite> (optional field)</li>
<li>.SinkRxnBool - Boolean of sink reactions. Prefix <cite>sink_</cite> (optional field)</li>
<li>.ExchRxnBool - Boolean of exchange reactions. Prefix <cite>EX_</cite> or <cite>Exch_</cite> or <cite>Ex_</cite> (optional field)</li>
</ul>
</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.getChargeFromInChI">
<code class="descname">getChargeFromInChI</code><span class="sig-paren">(</span><em>InChI</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/getChargeFromInChI.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.getChargeFromInChI" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the charge from a given InChI string</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[charge, chargeWithoutProtons] = getChargeFromInChI(InChI)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>InChI</strong> &#8211;
The Inchi Identifier - string</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>charge</strong> &#8211;
The charge encoded in the <cite>InChi</cite> string (including protonation)</li>
<li><strong>chargeWithoutProtons</strong> &#8211;
The charge encoded in the <cite>InChi</cite> ignoring the protonation state</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">InChI Charge is defined in the charge layer and can be modified in the
proton layer. If nothing is defined, the compound is uncharged.
First: Discard any &#8220;Reconnected&#8221; parts, as those don&#8217;t influence the
charge</p>
</div>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.getElementalComposition">
<code class="descname">getElementalComposition</code><span class="sig-paren">(</span><em>formulae</em>, <em>elements</em>, <em>chargeInFormula</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/getElementalComposition.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.getElementalComposition" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the complete elemental composition matrix. It supports formulae with
generic elements, parentheses and decimal places</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[Ematrix, elements] = getElementalComposition(formulae, elements, chargeInFormula)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>formulae</strong> &#8211;
cell array of strings of chemical formulae. Can contain any generic elements starting
with a capital letter followed by lowercase letters or &#8216;_&#8217;, followed by a non-negative number.
Also support &#8216;()&#8217;, &#8216;[]&#8217;, &#8216;{}&#8217;. E.g. {&#8216;H2O&#8217;; &#8216;[H2O]2(CuSO4)Generic_element0.5&#8217;}</li>
</ul>
</div></blockquote>
<p><strong>Optional inputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>elements</strong> &#8211;
elements from previous call to preserve the order (default {})</li>
<li><strong>chargeInFormula</strong> &#8211;
true to accept formulae containing the generic element &#8216;Charge&#8217; representing the charges,
followed by a real number, e.g., &#8216;HCharge1&#8217;, &#8216;SO4Charge-2&#8217; (default false).</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>Ematrix</strong> &#8211;
elemental composition matrix (#formulae x #elements)</li>
<li><strong>elements</strong> &#8211;
cell array of elements corresponding to the columns of Ematrix</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>E.g., [Ematrix, elements] = getElementalComposition({&#8216;H2O&#8217;; &#8216;[H2O]2(CuSO4)Generic_element0.5&#8217;}) would return:</dt>
<dd><p class="first">elements = {&#8216;H&#8217;, &#8216;O&#8217;, &#8216;Cu&#8217;, &#8216;S&#8217;, &#8216;Generic_element&#8217;}
Ematrix = [ 2,   1,    0,   0,   0;</p>
<blockquote class="last">
<div>4,   6,    1,   1,   0.5]</div></blockquote>
</dd>
</dl>
<p>Siu Hung Joshua Chan May 2017</p>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.getFormulaFromInChI">
<code class="descname">getFormulaFromInChI</code><span class="sig-paren">(</span><em>InChI</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/getFormulaFromInChI.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.getFormulaFromInChI" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts the chemical formula of a given compound from
the InChI string provided</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>[formula, protons] = getFormulaFromInChI(InChI)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>InChI</strong> &#8211;
The Inchi String of the chemical formula (e.g. InChI=
extract formula from <a href="#id2"><span class="problematic" id="id3">`</span></a>InChI = 1S/C3H4O3/c1-2(4)3(5)6/h1H3, (H,5,6)/p-1&#8217; for pyruvate</li>
</ul>
</div></blockquote>
<p><strong>Outputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>formula</strong> &#8211;
The chemical formula (including the protonation state</li>
<li><strong>protons</strong> &#8211;
The total number of protons</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.ispolymer">
<code class="descname">ispolymer</code><span class="sig-paren">(</span><em>formula</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/ispolymer.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.ispolymer" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks to see if a formula corresponds to a polymer</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>res = ispolymer(formula)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>formula</strong> &#8211;
formula to be checked</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.numAtomsOfElementInFormula">
<code class="descname">numAtomsOfElementInFormula</code><span class="sig-paren">(</span><em>formula</em>, <em>element</em>, <em>printLevel</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/numAtomsOfElementInFormula.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.numAtomsOfElementInFormula" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the number of atoms of a single element in a formula</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>N = numAtomsOfElementInFormula(formula, element, printLevel)</div></blockquote>
<p><strong>Inputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>formula</strong> &#8211;
formula in format Element then NumberOfAtoms with no spaces</li>
<li><strong>element</strong> &#8211;
Abbreviation of element e.g. C or Mg</li>
<li><strong>printLevel</strong> &#8211;
verbose level</li>
</ul>
</div></blockquote>
<p><strong>Output</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>N</strong> &#8211;
number of atoms of this element in the formula provided</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="src.reconstruction.modelGeneration.massBalance.pHbalanceProtons">
<code class="descname">pHbalanceProtons</code><span class="sig-paren">(</span><em>model</em>, <em>massImbalance</em>, <em>printLevel</em>, <em>fileName</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/opencobra/cobratoolbox/blob/19c17262396eceb51036c86aec13e8c59b51d0fe/src/reconstruction/modelGeneration/massBalance/pHbalanceProtons.m"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.reconstruction.modelGeneration.massBalance.pHbalanceProtons" title="Permalink to this definition">¶</a></dt>
<dd><p>Mass balance protons for each reaction by adjusting the hydrogen ion stoichiometric coefficient.</p>
<p>For each non transport reaction the proton stoichiometric coefficient for each
reaction is given by the difference between the sum of the average number
of protons bound by substrate reactants and the average number of protons
bound by product reactants</p>
<p>i.e. proton <cite>S_ij = sum(substrates(S_ij*aveHbound)) - sum(products(S_ij*aveHbound))</cite></p>
<p>For each transport reaction, model  transport across the membrane as three
reactions, one where non-proton reactants convert into non-proton metabolites
involved in one compartment,then in the other compartment, non-proton
metabolites convert into non-proton reactants. In between is a reconstruction
transport reaction which must be elementally balanced for <cite>H</cite> to begin
with. We assume that the transporter involved has affinity only for a particular
species of metabolite defined by the reconstrution.</p>
<p><strong>Usage</strong></p>
<blockquote>
<div>model = pHbalanceProtons(model, massImbalance, printLevel, fileName)</div></blockquote>
<p><strong>Input</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
structure with fields:<ul>
<li>model.S - stoichiometric matrix</li>
<li>model.mets - metabolites</li>
<li>model.SIntRxnBool - Boolean of internal reactions</li>
<li>model.aveHbound - average number of bound hydrogen ions</li>
<li>model.metFormulas - average number of bound hydrogen ions</li>
<li>model.metCharges - charge of metabolite species from reconstruction</li>
</ul>
</li>
</ul>
</div></blockquote>
<p><strong>Optional inputs</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>massImbalance</strong> &#8211;
<cite>nRxn</cite> x <cite>nElement</cite> matrix where <cite>massImbalance(i,j)</cite> is imbalance of
reaction <cite>i</cite> for element <cite>j</cite>. <cite>massImbalance(i,j) == 0</cite> if
balanced for that element. The first column is assumed
to correspond to <cite>H</cite> balancing.</li>
<li><strong>printLevel</strong> &#8211;
{(0), -2, -1, 0, 1, 2, 3) print more to file or more to the command window</li>
<li><strong>fileName</strong> &#8211;
name of the file to print out to</li>
</ul>
</div></blockquote>
<p><strong>Output</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>model</strong> &#8211;
structure containing:<ul>
<li>.S - Stoichiometric matrix balanced for protons where each row.
corresponds to a reactant at specific pH.</li>
<li>.Srecon - Stoichiometric matrix of the reconstruction</li>
</ul>
</li>
</ul>
</div></blockquote>
</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="basicPhysicochemicalData/index.html" class="btn btn-neutral float-right" title="basicPhysicochemicalData" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../fluxConsistency/GREEDY/index.html" class="btn btn-neutral" title="GREEDY" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, The COBRA Toolbox developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>