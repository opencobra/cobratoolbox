<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of maxstar</title>
  <meta name="keywords" content="maxstar">
  <meta name="description" content="maxstar   Log of a sum of exponentials.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html setupThermoModel --><!-- menu.html external -->
<h1>maxstar
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>maxstar   Log of a sum of exponentials.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function y = maxstar(x, w, dim) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> maxstar   Log of a sum of exponentials.
   For vectors, maxstar(x) is equivalent to log(sum(exp(x))).
   For matrices, maxstar(x) is a row vector and maxstar operates on 
   each column of x. For N-D arrays, maxstar(x) operates along the
   first non-singleton dimension.

   maxstar(x,w) is the log of a weighted sum of exponentials,
   equivalent to log(sum(w.*exp(x))). Vectors w and x must be
   the same length. For matrix x, the weights w can be input as
   a matrix the same size as x, or as a vector of the same length 
   as columns of x. Weights may be zero or negative, but the result
   sum(w.*exp(x)) must be greater than zero. 
   
   maxstar(x, [], dim) operates along the dimension dim, and has 
   the same dimensions as the MATLAB function max(x, [], dim).

   Note:
   The max* function is described in Lin &amp; Costello, Error Control
   Coding, 2nd Edition, equation 12.127, in the two-argument form
     max*(x1,x2) = max(x1,x2) + log(1 + exp(-abs(x1-x2))).
   The function max* can be applied iteratively: 
     max*(x1,x2,x3) = max*(max*(x1,x2),x3).
   Functions max(x) ~ max*(x), and min(x) ~ -max*(-x).

   Algorithm:
   The double precision MATLAB expresson log(sum(exp(x))) fails 
   if all(x &lt; -745), or if any(x &gt; 706). This is avoided using 
   m = max(x) in  max*(x) = m + log(sum(exp(x - m))).

   Example: If x = [2 8 4 
                    7 3 9]

   then maxstar(x,[],1) is [7.0067 8.0067 9.0067],

   and  maxstar(x,[],2) is [8.0206    
                            9.1291]. 

 2006-02-10   R. Dickson
 2006-03-25   Implemented N-D array features following a suggestion 
              from John D'Errico.
              
   Uses: max, log, exp, sum, shiftdim, repmat, size, zeros, ones,
         length, isempty, error, nargin, find, reshape</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../setupThermoModel/alberty/calcdGHT.html" class="code" title="function [dGf0,dHf0,mf,aveHbound,aveZi,lambda,gpfnsp]=calcdGHT(dGzero,dHzero,zi,nH,pHr,is,temp,chi,Legendre,LegendreCHI)">calcdGHT</a>	calculates the standard transformed Gibbs energy of a reactant</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function y = maxstar(x, w, dim)</a>
0002 <span class="comment">% maxstar   Log of a sum of exponentials.</span>
0003 <span class="comment">%   For vectors, maxstar(x) is equivalent to log(sum(exp(x))).</span>
0004 <span class="comment">%   For matrices, maxstar(x) is a row vector and maxstar operates on</span>
0005 <span class="comment">%   each column of x. For N-D arrays, maxstar(x) operates along the</span>
0006 <span class="comment">%   first non-singleton dimension.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%   maxstar(x,w) is the log of a weighted sum of exponentials,</span>
0009 <span class="comment">%   equivalent to log(sum(w.*exp(x))). Vectors w and x must be</span>
0010 <span class="comment">%   the same length. For matrix x, the weights w can be input as</span>
0011 <span class="comment">%   a matrix the same size as x, or as a vector of the same length</span>
0012 <span class="comment">%   as columns of x. Weights may be zero or negative, but the result</span>
0013 <span class="comment">%   sum(w.*exp(x)) must be greater than zero.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%   maxstar(x, [], dim) operates along the dimension dim, and has</span>
0016 <span class="comment">%   the same dimensions as the MATLAB function max(x, [], dim).</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%   Note:</span>
0019 <span class="comment">%   The max* function is described in Lin &amp; Costello, Error Control</span>
0020 <span class="comment">%   Coding, 2nd Edition, equation 12.127, in the two-argument form</span>
0021 <span class="comment">%     max*(x1,x2) = max(x1,x2) + log(1 + exp(-abs(x1-x2))).</span>
0022 <span class="comment">%   The function max* can be applied iteratively:</span>
0023 <span class="comment">%     max*(x1,x2,x3) = max*(max*(x1,x2),x3).</span>
0024 <span class="comment">%   Functions max(x) ~ max*(x), and min(x) ~ -max*(-x).</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   Algorithm:</span>
0027 <span class="comment">%   The double precision MATLAB expresson log(sum(exp(x))) fails</span>
0028 <span class="comment">%   if all(x &lt; -745), or if any(x &gt; 706). This is avoided using</span>
0029 <span class="comment">%   m = max(x) in  max*(x) = m + log(sum(exp(x - m))).</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%   Example: If x = [2 8 4</span>
0032 <span class="comment">%                    7 3 9]</span>
0033 <span class="comment">%</span>
0034 <span class="comment">%   then maxstar(x,[],1) is [7.0067 8.0067 9.0067],</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%   and  maxstar(x,[],2) is [8.0206</span>
0037 <span class="comment">%                            9.1291].</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% 2006-02-10   R. Dickson</span>
0040 <span class="comment">% 2006-03-25   Implemented N-D array features following a suggestion</span>
0041 <span class="comment">%              from John D'Errico.</span>
0042 <span class="comment">%</span>
0043 <span class="comment">%   Uses: max, log, exp, sum, shiftdim, repmat, size, zeros, ones,</span>
0044 <span class="comment">%         length, isempty, error, nargin, find, reshape</span>
0045 
0046 <span class="keyword">if</span> nargin &lt; 1 || nargin &gt; 3
0047     error(<span class="string">'Wrong number of input arguments.'</span>);
0048 <span class="keyword">end</span>
0049 
0050 [x, n] = shiftdim(x);
0051 szx = size(x); 
0052 
0053 <span class="keyword">switch</span> nargin
0054     <span class="keyword">case</span> 1
0055         w = [];
0056         dim = 1;
0057     <span class="keyword">case</span> 2 
0058         dim = 1;
0059     <span class="keyword">case</span> 3
0060         dim = dim - n;
0061 <span class="keyword">end</span>
0062 
0063 <span class="keyword">if</span> isempty(w)
0064     <span class="comment">% replicate m = max(x) to get mm, with size(mm) == size(x)</span>
0065     m = max(x,[],dim);
0066     szm = ones(size(szx));
0067     szm(dim) = szx(dim);
0068     mm = repmat(m,szm);
0069     y = m + log(sum(exp(x - mm), dim));
0070 <span class="keyword">else</span>
0071     w = shiftdim(w);
0072     szw = size(w);
0073     <span class="comment">% protect the second condition with a short-circuit or</span>
0074     <span class="keyword">if</span> ~(length(szw) == length(szx)) || ~all(szw == szx)
0075         <span class="keyword">if</span> size(w,1) == size(x,dim)
0076             <span class="comment">% replicate w with repmat so size(w) == size(x)</span>
0077             szw = ones(size(szx)); 
0078             szw(dim) = size(w,1);
0079             w = reshape(w, szw);
0080             szr = szx;
0081             szr(dim) = 1;
0082             w = repmat(w, szr);
0083         <span class="keyword">else</span>
0084             error(<span class="string">'Length of w must match size(x,dim).'</span>);
0085         <span class="keyword">end</span>
0086     <span class="keyword">end</span>
0087     
0088     <span class="comment">% Move the weight into the exponent xw and find</span>
0089     <span class="comment">% m = max(xw) over terms with positive weights</span>
0090     ipos = find(w&gt;0);
0091     xw = -Inf*zeros(szx);
0092     xw(ipos) = x(ipos) + log(w(ipos));
0093     m = max(xw,[],dim);
0094     <span class="comment">% replicate m with repmat so size(mm) == size(x)</span>
0095     szm = ones(size(szx));
0096     szm(dim) = szx(dim);
0097     mm = repmat(m,szm); 
0098     exwp = zeros(szx);
0099     exwp(ipos) = exp(xw(ipos)-mm(ipos));
0100     <span class="comment">% check for terms with negative weights</span>
0101     ineg = find(w&lt;0);
0102     <span class="keyword">if</span> ~isempty(ineg)
0103         exwn = zeros(szx);
0104         exwn(ineg) = exp(x(ineg) + log(-w(ineg)) - mm(ineg));
0105         y = m + log(sum(exwp, dim) - sum(exwn, dim));
0106     <span class="keyword">else</span>
0107         y = m + log(sum(exwp, dim));
0108     <span class="keyword">end</span>
0109 <span class="keyword">end</span>
0110 
0111</pre></div>
<hr><address>Generated on Fri 20-May-2011 17:06:05 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>