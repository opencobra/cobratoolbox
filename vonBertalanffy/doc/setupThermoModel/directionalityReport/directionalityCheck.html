<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of directionalityCheck</title>
  <meta name="keywords" content="directionalityCheck">
  <meta name="description" content="identification of metabolites involved in reactions with changed">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html setupThermoModel --><!-- menu.html directionalityReport -->
<h1>directionalityCheck
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>identification of metabolites involved in reactions with changed</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function directionalityCheck(model,directions,printToFile,printToTable) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">identification of metabolites involved in reactions with changed
directions

Check to see which metabolites are involved in reactions that change the
reconstruction directionality then print out the reactions that these
metabolites are involved in.
Does not include reactions that cannot be assigned reaction directionality
due to missing thermodynamic data for certain metabolites involved
in that reaction.

INPUT
 model

 directions          output of directionalityStats.m
 directions.fwdReconBool=fwdReconBool;
 directions.fwdReconBool=revReconBool;
 directions.fwdReconBool=reversibleReconBool;
 directions.fwdReconThermoBool=fwdReconThermoBool;
 directions.revReconThermoBool=revReconThermoBool;
 directions.reversibleReconThermoBool=reversibleReconThermoBool;
 directions.fwdThermoOnlyBool=fwdThermoOnlyBool;
 directions.revThermoOnlyBool=revThermoOnlyBool;
 directions.reversibleThermoOnlyBool=reversibleThermoOnlyBool;
%%add the changed directions 
 directions.ChangeForwardForwardBool_dGfGC=dGfGCforwardForwardBool;
 %changed directions
 directions.ChangeReversibleFwd=reversibleFwd;
 directions.ChangeReversibleRev=reversibleRev;
 directions.ChangeForwardReverse=forwardReverse;
%%all forward reversible classes
 directions.ChangeForwardReversible=forwardReversible;
 directions.ChangeForwardReversible_dGfKeq=forwardReversibleKeq;
 directions.ChangeForwardReversibleBool_dGfGC=dGfGCforwardReversibleBool;
 directions.ChangeForwardReversibleBool_dGfGC_byConcLHS=dGfGCforwardReversibleBool_byConcLHS;
 directions.ChangeForwardReversibleBool_dGfGC_byConcRHS=dGfGCforwardReversibleBool_byConcRHS;
 directions.ChangeForwardReversibleBool_dGfGC_bydGt0=dGfGCforwardReversibleBool_bydGt0;
 directions.ChangeForwardReversibleBool_dGfGC_bydGt0LHS=dGfGCforwardReversibleBool_bydGt0LHS;
 directions.ChangeForwardReversibleBool_dGfGC_bydGt0Mid=dGfGCforwardReversibleBool_bydGt0Mid;
 directions.ChangeForwardReversibleBool_dGfGC_bydGt0RHS=dGfGCforwardReversibleBool_bydGt0RHS;
 directions.ChangeForwardReversibleBool_dGfGC_byConc_No_dGt0ErrorLHS=dGfGCforwardReversibleBool_byConc_No_dGt0ErrorLHS;
 directions.ChangeForwardReversibleBool_dGfGC_byConc_No_dGt0ErrorRHS=dGfGCforwardReversibleBool_byConc_No_dGt0ErrorRHS;
 directions.cumNormProbCutoff

 printToFile         1=print to a structured file not the command line,
                       this is most useful for debugging reaction
                       directionality

 printToTable        1=print out a tab delimited tables of reaction directionality, and reactions
                       that change their directionality assignment along with another
                       table of metabolites involved in either relaxation of constraints,
                       or tightening of constraints.

Ronan M.T. Fleming</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="directionalityCheckAll.html" class="code" title="function directions=directionalityCheckAll(model,cumNormProbCutoff,thorStandard,printToFile,printToTable,figures)">directionalityCheckAll</a>	Analysis of differences between qualitative and quantiative directionality assignments.</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function directionalityCheck(model,directions,printToFile,printToTable)</a>
0002 <span class="comment">%identification of metabolites involved in reactions with changed</span>
0003 <span class="comment">%directions</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%Check to see which metabolites are involved in reactions that change the</span>
0006 <span class="comment">%reconstruction directionality then print out the reactions that these</span>
0007 <span class="comment">%metabolites are involved in.</span>
0008 <span class="comment">%Does not include reactions that cannot be assigned reaction directionality</span>
0009 <span class="comment">%due to missing thermodynamic data for certain metabolites involved</span>
0010 <span class="comment">%in that reaction.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%INPUT</span>
0013 <span class="comment">% model</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% directions          output of directionalityStats.m</span>
0016 <span class="comment">% directions.fwdReconBool=fwdReconBool;</span>
0017 <span class="comment">% directions.fwdReconBool=revReconBool;</span>
0018 <span class="comment">% directions.fwdReconBool=reversibleReconBool;</span>
0019 <span class="comment">% directions.fwdReconThermoBool=fwdReconThermoBool;</span>
0020 <span class="comment">% directions.revReconThermoBool=revReconThermoBool;</span>
0021 <span class="comment">% directions.reversibleReconThermoBool=reversibleReconThermoBool;</span>
0022 <span class="comment">% directions.fwdThermoOnlyBool=fwdThermoOnlyBool;</span>
0023 <span class="comment">% directions.revThermoOnlyBool=revThermoOnlyBool;</span>
0024 <span class="comment">% directions.reversibleThermoOnlyBool=reversibleThermoOnlyBool;</span>
0025 <span class="comment">%%%add the changed directions</span>
0026 <span class="comment">% directions.ChangeForwardForwardBool_dGfGC=dGfGCforwardForwardBool;</span>
0027 <span class="comment">% %changed directions</span>
0028 <span class="comment">% directions.ChangeReversibleFwd=reversibleFwd;</span>
0029 <span class="comment">% directions.ChangeReversibleRev=reversibleRev;</span>
0030 <span class="comment">% directions.ChangeForwardReverse=forwardReverse;</span>
0031 <span class="comment">%%%all forward reversible classes</span>
0032 <span class="comment">% directions.ChangeForwardReversible=forwardReversible;</span>
0033 <span class="comment">% directions.ChangeForwardReversible_dGfKeq=forwardReversibleKeq;</span>
0034 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC=dGfGCforwardReversibleBool;</span>
0035 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_byConcLHS=dGfGCforwardReversibleBool_byConcLHS;</span>
0036 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_byConcRHS=dGfGCforwardReversibleBool_byConcRHS;</span>
0037 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_bydGt0=dGfGCforwardReversibleBool_bydGt0;</span>
0038 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_bydGt0LHS=dGfGCforwardReversibleBool_bydGt0LHS;</span>
0039 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_bydGt0Mid=dGfGCforwardReversibleBool_bydGt0Mid;</span>
0040 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_bydGt0RHS=dGfGCforwardReversibleBool_bydGt0RHS;</span>
0041 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_byConc_No_dGt0ErrorLHS=dGfGCforwardReversibleBool_byConc_No_dGt0ErrorLHS;</span>
0042 <span class="comment">% directions.ChangeForwardReversibleBool_dGfGC_byConc_No_dGt0ErrorRHS=dGfGCforwardReversibleBool_byConc_No_dGt0ErrorRHS;</span>
0043 <span class="comment">% directions.cumNormProbCutoff</span>
0044 <span class="comment">%</span>
0045 <span class="comment">% printToFile         1=print to a structured file not the command line,</span>
0046 <span class="comment">%                       this is most useful for debugging reaction</span>
0047 <span class="comment">%                       directionality</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% printToTable        1=print out a tab delimited tables of reaction directionality, and reactions</span>
0050 <span class="comment">%                       that change their directionality assignment along with another</span>
0051 <span class="comment">%                       table of metabolites involved in either relaxation of constraints,</span>
0052 <span class="comment">%                       or tightening of constraints.</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%Ronan M.T. Fleming</span>
0055 [nMet,nRxn]=size(model.S);
0056 
0057 <span class="comment">%must be symmetric about 50:50 to be logically consistent</span>
0058 cumNormProbFwdUpper=0.5+directions.cumNormProbCutoff;
0059 cumNormProbFwdLower=0.5-directions.cumNormProbCutoff;
0060     
0061 <span class="comment">% different classes of reaction changes in one Boolean matrix</span>
0062 g=1;
0063 GB(g,:)=directions.ChangeReversibleFwd;
0064 changeString{g}=<span class="string">'qualitatively reversible -&gt; quantiatively forward'</span>;
0065 fileNameString{g}=<span class="string">'qualitatively_reversible_to_quantiatively_forward'</span>;
0066 g=g+1;
0067 GB(g,:)=directions.ChangeReversibleRev;
0068 changeString{g}=<span class="string">'qualitatively reversible -&gt; quantiatively reverse'</span>;
0069 fileNameString{g}=<span class="string">'qualitatively_reversible_to_quantiatively_reverse'</span>;
0070 g=g+1;
0071 GB(g,:)=directions.ChangeForwardReverse;
0072 changeString{g}=<span class="string">'qualitatively forward -&gt; quantiatively reverse'</span>;
0073 fileNameString{g}=<span class="string">'qualitatively_forward_to_quantiatively_reverse'</span>;
0074 g=g+1;
0075 
0076 <span class="comment">% forward reversible by Keq;</span>
0077 GB(g,:)=directions.ChangeForwardReversible_dGfKeq;
0078 changeString{g}=<span class="string">'qualitatively forward -&gt; quantiatively reversible  (dGft0 from Keq).'</span>;
0079 fileNameString{g}=<span class="string">'forward_to_reversible__dGft0_from_Keq'</span>;
0080 g=g+1;
0081 <span class="comment">% forward reversible by GC - 7 different classes</span>
0082 GB(g,:)=directions.ChangeForwardReversibleBool_dGfGC_byConcLHS;
0083 changeString{g}=<span class="string">'qualitatively  forward -&gt; quantiatively reversible by concentration (Negative dGt0 from GC, with uncertainty)'</span>;
0084 fileNameString{g}=<span class="string">'forward_to_reversible__negative_dGt0_from_GC_with_uncertainty'</span>;
0085 g=g+1;
0086 GB(g,:)=directions.ChangeForwardReversibleBool_dGfGC_byConcRHS;
0087 changeString{g}=<span class="string">'qualitatively  forward -&gt; quantiatively reversible by concentration (Positive dGt0 from GC, with uncertainty)'</span>;
0088 fileNameString{g}=<span class="string">'forward_to_reversible__positive_dGt0_from_GC_with_uncertainty'</span>;
0089 g=g+1;
0090 GB(g,:)=directions.ChangeForwardReversibleBool_dGfGC_bydGt0LHS;
0091 changeString{g}=[<span class="string">'qualitatively  forward -&gt; quantiatively reversible (dGt0 from GC estimates span the zero line). Forward with probability greater than '</span> num2str(cumNormProbFwdUpper) <span class="string">'. (Upper cutoff for probability of a reaction to be forward)'</span>];
0092 fileNameString{g}=<span class="string">'forward_to_reversible__dGft0_from_GC_spans_zero_probably_forward'</span>;
0093 g=g+1;
0094 GB(g,:)=directions.ChangeForwardReversibleBool_dGfGC_bydGt0Mid;
0095 changeString{g}=[<span class="string">'qualitatively  forward -&gt; quantiatively reversible (dGt0 from GC estimates span the zero line; Between '</span> num2str(cumNormProbFwdUpper) <span class="string">' and '</span> num2str(cumNormProbFwdLower) <span class="string">'probability of being forward'</span>];
0096 fileNameString{g}=<span class="string">'forward_to_reversible__dGft0_from_GC_spans_zero_possibly_reversible'</span>;
0097 g=g+1;
0098 GB(g,:)=directions.ChangeForwardReversibleBool_dGfGC_bydGt0RHS;
0099 changeString{g}=[<span class="string">'qualitatively  forward -&gt; quantiatively reversible (dGt0 from GC estimates span the zero line). Reverse with probability greater than '</span> num2str(1-cumNormProbFwdLower) <span class="string">'. (1 - Lower cutoff for probability of a reaction to be forward)'</span>];
0100 fileNameString{g}=<span class="string">'forward_to_reversible__dGft0_from_GC_spans_zero_probably_reverse'</span>;
0101 g=g+1;
0102 GB(g,:)=directions.ChangeForwardReversibleBool_dGfGC_byConc_No_dGt0ErrorLHS;
0103 changeString{g}=<span class="string">'qualitatively  forward -&gt; quantiatively reversible by concentration (Negative exact dGt0 from GC)'</span>;
0104 fileNameString{g}=<span class="string">'forward_to_reversible__negative_exact_dGt0_from_GC'</span>;
0105 g=g+1;
0106 GB(g,:)=directions.ChangeForwardReversibleBool_dGfGC_byConc_No_dGt0ErrorRHS;
0107 changeString{g}=<span class="string">'qualitatively  forward -&gt; quantiatively reversible by concentration (Positive exact dGt0 from GC)'</span>;
0108 fileNameString{g}=<span class="string">'forward_to_reversible__positive_exact_dGt0_from_GC'</span>;
0109 
0110 
0111 <span class="comment">%all possible compartments</span>
0112 p=1;
0113 compartments{p,1}=<span class="string">'c'</span>;
0114 compartments{p,2}=<span class="string">'cytoplasm'</span>;
0115 p=p+1;
0116 compartments{p,1}=<span class="string">'p'</span>;
0117 compartments{p,2}=<span class="string">'periplasm'</span>;
0118 p=p+1;
0119 compartments{p,1}=<span class="string">'e'</span>;
0120 compartments{p,2}=<span class="string">'extracellular'</span>;
0121 p=p+1;
0122 compartments{p,1}=<span class="string">'m'</span>;
0123 compartments{p,2}=<span class="string">'mitochondria'</span>;
0124 p=p+1;
0125 compartments{p,1}=<span class="string">'n'</span>;
0126 compartments{p,2}=<span class="string">'nucleus'</span>;
0127 p=p+1;
0128 compartments{p,1}=<span class="string">'r'</span>;
0129 compartments{p,2}=<span class="string">'endoplasmic reticulum'</span>;
0130 p=p+1;
0131 compartments{p,1}=<span class="string">'l'</span>;
0132 compartments{p,2}=<span class="string">'lysosome'</span>;
0133 p=p+1;
0134 compartments{p,1}=<span class="string">'x'</span>;
0135 compartments{p,2}=<span class="string">'peroxisome'</span>;
0136 
0137 <span class="comment">%set this value to one in order to get separate files for the different</span>
0138 <span class="comment">%types of changes</span>
0139 separateFiles=1;
0140 <span class="keyword">if</span> printToFile
0141 
0142     <span class="keyword">if</span> separateFiles==0
0143         fid=fopen(<span class="string">'changedDirections_StructuredView.txt'</span>,<span class="string">'w'</span>);
0144     <span class="keyword">end</span>
0145 
0146     <span class="comment">%gas constant times temperature</span>
0147     rt=model.gasConstant*model.temp;
0148    
0149     <span class="keyword">for</span> g=1:size(GB,1)
0150         <span class="keyword">if</span> separateFiles==1
0151             fid=fopen([fileNameString{g} <span class="string">'_StructuredView.txt'</span>],<span class="string">'w'</span>);
0152         <span class="keyword">else</span>
0153             <span class="keyword">if</span> g~=1
0154                 fprintf(fid,<span class="string">'\n'</span>);
0155             <span class="keyword">end</span>
0156         <span class="keyword">end</span>
0157         
0158         <span class="comment">%annotate file with important parameters</span>
0159         fprintf(fid,<span class="string">'%s\n'</span>,datestr(now));
0160         fprintf(fid,<span class="string">'%g\t%s\n'</span>,model.temp,<span class="string">':temperature 273.15 K to 313.15 K'</span>);
0161         <span class="keyword">for</span> p=1:length(compartments)
0162             <span class="keyword">if</span> isfield(model.PHA,compartments{p,1})
0163                 fprintf(fid,<span class="string">'%g\t%s%s%s%s%s\n'</span>,model.PHA.(compartments{p,1}),<span class="string">':['</span>,compartments{p,1},<span class="string">'] '</span>, compartments{p,1}, <span class="string">' glass electrode pH.'</span>);
0164             <span class="keyword">end</span>
0165         <span class="keyword">end</span>
0166         <span class="keyword">for</span> p=1:length(compartments)
0167             <span class="keyword">if</span> isfield(model.IS,compartments{p,1})
0168                 fprintf(fid,<span class="string">'%g\t%s%s%s%s%s\n'</span>,model.IS.(compartments{p,1}),<span class="string">':['</span>,compartments{p,1},<span class="string">'] '</span>, compartments{p,1}, <span class="string">' ionic strength.'</span>);
0169             <span class="keyword">end</span>
0170         <span class="keyword">end</span>
0171         <span class="keyword">for</span> p=1:length(compartments)
0172             <span class="keyword">if</span> isfield(model.CHI,compartments{p,1})
0173                 fprintf(fid,<span class="string">'%g\t%s%s%s%s%s\n'</span>,model.CHI.(compartments{p,1}),<span class="string">':['</span>,compartments{p,1},<span class="string">'] '</span>, compartments{p,1}, <span class="string">' electrical potential (mV).'</span>);
0174             <span class="keyword">end</span>
0175         <span class="keyword">end</span>
0176         fprintf(fid,<span class="string">'%g\t%s\n'</span>,cumNormProbFwdUpper,<span class="string">': Upper cutoff for probability of a reaction to be forward.'</span>);
0177         fprintf(fid,<span class="string">'%g\t%s\n'</span>,cumNormProbFwdLower,<span class="string">': Lower cutoff for probability of a reaction to be forward'</span>);
0178         fprintf(fid,<span class="string">'%g\t%s\n'</span>,model.nStdDevGroupCont,<span class="string">': # std. dev. of group contribution uncertainty'</span>);
0179         fprintf(fid,<span class="string">'\n'</span>);
0180     
0181         <span class="comment">%find the metabolites causing forward reactions to go in reverse</span>
0182         <span class="keyword">if</span> max(GB(g,:))==1
0183             Stmp=model.S(:,GB(g,:));
0184             tmpMet=zeros(nMet,1);
0185             <span class="keyword">for</span> m=1:nMet
0186                 tmpMet(m,1)=nnz(Stmp(m,:));
0187             <span class="keyword">end</span>
0188             <span class="comment">%print out the culprits in order of worst offender</span>
0189             [sorted,sInd]=sort(tmpMet,<span class="string">'descend'</span>);
0190             p=1;
0191             fprintf(fid,<span class="string">'%s\n'</span>,[<span class="string">'Metabolites which force '</span> int2str(nnz(GB(g,:))) <span class="string">' '</span> changeString{g}]);
0192             <span class="comment">%while tmpMet(sInd(p))&gt;0 &amp;&amp; p &lt;= length(sInd)</span>
0193             <span class="keyword">while</span> p &lt;= length(sInd) &amp;&amp; tmpMet(sInd(p))&gt;0
0194                 <span class="keyword">if</span> ~strcmp(model.met(sInd(p)).dGft0Source,<span class="string">'Keq'</span>)
0195                     dataSource=<span class="string">'gc'</span>;
0196                 <span class="keyword">else</span>
0197                     dataSource=<span class="string">'Keq'</span>;
0198                 <span class="keyword">end</span>
0199                 fprintf(fid,<span class="string">'%u%s\t%u\t%s\t%20s\t%s\n'</span>,sInd(p),<span class="string">':'</span>,tmpMet(sInd(p)),dataSource,model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);
0200                 p=p+1;
0201             <span class="keyword">end</span>
0202             fprintf(fid,<span class="string">'\n'</span>);
0203             fprintf(fid,<span class="string">'\n'</span>);
0204             
0205             <span class="comment">%print out for each problematic reaction</span>
0206             <span class="keyword">for</span> n=1:nRxn
0207                 <span class="keyword">if</span> GB(g,n)==1
0208                     fprintf(fid,<span class="string">'%i\t%s\t%s\t%6.2f\t%6.2f\n%s\n'</span>,n,model.rxn(n).officialName,model.rxn(n).abbreviation,model.rxn(n).dGtMin,model.rxn(n).dGtMax,<span class="string">'substrates:'</span>);
0209                     <span class="comment">%                 fprintf(fid,'%i\t%s\t%6.2f\t%6.2f\n\t%s\n',n,model.rxn(n).officialName,model.rxn(n).dGtMin,model.rxn(n).dGtMax,'substrates:');</span>
0210                     sInd=find(model.S(:,n)&lt;0);
0211                     <span class="keyword">for</span> p=1:length(sInd)
0212                         <span class="comment">%                 fprintf(fid,'\t\t%i\t\t%6.2f\t\t%6.2f\t%6.2f\t\t%i\t%s%s\n',model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),sInd(p),model.met(sInd(p)).officialName,[' ' model.met(sInd(p)).abbreviation(end-2:end)]);</span>
0213                         fprintf(fid,<span class="string">'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n'</span>,sInd(p),model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);
0214                     <span class="keyword">end</span>
0215                     fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'products:'</span>);
0216                     pInd=find(model.S(:,n)&gt;0);
0217                     <span class="keyword">for</span> p=1:length(pInd)
0218                         fprintf(fid,<span class="string">'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n'</span>,pInd(p),model.S(pInd(p),n),model.met(pInd(p)).dGft0,rt*log(model.met(pInd(p)).concMin),rt*log(model.met(pInd(p)).concMax),model.met(pInd(p)).abbreviation,model.met(pInd(p)).officialName);
0219                     <span class="keyword">end</span>
0220                     fprintf(fid,<span class="string">'\n'</span>);
0221                 <span class="keyword">end</span>
0222             <span class="keyword">end</span>
0223         <span class="keyword">end</span>
0224         <span class="comment">%close the separate files</span>
0225         <span class="keyword">if</span> separateFiles==1
0226             fclose(fid);
0227         <span class="keyword">end</span>
0228     <span class="keyword">end</span>
0229     <span class="keyword">if</span> separateFiles==0
0230         fclose(fid);
0231     <span class="keyword">end</span>
0232 <span class="keyword">end</span>
0233 
0234 <span class="comment">%set this value to 1 in order to get separate files for the different</span>
0235 <span class="comment">%types of changes</span>
0236 separateFiles=1;
0237 <span class="keyword">if</span> printToTable
0238     [nMet,nRxn]=size(model.S);
0239     
0240     <span class="comment">%print out each metabolite in turn</span>
0241     fid=fopen(<span class="string">'MetabolitesTab.txt'</span>,<span class="string">'w'</span>);
0242     fprintf(fid,<span class="string">'%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n'</span>,<span class="keyword">...</span>
0243         <span class="string">'Abbreviation'</span>,<span class="string">'Name'</span>,<span class="string">'dGft0Source'</span>,<span class="string">'AlbertyAbbreviation'</span>,<span class="string">'dGft0_Alberty'</span>,<span class="keyword">...</span>
0244         <span class="string">'dHft0_Alberty'</span>,<span class="string">'Average charge'</span>,<span class="string">'Average H bound'</span>,<span class="string">'dGf0_GroupCont'</span>,<span class="string">'dGft0_GroupCont'</span>,<span class="keyword">...</span>
0245         <span class="string">'dGft0_GroupContUncertainty'</span>,<span class="string">'chargeMarvin'</span>,<span class="string">'formulaMarvin'</span>);
0246     <span class="keyword">for</span> m=1:nMet
0247         <span class="keyword">if</span> strcmp(model.mets{m},<span class="string">'acorn[c]'</span>)
0248             pause(eps)
0249         <span class="keyword">end</span>
0250         <span class="comment">%round to one decimal place in tables</span>
0251         fprintf(fid,<span class="string">'%s\t%s\t%s\t%s\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\t%s'</span>,<span class="keyword">...</span>
0252             model.mets{m},<span class="keyword">...</span>
0253             model.met(m).officialName,<span class="keyword">...</span>
0254             model.met(m).dGft0Source,<span class="keyword">...</span>
0255             model.met(m).albertyAbbreviation,<span class="keyword">...</span>
0256             model.met(m).dGft0Keq,<span class="keyword">...</span>
0257             model.met(m).dHft0Keq,<span class="keyword">...</span>
0258             model.met(m).aveZi,<span class="keyword">...</span>
0259             model.met(m).aveHbound,<span class="keyword">...</span>
0260             model.met(m).dGf0GroupCont,<span class="keyword">...</span>
0261             model.met(m).dGft0GroupCont,<span class="keyword">...</span>
0262             model.met(m).dGft0GroupContUncertainty,<span class="keyword">...</span>
0263             model.met(m).chargeMarvin,<span class="keyword">...</span>
0264             model.met(m).formulaMarvin);
0265         fprintf(fid,<span class="string">'\n'</span>);
0266     <span class="keyword">end</span>
0267     fclose(fid);
0268     
0269     <span class="comment">%print out each reaction in turn and its directionality</span>
0270     fid=fopen(<span class="string">'ReactionsTab.txt'</span>,<span class="string">'w'</span>);
0271     fprintf(fid,<span class="string">'%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n'</span>,<span class="keyword">...</span>
0272         <span class="string">'Abbreviation'</span>,<span class="string">'Name'</span>,<span class="string">'Equation'</span>,<span class="string">'Qualitative Direction'</span>,<span class="string">'Quantitative direction (1st pass)'</span>,<span class="keyword">...</span>
0273         <span class="string">'dGt0Min'</span>,<span class="string">'dGt0Max'</span>,<span class="string">'dGtmMin'</span>,<span class="string">'dGtmMax'</span>,<span class="string">'dGtMin'</span>,<span class="string">'dGtMax'</span>);
0274     <span class="keyword">for</span> n=1:nRxn
0275         <span class="keyword">if</span> strcmp(model.rxns{n},<span class="string">'PNS1'</span>)
0276             pause(eps)
0277         <span class="keyword">end</span>
0278         <span class="comment">%round to one decimal place in tables</span>
0279         <span class="keyword">if</span> isfield(model.rxn(n),<span class="string">'dGtmMin'</span>)
0280             fprintf(fid,<span class="string">'%s\t%s\t%s\t%s\t%s\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\n'</span>,<span class="keyword">...</span>
0281                 model.rxns{n},<span class="keyword">...</span>
0282                 model.rxn(n).officialName,<span class="keyword">...</span>
0283                 model.rxn(n).equation,<span class="keyword">...</span>
0284                 model.rxn(n).directionality,<span class="keyword">...</span>
0285                 model.rxn(n).directionalityThermo,<span class="keyword">...</span>
0286                 model.rxn(n).dGt0Min,<span class="keyword">...</span>
0287                 model.rxn(n).dGt0Max,<span class="keyword">...</span>
0288                 model.rxn(n).dGtmMin,<span class="keyword">...</span>
0289                 model.rxn(n).dGtmMax,<span class="keyword">...</span>
0290                 model.rxn(n).dGtMin,<span class="keyword">...</span>
0291                 model.rxn(n).dGtMax);
0292         <span class="keyword">else</span>
0293                 fprintf(fid,<span class="string">'%s\t%s\t%s\t%s\t%s\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\t%.1f\n'</span>,<span class="keyword">...</span>
0294                 model.rxns{n},<span class="keyword">...</span>
0295                 model.rxn(n).officialName,<span class="keyword">...</span>
0296                 model.rxn(n).equation,<span class="keyword">...</span>
0297                 model.rxn(n).directionality,<span class="keyword">...</span>
0298                 model.rxn(n).directionalityThermo,<span class="keyword">...</span>
0299                 model.rxn(n).dGt0Min,<span class="keyword">...</span>
0300                 model.rxn(n).dGt0Max,<span class="keyword">...</span>
0301                 NaN,<span class="keyword">...</span>
0302                 NaN,<span class="keyword">...</span>
0303                 model.rxn(n).dGtMin,<span class="keyword">...</span>
0304                 model.rxn(n).dGtMax);
0305             
0306         <span class="keyword">end</span>
0307     <span class="keyword">end</span>
0308     fclose(fid);
0309     
0310     <span class="keyword">if</span> separateFiles==0
0311         fid=fopen(<span class="string">'reactionDirectionalityChangesTab.txt'</span>,<span class="string">'w'</span>);
0312     <span class="keyword">end</span>
0313     
0314     <span class="keyword">for</span> g=1:size(GB,1)
0315         <span class="keyword">if</span> separateFiles==1
0316             fid=fopen([fileNameString{g} <span class="string">'.txt'</span>],<span class="string">'w'</span>);
0317         <span class="keyword">else</span>
0318             <span class="keyword">if</span> g~=1
0319                 fprintf(fid,<span class="string">'\n'</span>);
0320             <span class="keyword">end</span>
0321         <span class="keyword">end</span>
0322         
0323         <span class="comment">%annotate file with important parameters</span>
0324         fprintf(fid,<span class="string">'%s\n'</span>,datestr(now));
0325         fprintf(fid,<span class="string">'%g\t%s\n'</span>,model.temp,<span class="string">':temperature 273.15 K to 313.15 K'</span>);
0326         <span class="keyword">for</span> p=1:length(compartments)
0327             <span class="keyword">if</span> isfield(model.PHA,compartments{p,1})
0328                 fprintf(fid,<span class="string">'%g\t%s%s%s%s%s\n'</span>,model.PHA.(compartments{p,1}),<span class="string">':['</span>,compartments{p,1},<span class="string">'] '</span>, compartments{p,1}, <span class="string">' glass electrode pH.'</span>);
0329             <span class="keyword">end</span>
0330         <span class="keyword">end</span>
0331         <span class="keyword">for</span> p=1:length(compartments)
0332             <span class="keyword">if</span> isfield(model.IS,compartments{p,1})
0333                 fprintf(fid,<span class="string">'%g\t%s%s%s%s%s\n'</span>,model.IS.(compartments{p,1}),<span class="string">':['</span>,compartments{p,1},<span class="string">'] '</span>, compartments{p,1}, <span class="string">' ionic strength.'</span>);
0334             <span class="keyword">end</span>
0335         <span class="keyword">end</span>
0336         <span class="keyword">for</span> p=1:length(compartments)
0337             <span class="keyword">if</span> isfield(model.CHI,compartments{p,1})
0338                 fprintf(fid,<span class="string">'%g\t%s%s%s%s%s\n'</span>,model.CHI.(compartments{p,1}),<span class="string">':['</span>,compartments{p,1},<span class="string">'] '</span>, compartments{p,1}, <span class="string">'electrical potential (mV).'</span>);
0339             <span class="keyword">end</span>
0340         <span class="keyword">end</span>
0341         fprintf(fid,<span class="string">'%g\t%s\n'</span>,cumNormProbFwdUpper,<span class="string">': Upper cutoff for probability of a reaction to be forward.'</span>);
0342         fprintf(fid,<span class="string">'%g\t%s\n'</span>,cumNormProbFwdLower,<span class="string">': Lower cutoff for probability of a reaction to be forward'</span>);
0343         fprintf(fid,<span class="string">'%g\t%s\n'</span>,model.nStdDevGroupCont,<span class="string">': # std. dev. of group contribution uncertainty'</span>);
0344         fprintf(fid,<span class="string">'\n'</span>);
0345         
0346         <span class="comment">%reactions</span>
0347         <span class="keyword">for</span> n=1:nRxn
0348             <span class="keyword">if</span> GB(g,n)==1
0349                 fprintf(fid,<span class="string">'%s\t%s\t%.1f\t%.1f\t%.1f\t%.1f\n'</span>,model.rxn(n).officialName,model.rxn(n).equation,model.rxn(n).dGt0Min,model.rxn(n).dGt0Max,model.rxn(n).dGtMin,model.rxn(n).dGtMax);
0350             <span class="keyword">end</span>
0351         <span class="keyword">end</span>
0352         fprintf(fid,<span class="string">'\n'</span>);
0353         
0354         <span class="comment">%metabolites</span>
0355         fprintf(fid,<span class="string">'%s\n'</span>,<span class="string">'Cytoplasmic metabolites only:'</span>);
0356         allMetSum=sum(abs(model.S(:,GB(g,:))),2);
0357         <span class="keyword">for</span> m=1:nMet
0358             <span class="comment">%only cytoplasmic metabolites to avoid duplicates</span>
0359             <span class="keyword">if</span> allMetSum(m)&gt;0 &amp;&amp; strcmp(model.met(m).abbreviation(end-2:end),<span class="string">'[c]'</span>)
0360                 fprintf(fid,<span class="string">'%d\t%s\t%s\t%.1f\t%.1f\t%.1f\t%s\n'</span>,allMetSum(m),model.met(m).abbreviation(1:end-3),model.met(m).officialName,model.met(m).dGft0Keq,model.met(m).dGft0GroupCont,model.met(m).dGft0GroupContUncertainty,model.met(m).dGft0Source);
0361             <span class="keyword">end</span>
0362         <span class="keyword">end</span>
0363         
0364         <span class="keyword">if</span> separateFiles==1
0365             fclose(fid);
0366         <span class="keyword">end</span>
0367     <span class="keyword">end</span>
0368     <span class="keyword">if</span> separateFiles==0
0369         fclose(fid);
0370     <span class="keyword">end</span>
0371 <span class="keyword">end</span>
0372 
0373 
0374 <span class="comment">% %finds the qualitatively forward reactions that are now reversible</span>
0375 <span class="comment">% %where the reaction exclusively involves metabolites with</span>
0376 <span class="comment">% %dGf0 back calculated from keq</span>
0377 <span class="comment">% dGft0SourceKeqBool=false(nMet,1);</span>
0378 <span class="comment">% for m=1:nMet</span>
0379 <span class="comment">%     if strcmp(model.met(m).dGft0Source,'Keq')</span>
0380 <span class="comment">%         dGft0SourceKeqBool(m,1)=1;</span>
0381 <span class="comment">%     end</span>
0382 <span class="comment">% end</span>
0383 <span class="comment">% forwardReversibleKeq=false(nRxn,1);</span>
0384 <span class="comment">% for n=1:nRxn</span>
0385 <span class="comment">%     if changedDirections.forwardReversible(n)</span>
0386 <span class="comment">%         ind=find(model.S(:,n));</span>
0387 <span class="comment">%         %finds the reactions with changed direction, exclusively involving</span>
0388 <span class="comment">%         %metabolites with dGf0 back calculated from keq</span>
0389 <span class="comment">%         if sum(dGft0SourceKeqBool(ind))==length(ind)</span>
0390 <span class="comment">%             forwardReversibleKeq(n)=1;</span>
0391 <span class="comment">%         end</span>
0392 <span class="comment">%     end</span>
0393 <span class="comment">% end</span>
0394 <span class="comment">%</span>
0395 <span class="comment">% fprintf(fid,'\n');</span>
0396 <span class="comment">% for n=1:nRxn</span>
0397 <span class="comment">%     if forwardReversibleKeq(n)</span>
0398 <span class="comment">%         fprintf(fid,'%s\t%s\t%g\t%g\t%g\t%g\n',model.rxn(n).officialName,model.rxn(n).equation,model.rxn(n).dGt0Min,model.rxn(n).dGt0Max,model.rxn(n).dGtMin,model.rxn(n).dGtMax);</span>
0399 <span class="comment">%     end</span>
0400 <span class="comment">% end</span>
0401 <span class="comment">% fprintf(fid,'\n');</span>
0402 <span class="comment">% for n=1:nRxn</span>
0403 <span class="comment">%     if changedDirections.reversibleFwd(n)</span>
0404 <span class="comment">%         fprintf(fid,'%s\t%s\t%g\t%g\t%g\t%g\n',model.rxn(n).officialName,model.rxn(n).equation,model.rxn(n).dGt0Min,model.rxn(n).dGt0Max,model.rxn(n).dGtMin,model.rxn(n).dGtMax);</span>
0405 <span class="comment">%     end</span>
0406 <span class="comment">% end</span>
0407 <span class="comment">% fprintf(fid,'\n');</span>
0408 <span class="comment">% for n=1:nRxn</span>
0409 <span class="comment">%     if changedDirections.reversibleRev(n)</span>
0410 <span class="comment">%         fprintf(fid,'%s\t%s\t%g\t%g\t%g\t%g\n',model.rxn(n).officialName,model.rxn(n).equation,model.rxn(n).dGt0Min,model.rxn(n).dGt0Max,model.rxn(n).dGtMin,model.rxn(n).dGtMax);</span>
0411 <span class="comment">%     end</span>
0412 <span class="comment">% end</span>
0413 <span class="comment">% fprintf(fid,'\n');</span>
0414 <span class="comment">% for n=1:nRxn</span>
0415 <span class="comment">%     if changedDirections.forwardReverse(n)</span>
0416 <span class="comment">%         fprintf(fid,'%s\t%s\t%g\t%g\t%g\t%g\n',model.rxn(n).officialName,model.rxn(n).equation,model.rxn(n).dGt0Min,model.rxn(n).dGt0Max,model.rxn(n).dGtMin,model.rxn(n).dGtMax);</span>
0417 <span class="comment">%     end</span>
0418 <span class="comment">% end</span>
0419 <span class="comment">%</span>
0420 <span class="comment">% %print out the metabolites involved in these reactions with changed</span>
0421 <span class="comment">% %directions</span>
0422 <span class="comment">% fprintf(fid,'\n');</span>
0423 <span class="comment">% allTighterRxnBool=changedDirections.reversibleFwd | changedDirections.reversibleRev | changedDirections.forwardReverse;</span>
0424 <span class="comment">% allTighterMetSum=sum(abs(model.S(:,allTighterRxnBool)),2);</span>
0425 <span class="comment">% for m=1:nMet</span>
0426 <span class="comment">%     %only cytoplasmic metabolites to avoid duplicates</span>
0427 <span class="comment">%     if allTighterMetSum(m)&gt;0 &amp; strcmp(model.met(m).abbreviation(end-2:end),'[c]')</span>
0428 <span class="comment">%         fprintf(fid,'%d\t%s\t%s\t%g\t%g\t%g\t%s\n',allTighterMetSum(m),model.met(m).abbreviation(1:end-3),model.met(m).officialName,model.met(m).dGft0Keq,model.met(m).dGft0GroupCont,model.met(m).dGft0GroupContUncertainty,model.met(m).dGft0Source);</span>
0429 <span class="comment">%     end</span>
0430 <span class="comment">% end</span>
0431 <span class="comment">%</span>
0432 <span class="comment">% fprintf(fid,'\n');</span>
0433 <span class="comment">% allLooserMetSum=sum(abs(model.S(:,forwardReversibleKeq)),2);</span>
0434 <span class="comment">% for m=1:nMet</span>
0435 <span class="comment">%     %only cytoplasmic metabolites to avoid duplicates</span>
0436 <span class="comment">%     if allLooserMetSum(m)&gt;0 &amp; strcmp(model.met(m).abbreviation(end-2:end),'[c]')</span>
0437 <span class="comment">%         fprintf(fid,'%d\t%s\t%s\t%g\t%g\t%g\t%s\n',allLooserMetSum(m),model.met(m).abbreviation(1:end-3),model.met(m).officialName,model.met(m).dGft0Keq,model.met(m).dGft0GroupCont,model.met(m).dGft0GroupContUncertainty,model.met(m).dGft0Source);</span>
0438 <span class="comment">%     end</span>
0439 <span class="comment">% end</span>
0440 <span class="comment">%</span>
0441 <span class="comment">% fclose(fid);</span>
0442 
0443 
0444 
0445 
0446 <span class="comment">%</span>
0447 <span class="comment">%</span>
0448 <span class="comment">%</span>
0449 <span class="comment">%</span>
0450 <span class="comment">%</span>
0451 <span class="comment">% %find the metabolites causing forward reactions to be reversible</span>
0452 <span class="comment">% if max(forwardReversible)==1</span>
0453 <span class="comment">%     SforwardReversible=model.S(:,forwardReversible);</span>
0454 <span class="comment">%     forwardReversibleMet=zeros(nMet,1);</span>
0455 <span class="comment">%     for m=1:nMet</span>
0456 <span class="comment">%         forwardReversibleMet(m,1)=nnz(SforwardReversible(m,:));</span>
0457 <span class="comment">%     end</span>
0458 <span class="comment">%     %print out the culprits in order of worst offender</span>
0459 <span class="comment">%     [sorted,sInd]=sort(forwardReversibleMet,'descend');</span>
0460 <span class="comment">%     p=1;</span>
0461 <span class="comment">%     fprintf(fid,'%s\n',['Metabolites which allow ' int2str(nnz(forwardReversible)) ' forward reactions to be reversible:']);</span>
0462 <span class="comment">%     while forwardReversibleMet(sInd(p))&gt;0</span>
0463 <span class="comment">%         if ~strcmp(model.met(sInd(p)).dGft0Source,'Keq')</span>
0464 <span class="comment">%             dataSource='gc';</span>
0465 <span class="comment">%         else</span>
0466 <span class="comment">%             dataSource='Keq';</span>
0467 <span class="comment">%         end</span>
0468 <span class="comment">%         fprintf(fid,'%u%s\t%u\t%s\t%20s\t%s\n',sInd(p),':',forwardReversibleMet(sInd(p)),dataSource,model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0469 <span class="comment">%         p=p+1;</span>
0470 <span class="comment">%     end</span>
0471 <span class="comment">%     fprintf(fid,'\n');</span>
0472 <span class="comment">%     fprintf(fid,'\n');</span>
0473 <span class="comment">%</span>
0474 <span class="comment">%     %print out for each problematic reaction</span>
0475 <span class="comment">%     for n=1:nRxn</span>
0476 <span class="comment">%         if forwardReversible(n)==1</span>
0477 <span class="comment">%             fprintf(fid,'%i\t%s\t%s\t%6.2f\t%6.2f\n%s\n',n,model.rxn(n).officialName,model.rxn(n).abbreviation,model.rxn(n).dGtMin,model.rxn(n).dGtMax,'substrates:');</span>
0478 <span class="comment">%             %                 fprintf(fid,'%i\t%s\t%6.2f\t%6.2f\n\t%s\n',n,model.rxn(n).officialName,model.rxn(n).dGtMin,model.rxn(n).dGtMax,'substrates:');</span>
0479 <span class="comment">%             sInd=find(model.S(:,n)&lt;0);</span>
0480 <span class="comment">%             for p=1:length(sInd)</span>
0481 <span class="comment">%                 %                 fprintf(fid,'\t\t%i\t\t%6.2f\t\t%6.2f\t%6.2f\t\t%i\t%s%s\n',model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),sInd(p),model.met(sInd(p)).officialName,[' ' model.met(sInd(p)).abbreviation(end-2:end)]);</span>
0482 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',sInd(p),model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0483 <span class="comment">%             end</span>
0484 <span class="comment">%             fprintf(fid,'%s\n','products:');</span>
0485 <span class="comment">%             pInd=find(model.S(:,n)&gt;0);</span>
0486 <span class="comment">%             for p=1:length(pInd)</span>
0487 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',pInd(p),model.S(pInd(p),n),model.met(pInd(p)).dGft0,rt*log(model.met(pInd(p)).concMin),rt*log(model.met(pInd(p)).concMax),model.met(pInd(p)).abbreviation,model.met(pInd(p)).officialName);</span>
0488 <span class="comment">%             end</span>
0489 <span class="comment">%             fprintf(fid,'\n');</span>
0490 <span class="comment">%         end</span>
0491 <span class="comment">%     end</span>
0492 <span class="comment">% end</span>
0493 <span class="comment">%</span>
0494 <span class="comment">%</span>
0495 <span class="comment">% %find the metabolites causing reversible reactions to go forward only</span>
0496 <span class="comment">% if max(reversibleFwd)==1</span>
0497 <span class="comment">%     SreversibleFwd=model.S(:,reversibleFwd);</span>
0498 <span class="comment">%     reversibleFwdMet=zeros(nMet,1);</span>
0499 <span class="comment">%     for m=1:nMet</span>
0500 <span class="comment">%         reversibleFwdMet(m,1)=nnz(SreversibleFwd(m,:));</span>
0501 <span class="comment">%     end</span>
0502 <span class="comment">%     %print out the culprits in order of worst offender</span>
0503 <span class="comment">%     [sorted,sInd]=sort(reversibleFwdMet,'descend');</span>
0504 <span class="comment">%     p=1;</span>
0505 <span class="comment">%     fprintf(fid,'%s\n',['Metabolites which force ' int2str(nnz(reversibleFwd)) ' reversible reactions to go forwards']);</span>
0506 <span class="comment">%     while reversibleFwdMet(sInd(p))&gt;0</span>
0507 <span class="comment">%         if ~strcmp(model.met(sInd(p)).dGft0Source,'Keq')</span>
0508 <span class="comment">%             dataSource='gc';</span>
0509 <span class="comment">%         else</span>
0510 <span class="comment">%             dataSource='Keq';</span>
0511 <span class="comment">%         end</span>
0512 <span class="comment">%         fprintf(fid,'%u%s\t%u\t%s\t%20s\t%s\n',sInd(p),':',reversibleFwdMet(sInd(p)),dataSource,model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0513 <span class="comment">%         p=p+1;</span>
0514 <span class="comment">%     end</span>
0515 <span class="comment">%     fprintf(fid,'\n');</span>
0516 <span class="comment">%     fprintf(fid,'\n');</span>
0517 <span class="comment">%</span>
0518 <span class="comment">%     %print out for each problematic reaction</span>
0519 <span class="comment">%     for n=1:nRxn</span>
0520 <span class="comment">%         if reversibleFwd(n)==1</span>
0521 <span class="comment">%             fprintf(fid,'%i\t%s\t%s\t%6.2f\t%6.2f\n%s\n',n,model.rxn(n).officialName,model.rxn(n).abbreviation,model.rxn(n).dGtMin,model.rxn(n).dGtMax,'substrates:');</span>
0522 <span class="comment">%             sInd=find(model.S(:,n)&lt;0);</span>
0523 <span class="comment">%             for p=1:length(sInd)</span>
0524 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',sInd(p),model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0525 <span class="comment">%             end</span>
0526 <span class="comment">%             fprintf(fid,'%s\n','products:');</span>
0527 <span class="comment">%             pInd=find(model.S(:,n)&gt;0);</span>
0528 <span class="comment">%             for p=1:length(pInd)</span>
0529 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',pInd(p),model.S(pInd(p),n),model.met(pInd(p)).dGft0,rt*log(model.met(pInd(p)).concMin),rt*log(model.met(pInd(p)).concMax),model.met(pInd(p)).abbreviation,model.met(pInd(p)).officialName);</span>
0530 <span class="comment">%             end</span>
0531 <span class="comment">%             fprintf(fid,'\n');</span>
0532 <span class="comment">%         end</span>
0533 <span class="comment">%     end</span>
0534 <span class="comment">%     fprintf(fid,'\n');</span>
0535 <span class="comment">%     fprintf(fid,'\n');</span>
0536 <span class="comment">% end</span>
0537 <span class="comment">%</span>
0538 <span class="comment">% %find the metabolites causing reversible reactions to go in reverse only</span>
0539 <span class="comment">% if max(reversibleRev)==1</span>
0540 <span class="comment">%     SreversibleRev=model.S(:,reversibleRev);</span>
0541 <span class="comment">%     reversibleRevMet=zeros(nMet,1);</span>
0542 <span class="comment">%     for m=1:nMet</span>
0543 <span class="comment">%         reversibleRevMet(m,1)=nnz(SreversibleRev(m,:));</span>
0544 <span class="comment">%     end</span>
0545 <span class="comment">%     %print out the culprits in order of worst offender</span>
0546 <span class="comment">%     [sorted,sInd]=sort(reversibleRevMet,'descend');</span>
0547 <span class="comment">%     p=1;</span>
0548 <span class="comment">%     fprintf(fid,'%s\n',['Metabolites which force ' int2str(nnz(reversibleRev)) ' reversible reactions to go in reverse']);</span>
0549 <span class="comment">%     while reversibleRevMet(sInd(p))&gt;0</span>
0550 <span class="comment">%         if ~strcmp(model.met(sInd(p)).dGft0Source,'Keq')</span>
0551 <span class="comment">%             dataSource='gc';</span>
0552 <span class="comment">%         else</span>
0553 <span class="comment">%             dataSource='Keq';</span>
0554 <span class="comment">%         end</span>
0555 <span class="comment">%         fprintf(fid,'%u%s\t%u\t%s\t%20s\t%s\n',sInd(p),':',reversibleRevMet(sInd(p)),dataSource,model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0556 <span class="comment">%         p=p+1;</span>
0557 <span class="comment">%     end</span>
0558 <span class="comment">%     fprintf(fid,'\n');</span>
0559 <span class="comment">%     fprintf(fid,'\n');</span>
0560 <span class="comment">%</span>
0561 <span class="comment">%     %print out for each problematic reaction</span>
0562 <span class="comment">%     for n=1:nRxn</span>
0563 <span class="comment">%         if reversibleRev(n)==1</span>
0564 <span class="comment">%             fprintf(fid,'%i\t%s\t%s\t%6.2f\t%6.2f\n%s\n',n,model.rxn(n).officialName,model.rxn(n).abbreviation,model.rxn(n).dGtMin,model.rxn(n).dGtMax,'substrates:');</span>
0565 <span class="comment">%             sInd=find(model.S(:,n)&lt;0);</span>
0566 <span class="comment">%             for p=1:length(sInd)</span>
0567 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',sInd(p),model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0568 <span class="comment">%             end</span>
0569 <span class="comment">%             fprintf(fid,'%s\n','products:');</span>
0570 <span class="comment">%             pInd=find(model.S(:,n)&gt;0);</span>
0571 <span class="comment">%             for p=1:length(pInd)</span>
0572 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',pInd(p),model.S(pInd(p),n),model.met(pInd(p)).dGft0,rt*log(model.met(pInd(p)).concMin),rt*log(model.met(pInd(p)).concMax),model.met(pInd(p)).abbreviation,model.met(pInd(p)).officialName);</span>
0573 <span class="comment">%             end</span>
0574 <span class="comment">%             fprintf(fid,'\n');</span>
0575 <span class="comment">%         end</span>
0576 <span class="comment">%     end</span>
0577 <span class="comment">%     fprintf(fid,'\n');</span>
0578 <span class="comment">%     fprintf(fid,'\n');</span>
0579 <span class="comment">% end</span>
0580 <span class="comment">%</span>
0581 <span class="comment">% %find the metabolites causing forward reactions to go in reverse</span>
0582 <span class="comment">% if max(forwardReverse)==1</span>
0583 <span class="comment">%     SforwardReverse=model.S(:,forwardReverse);</span>
0584 <span class="comment">%     forwardReverseMet=zeros(nMet,1);</span>
0585 <span class="comment">%     for m=1:nMet</span>
0586 <span class="comment">%         forwardReverseMet(m,1)=nnz(SforwardReverse(m,:));</span>
0587 <span class="comment">%     end</span>
0588 <span class="comment">%     %print out the culprits in order of worst offender</span>
0589 <span class="comment">%     [sorted,sInd]=sort(forwardReverseMet,'descend');</span>
0590 <span class="comment">%     p=1;</span>
0591 <span class="comment">%     fprintf(fid,'%s\n',['Metabolites which force ' int2str(nnz(forwardReverse)) ' forward reactions to go in reverse']);</span>
0592 <span class="comment">%     while forwardReverseMet(sInd(p))&gt;0</span>
0593 <span class="comment">%         if ~strcmp(model.met(sInd(p)).dGft0Source,'Keq')</span>
0594 <span class="comment">%             dataSource='gc';</span>
0595 <span class="comment">%         else</span>
0596 <span class="comment">%             dataSource='Keq';</span>
0597 <span class="comment">%         end</span>
0598 <span class="comment">%         fprintf(fid,'%u%s\t%u\t%s\t%20s\t%s\n',sInd(p),':',forwardReverseMet(sInd(p)),dataSource,model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0599 <span class="comment">%         p=p+1;</span>
0600 <span class="comment">%     end</span>
0601 <span class="comment">%     fprintf(fid,'\n');</span>
0602 <span class="comment">%     fprintf(fid,'\n');</span>
0603 <span class="comment">%</span>
0604 <span class="comment">%     %print out for each problematic reaction</span>
0605 <span class="comment">%     for n=1:nRxn</span>
0606 <span class="comment">%         if forwardReverse(n)==1</span>
0607 <span class="comment">%             fprintf(fid,'%i\t%s\t%s\t%6.2f\t%6.2f\n%s\n',n,model.rxn(n).officialName,model.rxn(n).abbreviation,model.rxn(n).dGtMin,model.rxn(n).dGtMax,'substrates:');</span>
0608 <span class="comment">%             %                 fprintf(fid,'%i\t%s\t%6.2f\t%6.2f\n\t%s\n',n,model.rxn(n).officialName,model.rxn(n).dGtMin,model.rxn(n).dGtMax,'substrates:');</span>
0609 <span class="comment">%             sInd=find(model.S(:,n)&lt;0);</span>
0610 <span class="comment">%             for p=1:length(sInd)</span>
0611 <span class="comment">%                 %                 fprintf(fid,'\t\t%i\t\t%6.2f\t\t%6.2f\t%6.2f\t\t%i\t%s%s\n',model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),sInd(p),model.met(sInd(p)).officialName,[' ' model.met(sInd(p)).abbreviation(end-2:end)]);</span>
0612 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',sInd(p),model.S(sInd(p),n),model.met(sInd(p)).dGft0,rt*log(model.met(sInd(p)).concMin),rt*log(model.met(sInd(p)).concMax),model.met(sInd(p)).abbreviation,model.met(sInd(p)).officialName);</span>
0613 <span class="comment">%             end</span>
0614 <span class="comment">%             fprintf(fid,'%s\n','products:');</span>
0615 <span class="comment">%             pInd=find(model.S(:,n)&gt;0);</span>
0616 <span class="comment">%             for p=1:length(pInd)</span>
0617 <span class="comment">%                 fprintf(fid,'%i\t%8g\t%8.2f\t%6.2f\t%6.2f\t%20s\t%s\n',pInd(p),model.S(pInd(p),n),model.met(pInd(p)).dGft0,rt*log(model.met(pInd(p)).concMin),rt*log(model.met(pInd(p)).concMax),model.met(pInd(p)).abbreviation,model.met(pInd(p)).officialName);</span>
0618 <span class="comment">%             end</span>
0619 <span class="comment">%             fprintf(fid,'\n');</span>
0620 <span class="comment">%         end</span>
0621 <span class="comment">%     end</span>
0622 <span class="comment">% end</span>
0623 <span class="comment">%</span>
0624 <span class="comment">% fclose(fid);</span>
0625 <span class="comment">%</span>
0626 <span class="comment">%</span></pre></div>
<hr><address>Generated on Fri 20-May-2011 17:06:05 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>