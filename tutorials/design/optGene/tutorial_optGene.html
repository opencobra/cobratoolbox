<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="MATLAB R2016a"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><title>OptGene Tutorial</title><style type="text/css">
* {margin: 0; padding: 0;}
body {text-align: start; line-height: 17.2339992523193px; min-height: 0px; white-space: normal; color: rgb(0, 0, 0); font-family: Consolas, Inconsolata, Menlo, monospace; font-style: normal; font-size: 14px; font-weight: normal; text-decoration: none; white-space: normal; }
h1, h2 {font-weight: normal;}
.content { padding: 30px; }

.S0 { margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S1 { line-height: 26.3999996185303px; min-height: 24px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-size: 22px; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 15px; margin-right: 10px;  }
.S2 { min-height: 0px; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S3 { line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 15px; margin-bottom: 9px; margin-right: 10px;  }
.S4 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 2px; margin-bottom: 9px; margin-right: 10px;  }
.S5 { line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 9px; margin-right: 10px;  }
.S6 { font-family: Helvetica, Arial, sans-serif; margin-left: 0px; margin-top: 10px; margin-bottom: 20px; margin-right: 0px;  }
.S7 { text-align: left; line-height: 21px; white-space: pre-wrap; white-space: pre-wrap; margin-left: 56px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S8 { min-height: 0px; font-weight: bold; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S9 { margin-left: 3px; margin-top: 10px; margin-bottom: 4px; margin-right: 3px;  }
.S10 { line-height: 15.5926666259766px; min-height: 18px; white-space: nowrap; font-size: 12.6666669845581px; white-space: nowrap; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S11 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(0, 0, 255); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S12 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S13 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S14 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S15 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(0, 0, 255); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S16 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(34, 139, 34); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S17 { line-height: 15.5926675796509px; min-height: 0px; white-space: pre; color: rgb(160, 32, 240); font-size: 12.6666679382324px; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 45px;  }
.S18 { margin-left: 3px; margin-top: 10px; margin-bottom: 10px; margin-right: 3px;  }
.S19 { line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 10px; margin-bottom: 9px; margin-right: 10px;  }
.S20 { min-height: 0px; font-style: italic; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }

.LineNodeBlock {margin: 10px 0 10px 0;}
.LineNodeBlock+.paragraphNode {margin-top: 10px;}
.lineNode {padding-left: 10px; background-color: #F7F7F7; border-left: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.inlineWrapper:first-child .lineNode,.inlineWrapper.outputs+.inlineWrapper .lineNode {padding-top: 5px; border-top: 1px solid #E9E9E9;}
.inlineWrapper:last-child .lineNode,.inlineWrapper.outputs .lineNode {padding-bottom: 5px; border-bottom: 1px solid #E9E9E9;}
.lineNode .textBox {white-space: pre;}
</style></head><body><div class = "content"><div class = 'SectionBlock containment active'><h1 class = "S1"><span class = "S2">OptGene Tutorial</span></h1><h2 class = "S3"><span class = "S2">Author: Sebasti√°n N. Mendoza,  Center for Mathematical Modeling, University of Chile. snmendoz@uc.cl</span></h2><h2 class = "S3"><span class = "S2">Reviewer(s): Sylvian Arreckx</span></h2><h2 class = "S3"><span class = "S2">INTRODUCTION:</span></h2><p class = "S4"><span class = "S2">In this tutorial we will run optGene For a detailed description of the procedure, please see [1]. Briefly, the problem is to find a set of reactions of size "K" such that when these reactions are deleted from the model, the mutant created will produce a particular target of interest in a higher rate than the wild-type strain. </span></p><p class = "S4"><span class = "S2">For example, imagine that we would like to increase the production of succinate in Escherichia coli. Which are the knockouts needed to increase the production of succinate? We will approach this problem in this tutorial.</span></p></div><p class = "S0"></p><div class = 'SectionBlock containment'><h2 class = "S5"><span class = "S2">MATERIALS</span></h2><h2 class = "S3"><span class = "S2">EQUIPMENT</span></h2><ol class = "S6"><li class = "S7"><span class = "S0">MATLAB</span></li><li class = "S7"><span class = "S0">A solver for QP problems. For example, Gurobi. I encourage the users to use Gurobi since I've not obtained good results using glpk.</span></li></ol><h2 class = "S3"><span class = "S2">EQUIPMENT SETUP</span></h2><p class = "S4"><span class = "S2">Use changeCobraSolver to choose the solver for QP problems. </span></p></div><p class = "S0"></p><div class = 'SectionBlock containment'><h2 class = "S5"><span class = "S2">PROCEDURE</span></h2><p class = "S4"><span class = "S2">The proceduce consists on the following steps</span></p><p class = "S4"><span class = "S2">1) Define contraints (manual task)</span></p><p class = "S4"><span class = "S2">2) Select a list of reactions or genes (manual task). Reactions or genes in this list could be deleted. Elements that are not in the list will no be deleted. </span></p><p class = "S4"><span class = "S2">3) Define some (manual task)</span></p><p class = "S4"><span class = "S2">4) Run optGene. </span><span class = "S8">TIMING</span><span class = "S2">: This task should take from a few minutes to a few days, depending on the size of your reconstruction and the criterion for stoping optGene</span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">global </span><span class = "S12">TUTORIAL_INIT_CB;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">if </span><span class = "S12">~isempty(TUTORIAL_INIT_CB) &amp;&amp; TUTORIAL_INIT_CB  ==  1</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    initCobraToolbox</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    changeCobraSolver(</span><span class = "S14">'gurobi'</span><span class = "S13">, </span><span class = "S14">'all'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">fullPath = which (</span><span class = "S14">'tutorial_optGene.mlx'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">folder = fileparts(fullPath);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">cd(folder);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">threshold = 3; </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = readCbModel(</span><span class = "S14">'iJO1366.mat'</span><span class = "S12">)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">biomass = </span><span class = "S14">'BIOMASS_Ec_iJO1366_core_53p95M'</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">%SETTING SPECIFIC CONSTRAINTS</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% prespecified amount of glucose uptake 10 mmol/grDW*hr</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_glc__D_e'</span><span class = "S13">, -10, </span><span class = "S14">'b'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% Unconstrained uptake routes for inorganic phosphate, sulfate and</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% ammonia</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_o2_e'</span><span class = "S13">, 0, </span><span class = "S14">'l'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_pi_e'</span><span class = "S13">, -1000, </span><span class = "S14">'l'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_so4_e'</span><span class = "S13">, -1000, </span><span class = "S14">'l'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_nh4_e'</span><span class = "S13">, -1000, </span><span class = "S14">'l'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% The optimization step could opt for or against the phosphotransferase</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% system, glucokinase, or both mechanisms for the uptake of glucose</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'GLCabcpp'</span><span class = "S13">, -1000, </span><span class = "S14">'l'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'GLCptspp'</span><span class = "S13">, -1000, </span><span class = "S14">'l'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'GLCabcpp'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'GLCptspp'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'GLCt2pp'</span><span class = "S13">, 0, </span><span class = "S14">'b'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% Secretion routes  for acetate, carbon dioxide, ethanol, formate, lactate</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% and succinate are enabled</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_ac_e'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_co2_e'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_etoh_e'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_for_e'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_lac__D_e'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeRxnBounds(model, </span><span class = "S14">'EX_succ_e'</span><span class = "S13">, 1000, </span><span class = "S14">'u'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% FINDING RATES IN WILD-TYPE</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% The follling rates are those calculated in the wild-type without any</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% mutation.</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% determine succinate production and growth rate before optimizacion</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">fbaWT = optimizeCbModel(model);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">growthRateWT = fbaWT.f;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">model = changeObjective(model, </span><span class = "S14">'EX_succ_e'</span><span class = "S12">); </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">fbaWTMin = optimizeCbModel(model, </span><span class = "S14">'min'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">fbaWTMax = optimizeCbModel(model, </span><span class = "S14">'max'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">minSuccFluxWT = fbaWTMin.f;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">maxSuccFluxWT = fbaWTMax.f;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">model = changeObjective(model, biomass);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">fprintf(</span><span class = "S14">'The minimum and maximum production of succinate before optimization is %.1f and %.1f respectively\n'</span><span class = "S12">, minSuccFluxWT, maxSuccFluxWT);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">fprintf(</span><span class = "S14">'The growth rate before optimization is %.2f \n'</span><span class = "S12">, growthRateWT);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% OPTGENE SETTING</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">selectedGeneList = {};</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S16">% use prespecified reactions. Faster option</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">selectedRxnList = {</span><span class = "S14">'GLCabcpp'</span><span class = "S13">; </span><span class = "S14">'GLCptspp'</span><span class = "S13">; </span><span class = "S14">'HEX1'</span><span class = "S13">; </span><span class = "S14">'PGI'</span><span class = "S13">; </span><span class = "S14">'PFK'</span><span class = "S13">; </span><span class = "S14">'FBA'</span><span class = "S13">; </span><span class = "S14">'TPI'</span><span class = "S13">; </span><span class = "S14">'GAPD'</span><span class = "S13">; </span><span class = "S14">'PGK'</span><span class = "S13">; </span><span class = "S14">'PGM'</span><span class = "S13">; </span><span class = "S14">'ENO'</span><span class = "S13">; </span><span class = "S14">'PYK'</span><span class = "S13">; </span><span class = "S14">'LDH_D'</span><span class = "S13">; </span><span class = "S14">'PFL'</span><span class = "S13">; </span><span class = "S14">'ALCD2x'</span><span class = "S13">; </span><span class = "S14">'PTAr'</span><span class = "S13">; </span><span class = "S14">'ACKr'</span><span class = "S13">; </span><span class = "S14">'G6PDH2r'</span><span class = "S13">; </span><span class = "S14">'PGL'</span><span class = "S13">; </span><span class = "S14">'GND'</span><span class = "S13">; </span><span class = "S14">'RPI'</span><span class = "S13">; </span><span class = "S14">'RPE'</span><span class = "S13">; </span><span class = "S14">'TKT1'</span><span class = "S13">; </span><span class = "S14">'TALA'</span><span class = "S13">; </span><span class = "S14">'TKT2'</span><span class = "S13">; </span><span class = "S14">'FUM'</span><span class = "S13">; </span><span class = "S14">'FRD2'</span><span class = "S13">; </span><span class = "S14">'SUCOAS'</span><span class = "S13">; </span><span class = "S14">'AKGDH'</span><span class = "S13">; </span><span class = "S14">'ACONTa'</span><span class = "S13">; </span><span class = "S14">'ACONTb'</span><span class = "S13">; </span><span class = "S14">'ICDHyr'</span><span class = "S13">; </span><span class = "S14">'CS'</span><span class = "S13">; </span><span class = "S14">'MDH'</span><span class = "S13">; </span><span class = "S14">'MDH2'</span><span class = "S13">; </span><span class = "S14">'MDH3'</span><span class = "S13">; </span><span class = "S14">'ACALD'</span><span class = "S12">};</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">genesByReaction = regexp(regexprep(model.grRules(ismember(model.rxns, selectedRxnList)), </span><span class = "S14">'\or|and|\(|\)'</span><span class = "S13">, </span><span class = "S14">''</span><span class = "S13">), </span><span class = "S14">'\  '</span><span class = "S13">, </span><span class = "S14">'split'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">for </span><span class = "S12">i = 1:length(genesByReaction)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    selectedGeneList = union(selectedGeneList, genesByReaction{i});</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S15">end</span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S4"><span class = "S8">I) SUCCINATE OVERPRODUCTION</span></p><p class = "S4"><span class = "S8">EXAMPLE 1: finding reaction knockouts sets of large 2 or less, using a limit of time to stop optGene</span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">EXAMPLE </span><span class = "S17">1: finding reaction knockouts sets of large 2 or less</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12"></span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">fprintf(</span><span class = "S14">'\n...EXAMPLE 1: Finding optGene sets\n\n'</span><span class = "S12">)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">previousSolutions = cell(10, 1);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">contPreviousSolutions = 1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">nIter = 0;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">while </span><span class = "S12">nIter &lt; threshold</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    fprintf(</span><span class = "S14">'...Performing optGene analysis...\n'</span><span class = "S12">)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S16">%optGene algorithm is run with the following options: target: 'EX_lac__D_e'</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    [~, ~, ~, optGeneSol] = optGene(model, </span><span class = "S14">'EX_succ_e'</span><span class = "S13">, </span><span class = "S14">'EX_glc__D_e'</span><span class = "S13">, selectedGeneList, </span><span class = "S14">'MaxKOs'</span><span class = "S13">, 2, </span><span class = "S14">'TimeLimit'</span><span class = "S12">, 120);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    SET_M1 = optGeneSol.geneList;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S11">if </span><span class = "S12">~isempty(SET_M1)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">        previousSolutions{contPreviousSolutions} = SET_M1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">        contPreviousSolutions = contPreviousSolutions + 1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S16">%printing results</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'optGene found a knockout set of large %d composed by '</span><span class = "S12">, length(SET_M1));</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S11">for </span><span class = "S12">j = 1:length(SET_M1)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S11">if </span><span class = "S12">j == 1</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">                fprintf(</span><span class = "S14">'%s '</span><span class = "S12">,SET_M1{j});</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S11">elseif </span><span class = "S12">j == length(SET_M1)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">                fprintf(</span><span class = "S14">'and %s'</span><span class = "S12">,SET_M1{j});</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S15">else</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">                fprintf(</span><span class = "S14">', %s '</span><span class = "S12">,SET_M1{j});</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'...Performing coupling analysis...\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        [type, maxGrowth, maxProd, minProd] = analyzeOptKnock(model, optGeneSol.geneList, </span><span class = "S14">'EX_succ_e'</span><span class = "S12">, biomass, 1);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'The solution is of type: %s\n'</span><span class = "S12">,type);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'The maximun growth rate after optimizacion is %.2f\n'</span><span class = "S12">, maxGrowth);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'The maximun and minimun production of succinate after optimization is %.2f and %.2f, respectively \n\n'</span><span class = "S12">, minProd, maxProd);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">        </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S15">else</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S11">if </span><span class = "S12">nIter  ==  1</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            fprintf(</span><span class = "S14">'optGene was not able to found an optGene set\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S15">else</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            fprintf(</span><span class = "S14">'optGene was not able to found additional optGene sets\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S11">break</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    nIter = nIter + 1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S15">end</span></p></div></div></div><p class = "S0"></p><div class = 'SectionBlock containment'><p class = "S4"><span class = "S8">EXAMPLE 2: finding reaction knockouts sets of large 2 or less, using the number of generations to stop optGene</span></p><div class = 'LineNodeBlock contiguous'><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">fprintf(</span><span class = "S14">'\n...EXAMPLE 2: Finding optGene sets\n\n'</span><span class = "S12">)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">previousSolutions = cell(10, 1);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">contPreviousSolutions = 1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">nIter = 0;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S11">while </span><span class = "S12">nIter &lt; threshold</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    fprintf(</span><span class = "S14">'...Performing optGene analysis...\n'</span><span class = "S12">)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S16">%optGene algorithm is run with the following options: target: 'EX_lac__D_e'</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    [~, ~, ~, optGeneSol] = optGene(model, </span><span class = "S14">'EX_succ_e'</span><span class = "S13">, </span><span class = "S14">'EX_glc__D_e'</span><span class = "S13">, selectedGeneList, </span><span class = "S14">'MaxKOs'</span><span class = "S13">, 2, </span><span class = "S14">'Generations'</span><span class = "S12">, 20);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    SET_M1 = optGeneSol.geneList;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S11">if </span><span class = "S12">~isempty(SET_M1)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">        previousSolutions{contPreviousSolutions} = SET_M1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">        contPreviousSolutions = contPreviousSolutions + 1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S16">%printing results</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'optGene found a knockout set of large %d composed by '</span><span class = "S12">, length(SET_M1));</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S11">for </span><span class = "S12">j = 1:length(SET_M1)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S11">if </span><span class = "S12">j == 1</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">                fprintf(</span><span class = "S14">'%s '</span><span class = "S12">,SET_M1{j});</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S11">elseif </span><span class = "S12">j == length(SET_M1)</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">                fprintf(</span><span class = "S14">'and %s'</span><span class = "S12">,SET_M1{j});</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S15">else</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">                fprintf(</span><span class = "S14">', %s '</span><span class = "S12">,SET_M1{j});</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'...Performing coupling analysis...\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        [type, maxGrowth, maxProd, minProd] = analyzeOptKnock(model, optGeneSol.geneList, </span><span class = "S14">'EX_succ_e'</span><span class = "S12">, biomass, 1);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'The solution is of type: %s\n'</span><span class = "S12">,type);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'The maximun growth rate after optimizacion is %.2f\n'</span><span class = "S12">, maxGrowth);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        fprintf(</span><span class = "S14">'The maximun and minimun production of succinate after optimization is %.2f and %.2f, respectively \n\n'</span><span class = "S12">, minProd, maxProd);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">        </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S15">else</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S11">if </span><span class = "S12">nIter  ==  1</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            fprintf(</span><span class = "S14">'optGene was not able to found an optGene set\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S15">else</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">            fprintf(</span><span class = "S14">'optGene was not able to found additional optGene sets\n'</span><span class = "S12">);</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">        </span><span class = "S11">break</span><span class = "S12">;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S13">    </span><span class = "S15">end</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    nIter = nIter + 1;</span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S12">    </span></p></div><div class = 'inlineWrapper'><p class = "S10 lineNode"><span class = "S15">end</span></p></div></div><p class = "S19"><span class = "S2"> </span></p></div><p class = "S0"></p><div class = 'SectionBlock containment'><h2 class = "S5"><span class = "S2">TIMING</span></h2><ol class = "S6"><li class = "S7"><span class = "S0">EXAMPLE 1: ~ 6 minutes (2 minutes per iteration)</span></li><li class = "S7"><span class = "S0">EXAMPLE 2: ~ 7 minutes (2-3 minutes per iteration)</span></li></ol></div><p class = "S0"></p><div class = 'SectionBlock containment'><h2 class = "S5"><span class = "S2">TROUBLESHOOTING</span></h2><p class = "S4"><span class = "S2">1) problem: "optGene didn't find any set"</span></p><p class = "S4"><span class = "S2">possible reason: probably, the limit of time or the number of generations has not been enough. Another explination is that the solver is not suited for solving optGene</span></p><p class = "S4"><span class = "S2">solution: Try with a higher number for inputs "TimeLimit" of "Generations" or using another solver. </span></p><p class = "S4"><span class = "S2">2) problem: "I got an error when running optGene"</span></p><p class = "S4"><span class = "S2">possible reason: the solver is not suited for solving optGene</span></p><p class = "S4"><span class = "S2">solution: Try with another solver</span></p></div><p class = "S0"></p><div class = 'SectionBlock containment'><h2 class = "S5"><span class = "S2">ANTICIPATED RESULTS</span></h2><p class = "S4"><span class = "S2">The optGene algorithm will find sets of reactions that should increase the production of your target when they are deleted from the network. Since optGene is based on a genetic algorithm, the solutions found could vary between different runnings, even though the algorithm has been executed with the same input parameters. It is possible that optGene don't find a set of knockouts because the runtime is too short or because the number of generations is too small. In those cases try to increases those input variables. </span></p></div><p class = "S0"></p><div class = 'SectionBlock containment'><h2 class = "S5"><span class = "S2">References</span></h2><p class = "S4"><span class = "S2">[1] Patil, K. R., Rocha, I., F√∂rster, J., &amp; Nielsen, J. (2005). Evolutionary programming as a platform for in silico metabolic engineering.</span><span class = "S2"> </span><span class = "S20">BMC bioinformatics</span><span class = "S2">,</span><span class = "S2"> </span><span class = "S20">6</span><span class = "S2">(1), 308.</span></p><p class = "S4"><span class = "S2">[2] Orth, J. D., Conrad, T. M., Na, J., Lerman, J. A., Nam, H., Feist, A. M., &amp; Palsson, B. √ò. (2011). A comprehensive genome‚Äêscale reconstruction of Escherichia coli metabolism‚Äî2011.</span><span class = "S2"> </span><span class = "S20">Molecular systems biology</span><span class = "S2">,</span><span class = "S2"> </span><span class = "S20">7</span><span class = "S2">(1), 535.</span></p></div></div>
<!-- 
##### SOURCE BEGIN #####
%% OptGene Tutorial
%% Author: Sebasti√°n N. Mendoza,  Center for Mathematical Modeling, University of Chile. snmendoz@uc.cl
%% *Reviewer(s): Sylvian Arreckx*
%% *INTRODUCTION:*
% In this tutorial we will run optGene For a detailed description of the procedure, 
% please see [1]. Briefly, the problem is to find a set of reactions of size "K" 
% such that when these reactions are deleted from the model, the mutant created 
% will produce a particular target of interest in a higher rate than the wild-type 
% strain. 
% 
% For example, imagine that we would like to increase the production of succinate 
% in Escherichia coli. Which are the knockouts needed to increase the production 
% of succinate? We will approach this problem in this tutorial.
%% MATERIALS
%% EQUIPMENT
% # MATLAB
% # A solver for QP problems. For example, Gurobi. I encourage the users to 
% use Gurobi since I've not obtained good results using glpk.
%% *EQUIPMENT SETUP*
% Use changeCobraSolver to choose the solver for QP problems. 
%% PROCEDURE
% The proceduce consists on the following steps
% 
% 1) Define contraints (manual task)
% 
% 2) Select a list of reactions or genes (manual task). Reactions or genes 
% in this list could be deleted. Elements that are not in the list will no be 
% deleted. 
% 
% 3) Define some (manual task)
% 
% 4) Run optGene. *TIMING*: This task should take from a few minutes to a 
% few days, depending on the size of your reconstruction and the criterion for 
% stoping optGene

global TUTORIAL_INIT_CB;
if ~isempty(TUTORIAL_INIT_CB) && TUTORIAL_INIT_CB  ==  1
    initCobraToolbox
    changeCobraSolver('gurobi', 'all');
end

fullPath = which ('tutorial_optGene.mlx');
folder = fileparts(fullPath);
cd(folder);

threshold = 3; 

model = readCbModel('iJO1366.mat')
biomass = 'BIOMASS_Ec_iJO1366_core_53p95M';

%SETTING SPECIFIC CONSTRAINTS
% prespecified amount of glucose uptake 10 mmol/grDW*hr
model = changeRxnBounds(model, 'EX_glc__D_e', -10, 'b');

% Unconstrained uptake routes for inorganic phosphate, sulfate and
% ammonia
model = changeRxnBounds(model, 'EX_o2_e', 0, 'l');
model = changeRxnBounds(model, 'EX_pi_e', -1000, 'l');
model = changeRxnBounds(model, 'EX_so4_e', -1000, 'l');
model = changeRxnBounds(model, 'EX_nh4_e', -1000, 'l');

% The optimization step could opt for or against the phosphotransferase
% system, glucokinase, or both mechanisms for the uptake of glucose
model = changeRxnBounds(model, 'GLCabcpp', -1000, 'l');
model = changeRxnBounds(model, 'GLCptspp', -1000, 'l');
model = changeRxnBounds(model, 'GLCabcpp', 1000, 'u');
model = changeRxnBounds(model, 'GLCptspp', 1000, 'u');
model = changeRxnBounds(model, 'GLCt2pp', 0, 'b');

% Secretion routes  for acetate, carbon dioxide, ethanol, formate, lactate
% and succinate are enabled
model = changeRxnBounds(model, 'EX_ac_e', 1000, 'u');
model = changeRxnBounds(model, 'EX_co2_e', 1000, 'u');
model = changeRxnBounds(model, 'EX_etoh_e', 1000, 'u');
model = changeRxnBounds(model, 'EX_for_e', 1000, 'u');
model = changeRxnBounds(model, 'EX_lac__D_e', 1000, 'u');
model = changeRxnBounds(model, 'EX_succ_e', 1000, 'u');

% FINDING RATES IN WILD-TYPE
% The follling rates are those calculated in the wild-type without any
% mutation.

% determine succinate production and growth rate before optimizacion
fbaWT = optimizeCbModel(model);
growthRateWT = fbaWT.f;

model = changeObjective(model, 'EX_succ_e'); 
fbaWTMin = optimizeCbModel(model, 'min');
fbaWTMax = optimizeCbModel(model, 'max');
minSuccFluxWT = fbaWTMin.f;
maxSuccFluxWT = fbaWTMax.f;

model = changeObjective(model, biomass);

fprintf('The minimum and maximum production of succinate before optimization is %.1f and %.1f respectively\n', minSuccFluxWT, maxSuccFluxWT);
fprintf('The growth rate before optimization is %.2f \n', growthRateWT);

% OPTGENE SETTING
selectedGeneList = {};
% use prespecified reactions. Faster option
selectedRxnList = {'GLCabcpp'; 'GLCptspp'; 'HEX1'; 'PGI'; 'PFK'; 'FBA'; 'TPI'; 'GAPD'; 'PGK'; 'PGM'; 'ENO'; 'PYK'; 'LDH_D'; 'PFL'; 'ALCD2x'; 'PTAr'; 'ACKr'; 'G6PDH2r'; 'PGL'; 'GND'; 'RPI'; 'RPE'; 'TKT1'; 'TALA'; 'TKT2'; 'FUM'; 'FRD2'; 'SUCOAS'; 'AKGDH'; 'ACONTa'; 'ACONTb'; 'ICDHyr'; 'CS'; 'MDH'; 'MDH2'; 'MDH3'; 'ACALD'};
genesByReaction = regexp(regexprep(model.grRules(ismember(model.rxns, selectedRxnList)), '\or|and|\(|\)', ''), '\  ', 'split');
for i = 1:length(genesByReaction)
    selectedGeneList = union(selectedGeneList, genesByReaction{i});
end
%% 
% *I) SUCCINATE OVERPRODUCTION*
% 
% *EXAMPLE 1: finding reaction knockouts sets of large 2 or less, using a 
% limit of time to stop optGene*


EXAMPLE 1: finding reaction knockouts sets of large 2 or less

fprintf('\n...EXAMPLE 1: Finding optGene sets\n\n')
previousSolutions = cell(10, 1);
contPreviousSolutions = 1;
nIter = 0;
while nIter < threshold
    fprintf('...Performing optGene analysis...\n')
    %optGene algorithm is run with the following options: target: 'EX_lac__D_e'
    [~, ~, ~, optGeneSol] = optGene(model, 'EX_succ_e', 'EX_glc__D_e', selectedGeneList, 'MaxKOs', 2, 'TimeLimit', 120);
    
    SET_M1 = optGeneSol.geneList;
    
    if ~isempty(SET_M1)
        previousSolutions{contPreviousSolutions} = SET_M1;
        contPreviousSolutions = contPreviousSolutions + 1;
        %printing results
        fprintf('optGene found a knockout set of large %d composed by ', length(SET_M1));
        for j = 1:length(SET_M1)
            if j == 1
                fprintf('%s ',SET_M1{j});
            elseif j == length(SET_M1)
                fprintf('and %s',SET_M1{j});
            else
                fprintf(', %s ',SET_M1{j});
            end
        end
        fprintf('\n');
        fprintf('...Performing coupling analysis...\n');
        [type, maxGrowth, maxProd, minProd] = analyzeOptKnock(model, optGeneSol.geneList, 'EX_succ_e', biomass, 1);
        fprintf('The solution is of type: %s\n',type);
        fprintf('The maximun growth rate after optimizacion is %.2f\n', maxGrowth);
        fprintf('The maximun and minimun production of succinate after optimization is %.2f and %.2f, respectively \n\n', minProd, maxProd);
        
    else
        if nIter  ==  1
            fprintf('optGene was not able to found an optGene set\n');
        else
            fprintf('optGene was not able to found additional optGene sets\n');
        end
        break;
    end
    nIter = nIter + 1;
    
end
%% 
% *EXAMPLE 2: finding reaction knockouts sets of large 2 or less, using 
% the number of generations to stop optGene*

fprintf('\n...EXAMPLE 2: Finding optGene sets\n\n')
previousSolutions = cell(10, 1);
contPreviousSolutions = 1;
nIter = 0;
while nIter < threshold
    fprintf('...Performing optGene analysis...\n')
    %optGene algorithm is run with the following options: target: 'EX_lac__D_e'
    [~, ~, ~, optGeneSol] = optGene(model, 'EX_succ_e', 'EX_glc__D_e', selectedGeneList, 'MaxKOs', 2, 'Generations', 20);
    
    SET_M1 = optGeneSol.geneList;
    
    if ~isempty(SET_M1)
        previousSolutions{contPreviousSolutions} = SET_M1;
        contPreviousSolutions = contPreviousSolutions + 1;
        %printing results
        fprintf('optGene found a knockout set of large %d composed by ', length(SET_M1));
        for j = 1:length(SET_M1)
            if j == 1
                fprintf('%s ',SET_M1{j});
            elseif j == length(SET_M1)
                fprintf('and %s',SET_M1{j});
            else
                fprintf(', %s ',SET_M1{j});
            end
        end
        fprintf('\n');
        fprintf('...Performing coupling analysis...\n');
        [type, maxGrowth, maxProd, minProd] = analyzeOptKnock(model, optGeneSol.geneList, 'EX_succ_e', biomass, 1);
        fprintf('The solution is of type: %s\n',type);
        fprintf('The maximun growth rate after optimizacion is %.2f\n', maxGrowth);
        fprintf('The maximun and minimun production of succinate after optimization is %.2f and %.2f, respectively \n\n', minProd, maxProd);
        
    else
        if nIter  ==  1
            fprintf('optGene was not able to found an optGene set\n');
        else
            fprintf('optGene was not able to found additional optGene sets\n');
        end
        break;
    end
    nIter = nIter + 1;
    
end
%% 
%  
%% TIMING
% # EXAMPLE 1: ~ 6 minutes (2 minutes per iteration)
% # EXAMPLE 2: ~ 7 minutes (2-3 minutes per iteration)
%% TROUBLESHOOTING
% 1) problem: "optGene didn't find any set"
% 
% possible reason: probably, the limit of time or the number of generations 
% has not been enough. Another explination is that the solver is not suited for 
% solving optGene
% 
% solution: Try with a higher number for inputs "TimeLimit" of "Generations" 
% or using another solver. 
% 
% 2) problem: "I got an error when running optGene"
% 
% possible reason: the solver is not suited for solving optGene
% 
% solution: Try with another solver
%% ANTICIPATED RESULTS
% The optGene algorithm will find sets of reactions that should increase the 
% production of your target when they are deleted from the network. Since optGene 
% is based on a genetic algorithm, the solutions found could vary between different 
% runnings, even though the algorithm has been executed with the same input parameters. 
% It is possible that optGene don't find a set of knockouts because the runtime 
% is too short or because the number of generations is too small. In those cases 
% try to increases those input variables. 
%% References
% [1] Patil, K. R., Rocha, I., F√∂rster, J., & Nielsen, J. (2005). Evolutionary 
% programming as a platform for in silico metabolic engineering. _BMC bioinformatics_, 
% _6_(1), 308.
% 
% [2] Orth, J. D., Conrad, T. M., Na, J., Lerman, J. A., Nam, H., Feist, 
% A. M., & Palsson, B. √ò. (2011). A comprehensive genome‚Äêscale reconstruction 
% of Escherichia coli metabolism‚Äî2011. _Molecular systems biology_, _7_(1), 535.
##### SOURCE END #####
--></body></html>