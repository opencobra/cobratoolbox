<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of m2html</title>
  <meta name="keywords" content="m2html">
  <meta name="description" content="M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">m2html</a> &gt; m2html.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for m2html&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>m2html
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function m2html(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML
  M2HTML by itself generates an HTML documentation of the Matlab M-files found
  in the direct subdirectories of the current directory. HTML files are 
  written in a 'doc' directory (created if necessary). All the others options
  are set to default (in brackets in the following).
  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)
  sets multiple option values. The list of option names and default values is:
    o mFiles - Cell array of strings or character array containing the
       list of M-files and/or directories of M-files for which an HTML
       documentation will be built (use relative paths without backtracking).
       Launch M2HTML one directory above the directory your wanting to
       generate documentation for  [ &lt;all direct subdirectories&gt; ]
    o htmlDir - Top level directory for generated HTML files [ 'doc' ]
    o recursive - Process subdirectories recursively [ on | {off} ]
    o source - Include Matlab source code in the generated documentation
                               [ {on} | off ]
    o download - Add a link to download each M-file separately [ on | {off} ]
    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]
    o tabs - Replace '\t' (horizontal tab) in source code by n white space
        characters [ 0 ... {4} ... n ]
    o globalHypertextLinks - Hypertext links among separate Matlab 
        directories [ on | {off} ]
    o todo - Create a TODO list in each directory summarizing all the
        '% TODO %' lines found in Matlab code [ on | {off}]
    o graph - Compute a dependency graph using GraphViz [ on | {off}]
        'dot' required, see &lt;http://www.graphviz.org/&gt;
    o indexFile - Basename of the HTML index file [ 'index' ]
    o extension - Extension of generated HTML files [ '.html' ]
    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]
    o search - Add a PHP search engine [ on | {off}] - beta version!
    o ignoredDir - List of directories to be ignored [ {'.svn' 'cvs'} ]
    o save - Save current state after M-files parsing in 'm2html.mat' 
        in directory htmlDir [ on | {off}]
    o load - Load a previously saved '.mat' M2HTML state to generate HTML 
        files once again with possibly other options [ &lt;none&gt; ]
    o verbose - Verbose mode [ {on} | off ]

  For more information, please read the M2HTML tutorial and FAQ at:
    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;

  Examples:
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');
    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');
    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');
    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');

  See also <a href="mwizard.html" class="code" title="function mwizard(file)">MWIZARD</a>, <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">MDOT</a>, TEMPLATE.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>	MDOT - Export a dependency graph into DOT language</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="mwizard.html" class="code" title="function mwizard(file)">mwizard</a>	MWIZARD - M2HTML Graphical User Interface</li><li><a href="mwizard2.html" class="code" title="function mwizard(file)">mwizard2</a>	MWIZARD - M2HTML Graphical User Interface</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)</a></li><li><a href="#_sub2" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a></li><li><a href="#_sub3" class="code">function s = backtomaster(mdir)</a></li><li><a href="#_sub4" class="code">function ldir = splitpath(p)</a></li><li><a href="#_sub5" class="code">function name = extractname(synopsis)</a></li><li><a href="#_sub6" class="code">function f = fullurl(varargin)</a></li><li><a href="#_sub7" class="code">function str = escapeblank(str)</a></li><li><a href="#_sub8" class="code">function str = entity(str)</a></li><li><a href="#_sub9" class="code">function str = horztab(str,n)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function m2html(varargin)</a>
0002 <span class="comment">%M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</span>
0003 <span class="comment">%  M2HTML by itself generates an HTML documentation of the Matlab M-files found</span>
0004 <span class="comment">%  in the direct subdirectories of the current directory. HTML files are</span>
0005 <span class="comment">%  written in a 'doc' directory (created if necessary). All the others options</span>
0006 <span class="comment">%  are set to default (in brackets in the following).</span>
0007 <span class="comment">%  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)</span>
0008 <span class="comment">%  sets multiple option values. The list of option names and default values is:</span>
0009 <span class="comment">%    o mFiles - Cell array of strings or character array containing the</span>
0010 <span class="comment">%       list of M-files and/or directories of M-files for which an HTML</span>
0011 <span class="comment">%       documentation will be built (use relative paths without backtracking).</span>
0012 <span class="comment">%       Launch M2HTML one directory above the directory your wanting to</span>
0013 <span class="comment">%       generate documentation for  [ &lt;all direct subdirectories&gt; ]</span>
0014 <span class="comment">%    o htmlDir - Top level directory for generated HTML files [ 'doc' ]</span>
0015 <span class="comment">%    o recursive - Process subdirectories recursively [ on | {off} ]</span>
0016 <span class="comment">%    o source - Include Matlab source code in the generated documentation</span>
0017 <span class="comment">%                               [ {on} | off ]</span>
0018 <span class="comment">%    o download - Add a link to download each M-file separately [ on | {off} ]</span>
0019 <span class="comment">%    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]</span>
0020 <span class="comment">%    o tabs - Replace '\t' (horizontal tab) in source code by n white space</span>
0021 <span class="comment">%        characters [ 0 ... {4} ... n ]</span>
0022 <span class="comment">%    o globalHypertextLinks - Hypertext links among separate Matlab</span>
0023 <span class="comment">%        directories [ on | {off} ]</span>
0024 <span class="comment">%    o todo - Create a TODO list in each directory summarizing all the</span>
0025 <span class="comment">%        '% TODO %' lines found in Matlab code [ on | {off}]</span>
0026 <span class="comment">%    o graph - Compute a dependency graph using GraphViz [ on | {off}]</span>
0027 <span class="comment">%        'dot' required, see &lt;http://www.graphviz.org/&gt;</span>
0028 <span class="comment">%    o indexFile - Basename of the HTML index file [ 'index' ]</span>
0029 <span class="comment">%    o extension - Extension of generated HTML files [ '.html' ]</span>
0030 <span class="comment">%    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]</span>
0031 <span class="comment">%    o search - Add a PHP search engine [ on | {off}] - beta version!</span>
0032 <span class="comment">%    o ignoredDir - List of directories to be ignored [ {'.svn' 'cvs'} ]</span>
0033 <span class="comment">%    o save - Save current state after M-files parsing in 'm2html.mat'</span>
0034 <span class="comment">%        in directory htmlDir [ on | {off}]</span>
0035 <span class="comment">%    o load - Load a previously saved '.mat' M2HTML state to generate HTML</span>
0036 <span class="comment">%        files once again with possibly other options [ &lt;none&gt; ]</span>
0037 <span class="comment">%    o verbose - Verbose mode [ {on} | off ]</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%  For more information, please read the M2HTML tutorial and FAQ at:</span>
0040 <span class="comment">%    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%  Examples:</span>
0043 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');</span>
0044 <span class="comment">%    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');</span>
0045 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');</span>
0046 <span class="comment">%    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');</span>
0047 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');</span>
0048 <span class="comment">%    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');</span>
0049 <span class="comment">%</span>
0050 <span class="comment">%  See also MWIZARD, MDOT, TEMPLATE.</span>
0051 
0052 <span class="comment">%  Copyright (C) 2005 Guillaume Flandin &lt;Guillaume@artefact.tk&gt;</span>
0053 <span class="comment">%  $Revision: 1.5 $Date: 2005/05/01 16:15:30 $</span>
0054 
0055 <span class="comment">%  This program is free software; you can redistribute it and/or</span>
0056 <span class="comment">%  modify it under the terms of the GNU General Public License</span>
0057 <span class="comment">%  as published by the Free Software Foundation; either version 2</span>
0058 <span class="comment">%  of the License, or any later version.</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%  This program is distributed in the hope that it will be useful,</span>
0061 <span class="comment">%  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0062 <span class="comment">%  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0063 <span class="comment">%  GNU General Public License for more details.</span>
0064 <span class="comment">%</span>
0065 <span class="comment">%  You should have received a copy of the GNU General Public License</span>
0066 <span class="comment">%  along with this program; if not, write to the Free Software</span>
0067 <span class="comment">%  Foundation Inc, 59 Temple Pl. - Suite 330, Boston, MA 02111-1307, USA.</span>
0068 
0069 <span class="comment">%  Suggestions for improvement and fixes are always welcome, although no</span>
0070 <span class="comment">%  guarantee is made whether and when they will be implemented.</span>
0071 <span class="comment">%  Send requests to &lt;Guillaume@artefact.tk&gt;</span>
0072 
0073 <span class="comment">%  For tips on how to write Matlab code, see:</span>
0074 <span class="comment">%     * MATLAB Programming Style Guidelines, by R. Johnson:</span>
0075 <span class="comment">%       &lt;http://www.datatool.com/prod02.htm&gt;</span>
0076 <span class="comment">%     * For tips on creating help for your m-files 'type help.m'.</span>
0077 <span class="comment">%     * Matlab documentation on M-file Programming:</span>
0078 <span class="comment">%  &lt;http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_prog/ch_funh8.html&gt;</span>
0079 
0080 <span class="comment">%  This function uses the Template class so that you can fully customize</span>
0081 <span class="comment">%  the output. You can modify .tpl files in templates/blue/ or create new</span>
0082 <span class="comment">%  templates in a new directory.</span>
0083 <span class="comment">%  See the template class documentation for more details.</span>
0084 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/template/&gt;</span>
0085 
0086 <span class="comment">%  Latest information on M2HTML is available on the web through:</span>
0087 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0088 
0089 <span class="comment">%  Other Matlab to HTML converters available on the web:</span>
0090 <span class="comment">%  1/ mat2html.pl, J.C. Kantor, in Perl, 1995:</span>
0091 <span class="comment">%     &lt;http://fresh.t-systems-sfr.com/unix/src/www/mat2html&gt;</span>
0092 <span class="comment">%  2/ htmltools, B. Alsberg, in Matlab, 1997:</span>
0093 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=175&gt;</span>
0094 <span class="comment">%  3/ mtree2html2001, H. Pohlheim, in Perl, 1996, 2001:</span>
0095 <span class="comment">%     &lt;http://www.pohlheim.com/perl_main.html#matlabdocu&gt;</span>
0096 <span class="comment">%  4/ MatlabCodeColorizer, S. Faridani, in C#, 2005:</span>
0097 <span class="comment">%     &lt;http://www.pitchup.com/matlabcolorizer/&gt;</span>
0098 <span class="comment">%  5/ Highlight, G. Flandin, in Matlab, 2003:</span>
0099 <span class="comment">%     &lt;http://www.artefact.tk/software/matlab/highlight/&gt;</span>
0100 <span class="comment">%  6/ mdoc, P. Brinkmann, in Matlab, 2003:</span>
0101 <span class="comment">%     &lt;http://www.math.uiuc.edu/~brinkman/software/mdoc/&gt;</span>
0102 <span class="comment">%  7/ Ocamaweb, Miriad Technologies, in Ocaml, 2002:</span>
0103 <span class="comment">%     &lt;http://ocamaweb.sourceforge.net/&gt;</span>
0104 <span class="comment">%  8/ Matdoc, M. Kaminsky, in Perl, 2003:</span>
0105 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=3498&gt;</span>
0106 <span class="comment">%  9/ Matlab itself, The Mathworks Inc, with HELPWIN, DOC and PUBLISH (R14)</span>
0107 
0108 <span class="comment">%-------------------------------------------------------------------------------</span>
0109 <span class="comment">%- Set up options and default parameters</span>
0110 <span class="comment">%-------------------------------------------------------------------------------</span>
0111 t0 = clock; <span class="comment">% for statistics</span>
0112 msgInvalidPair = <span class="string">'Bad value for argument: ''%s'''</span>;
0113 
0114 options = struct(<span class="string">'verbose'</span>, 1,<span class="keyword">...</span>
0115                  <span class="string">'mFiles'</span>, {{<span class="string">'.'</span>}},<span class="keyword">...</span>
0116                  <span class="string">'htmlDir'</span>, <span class="string">'doc'</span>,<span class="keyword">...</span>
0117                  <span class="string">'recursive'</span>, 0,<span class="keyword">...</span>
0118                  <span class="string">'source'</span>, 1,<span class="keyword">...</span>
0119                  <span class="string">'download'</span>,0,<span class="keyword">...</span>
0120                  <span class="string">'syntaxHighlighting'</span>, 1,<span class="keyword">...</span>
0121                  <span class="string">'tabs'</span>, 4,<span class="keyword">...</span>
0122                  <span class="string">'globalHypertextLinks'</span>, 0,<span class="keyword">...</span>
0123                  <span class="string">'graph'</span>, 0,<span class="keyword">...</span>
0124                  <span class="string">'todo'</span>, 0,<span class="keyword">...</span>
0125                  <span class="string">'load'</span>, 0,<span class="keyword">...</span>
0126                  <span class="string">'save'</span>, 0,<span class="keyword">...</span>
0127                  <span class="string">'search'</span>, 0,<span class="keyword">...</span>
0128                  <span class="string">'helptocxml'</span>, 0,<span class="keyword">...</span>
0129                  <span class="string">'indexFile'</span>, <span class="string">'index'</span>,<span class="keyword">...</span>
0130                  <span class="string">'extension'</span>, <span class="string">'.html'</span>,<span class="keyword">...</span>
0131                  <span class="string">'template'</span>, <span class="string">'blue'</span>,<span class="keyword">...</span>
0132                  <span class="string">'rootdir'</span>, pwd,<span class="keyword">...</span>
0133                  <span class="string">'ignoredDir'</span>, {{<span class="string">'.svn'</span> <span class="string">'cvs'</span>}}, <span class="keyword">...</span>
0134                  <span class="string">'language'</span>, <span class="string">'english'</span>);
0135 
0136 <span class="keyword">if</span> nargin == 1 &amp; isstruct(varargin{1})
0137     paramlist = [ fieldnames(varargin{1}) <span class="keyword">...</span>
0138                   struct2cell(varargin{1}) ]';
0139     paramlist = { paramlist{:} };
0140 <span class="keyword">else</span>
0141     <span class="keyword">if</span> mod(nargin,2)
0142         error(<span class="string">'Invalid parameter/value pair arguments.'</span>);
0143     <span class="keyword">end</span>
0144     paramlist = varargin;
0145 <span class="keyword">end</span>
0146 
0147 optionsnames = lower(fieldnames(options));
0148 <span class="keyword">for</span> i=1:2:length(paramlist)
0149     pname = paramlist{i};
0150     pvalue = paramlist{i+1};
0151     ind = strmatch(lower(pname),optionsnames);
0152     <span class="keyword">if</span> isempty(ind)
0153         error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0154     <span class="keyword">elseif</span> length(ind) &gt; 1
0155         error([<span class="string">'Ambiguous parameter: '''</span> pname <span class="string">'''.'</span>]);
0156     <span class="keyword">end</span>
0157     <span class="keyword">switch</span>(optionsnames{ind})
0158         <span class="keyword">case</span> <span class="string">'verbose'</span>
0159             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0160                 options.verbose = 1;
0161             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0162                 options.verbose = 0;
0163             <span class="keyword">else</span>
0164                 error(sprintf(msgInvalidPair,pname));
0165             <span class="keyword">end</span>
0166         <span class="keyword">case</span> <span class="string">'mfiles'</span>
0167             <span class="keyword">if</span> iscellstr(pvalue)
0168                 options.mFiles = pvalue;
0169             <span class="keyword">elseif</span> ischar(pvalue)
0170                 options.mFiles = cellstr(pvalue);
0171             <span class="keyword">else</span>
0172                 error(sprintf(msgInvalidPair,pname));
0173             <span class="keyword">end</span>
0174             options.load = 0;
0175         <span class="keyword">case</span> <span class="string">'htmldir'</span>
0176             <span class="keyword">if</span> ischar(pvalue)
0177                 <span class="keyword">if</span> isempty(pvalue),
0178                     options.htmlDir = <span class="string">'.'</span>;
0179                 <span class="keyword">else</span>
0180                     options.htmlDir = pvalue;
0181                 <span class="keyword">end</span>
0182             <span class="keyword">else</span>
0183                 error(sprintf(msgInvalidPair,pname));
0184             <span class="keyword">end</span>
0185         <span class="keyword">case</span> <span class="string">'recursive'</span>
0186             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0187                 options.recursive = 1;
0188             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0189                 options.recursive = 0;
0190             <span class="keyword">else</span>
0191                 error(sprintf(msgInvalidPair,pname));
0192             <span class="keyword">end</span>
0193             options.load = 0;
0194         <span class="keyword">case</span> <span class="string">'source'</span>
0195             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0196                 options.source = 1;
0197             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0198                 options.source = 0;
0199             <span class="keyword">else</span>
0200                 error(sprintf(msgInvalidPair,pname));
0201             <span class="keyword">end</span>
0202         <span class="keyword">case</span> <span class="string">'download'</span>
0203             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0204                 options.download = 1;
0205             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0206                 options.download = 0;
0207             <span class="keyword">else</span>
0208                 error(sprintf(msgInvalidPair,pname));
0209             <span class="keyword">end</span>
0210         <span class="keyword">case</span> <span class="string">'syntaxhighlighting'</span>
0211             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0212                 options.syntaxHighlighting = 1;
0213             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0214                 options.syntaxHighlighting = 0;
0215             <span class="keyword">else</span>
0216                 error(sprintf(msgInvalidPair,pname));
0217             <span class="keyword">end</span>
0218         <span class="keyword">case</span> <span class="string">'tabs'</span>
0219             <span class="keyword">if</span> pvalue &gt;= 0
0220                 options.tabs = pvalue;
0221             <span class="keyword">else</span>
0222                 error(sprintf(msgInvalidPair,pname));
0223             <span class="keyword">end</span>
0224         <span class="keyword">case</span> <span class="string">'globalhypertextlinks'</span>
0225             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0226                 options.globalHypertextLinks = 1;
0227             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0228                 options.globalHypertextLinks = 0;
0229             <span class="keyword">else</span>
0230                 error(sprintf(msgInvalidPair,pname));
0231             <span class="keyword">end</span>
0232             options.load = 0;
0233         <span class="keyword">case</span> <span class="string">'graph'</span>
0234             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0235                 options.graph = 1;
0236             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0237                 options.graph = 0;
0238             <span class="keyword">else</span>
0239                 error(sprintf(msgInvalidPair,pname));
0240             <span class="keyword">end</span>
0241         <span class="keyword">case</span> <span class="string">'todo'</span>
0242             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0243                 options.todo = 1;
0244             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0245                 options.todo = 0;
0246             <span class="keyword">else</span>
0247                 error(sprintf(msgInvalidPair,pname));
0248             <span class="keyword">end</span>
0249         <span class="keyword">case</span> <span class="string">'load'</span>
0250             <span class="keyword">if</span> ischar(pvalue)
0251                 <span class="keyword">if</span> exist(pvalue) == 7 <span class="comment">% directory provided</span>
0252                     pvalue = fullfile(pvalue,<span class="string">'m2html.mat'</span>);
0253                 <span class="keyword">end</span>         
0254                 <span class="keyword">try</span>
0255                     load(pvalue);
0256                 <span class="keyword">catch</span>
0257                     error(sprintf(<span class="string">'Unable to load %s.'</span>, pvalue));
0258                 <span class="keyword">end</span>
0259                 options.load = 1;
0260                 [dummy options.template] = fileparts(options.template);
0261             <span class="keyword">else</span>
0262                 error(sprintf(msgInvalidPair,pname));
0263             <span class="keyword">end</span>
0264         <span class="keyword">case</span> <span class="string">'save'</span>
0265             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0266                 options.save = 1;
0267             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0268                 options.save = 0;
0269             <span class="keyword">else</span>
0270                 error(sprintf(msgInvalidPair,pname));
0271             <span class="keyword">end</span>
0272         <span class="keyword">case</span> <span class="string">'search'</span>
0273             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0274                 options.search = 1;
0275             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0276                 options.search = 0;
0277             <span class="keyword">else</span>
0278                 error(sprintf(msgInvalidPair,pname));
0279             <span class="keyword">end</span>
0280         <span class="keyword">case</span> <span class="string">'helptocxml'</span>
0281             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0282                 options.helptocxml = 1;
0283             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0284                 options.helptocxml = 0;
0285             <span class="keyword">else</span>
0286                 error(sprintf(msgInvalidPair,pname));
0287             <span class="keyword">end</span>
0288         <span class="keyword">case</span> <span class="string">'indexfile'</span>
0289             <span class="keyword">if</span> ischar(pvalue)
0290                 options.indexFile = pvalue;
0291             <span class="keyword">else</span>
0292                 error(sprintf(msgInvalidPair,pname));
0293             <span class="keyword">end</span>
0294         <span class="keyword">case</span> <span class="string">'extension'</span>
0295             <span class="keyword">if</span> ischar(pvalue) &amp; pvalue(1) == <span class="string">'.'</span>
0296                 options.extension = pvalue;
0297             <span class="keyword">else</span>
0298                 error(sprintf(msgInvalidPair,pname));
0299             <span class="keyword">end</span>
0300         <span class="keyword">case</span> <span class="string">'template'</span>
0301             <span class="keyword">if</span> ischar(pvalue)
0302                 options.template = pvalue;
0303             <span class="keyword">else</span>
0304                 error(sprintf(msgInvalidPair,pname));
0305             <span class="keyword">end</span>
0306         <span class="keyword">case</span> <span class="string">'ignoreddir'</span>
0307             <span class="keyword">if</span> iscellstr(pvalue)
0308                 options.ignoredDir = pvalue;
0309             <span class="keyword">elseif</span> ischar(pvalue)
0310                 options.ignoredDir = cellstr(pvalue);
0311             <span class="keyword">else</span>
0312                 error(sprintf(msgInvalidPair,pname));
0313             <span class="keyword">end</span>
0314         <span class="keyword">case</span> <span class="string">'language'</span>
0315             <span class="keyword">if</span> ischar(pvalue)
0316                 options.language = pvalue;
0317             <span class="keyword">else</span>
0318                 error(sprintf(msgInvalidPair,pname));
0319             <span class="keyword">end</span>
0320         <span class="keyword">otherwise</span>
0321             error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0322     <span class="keyword">end</span>
0323 <span class="keyword">end</span>
0324 
0325 <span class="comment">%-------------------------------------------------------------------------------</span>
0326 <span class="comment">%- Get template files location</span>
0327 <span class="comment">%-------------------------------------------------------------------------------</span>
0328 s = fileparts(which(mfilename));
0329 options.template = fullfile(s,<span class="string">'templates'</span>,options.template);
0330 <span class="keyword">if</span> exist(options.template) ~= 7
0331     error(<span class="string">'[Template] Unknown template.'</span>);
0332 <span class="keyword">end</span>
0333 
0334 <span class="comment">%-------------------------------------------------------------------------------</span>
0335 <span class="comment">%- Get list of M-files</span>
0336 <span class="comment">%-------------------------------------------------------------------------------</span>
0337 <span class="keyword">if</span> ~options.load
0338     <span class="keyword">if</span> strcmp(options.mFiles,<span class="string">'.'</span>)
0339         d = dir(pwd); d = {d([d.isdir]).name};
0340         options.mFiles = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> options.ignoredDir{:}})}};
0341     <span class="keyword">end</span>
0342     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)">getmfiles</a>(options.mFiles,{},options.recursive,options.ignoredDir);
0343     <span class="keyword">if</span> ~length(mfiles), fprintf(<span class="string">'Nothing to be done.\n'</span>); <span class="keyword">return</span>; <span class="keyword">end</span>
0344     <span class="keyword">if</span> options.verbose,
0345         fprintf(<span class="string">'Found %d M-files.\n'</span>,length(mfiles));
0346     <span class="keyword">end</span>
0347     mfiles = sort(mfiles); <span class="comment">% sort list of M-files in dictionary order</span>
0348 <span class="keyword">end</span>
0349 
0350 <span class="comment">%-------------------------------------------------------------------------------</span>
0351 <span class="comment">%- Get list of (unique) directories and (unique) names</span>
0352 <span class="comment">%-------------------------------------------------------------------------------</span>
0353 <span class="keyword">if</span> ~options.load
0354     mdirs = {};
0355     names = {};
0356     <span class="keyword">for</span> i=1:length(mfiles)
0357         [mdirs{i}, names{i}] = fileparts(mfiles{i});
0358         <span class="keyword">if</span> isempty(mdirs{i}), mdirs{i} = <span class="string">'.'</span>; <span class="keyword">end</span>
0359     <span class="keyword">end</span>
0360 
0361     mdir = unique(mdirs);
0362     <span class="keyword">if</span> options.verbose,
0363         fprintf(<span class="string">'Found %d unique Matlab directories.\n'</span>,length(mdir));
0364     <span class="keyword">end</span>
0365 
0366     name = names;
0367     <span class="comment">%name = unique(names); % output is sorted</span>
0368     <span class="comment">%if options.verbose,</span>
0369     <span class="comment">%    fprintf('Found %d unique Matlab files.\n',length(name));</span>
0370     <span class="comment">%end</span>
0371 <span class="keyword">end</span>
0372 
0373 <span class="comment">%-------------------------------------------------------------------------------</span>
0374 <span class="comment">%- Create output directory, if necessary</span>
0375 <span class="comment">%-------------------------------------------------------------------------------</span>
0376 <span class="keyword">if</span> isempty(dir(options.htmlDir))                                               
0377     <span class="comment">%- Create the top level output directory</span>
0378     <span class="keyword">if</span> options.verbose                                                         
0379         fprintf(<span class="string">'Creating directory %s...\n'</span>,options.htmlDir);                 
0380     <span class="keyword">end</span>                                                                        
0381     <span class="keyword">if</span> options.htmlDir(end) == filesep,                                        
0382         options.htmlDir(end) = [];                                             
0383     <span class="keyword">end</span>                                                                        
0384     [pathdir, namedir] = fileparts(options.htmlDir);                           
0385     <span class="keyword">if</span> isempty(pathdir)                                                        
0386         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                                        
0387     <span class="keyword">else</span>                                                                       
0388         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(pathdir), <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                               
0389     <span class="keyword">end</span>                                                                        
0390     <span class="keyword">if</span> ~status, error(msg); <span class="keyword">end</span>                                                                
0391 <span class="keyword">end</span>                                                                            
0392 
0393 <span class="comment">%-------------------------------------------------------------------------------</span>
0394 <span class="comment">%- Get synopsis, H1 line, script/function, subroutines, cross-references, todo</span>
0395 <span class="comment">%-------------------------------------------------------------------------------</span>
0396 <span class="keyword">if</span> ~options.load
0397     synopsis   = cell(size(mfiles));
0398     h1line     = cell(size(mfiles));
0399     subroutine = cell(size(mfiles));
0400     hrefs      = sparse(length(mfiles), length(mfiles));
0401     todo       = struct(<span class="string">'mfile'</span>,[], <span class="string">'line'</span>,[], <span class="string">'comment'</span>,{{}});
0402     ismex      = zeros(length(mfiles), length(mexexts));
0403     statlist   = {};
0404     statinfo   = sparse(1,length(mfiles));
0405     kw         = cell(size(mfiles));
0406     freq       = cell(size(mfiles));
0407 
0408     <span class="keyword">for</span> i=1:length(mfiles)
0409         <span class="keyword">if</span> options.verbose
0410             fprintf(<span class="string">'Processing file %s...'</span>,mfiles{i});
0411         <span class="keyword">end</span>
0412         s = mfileparse(mfiles{i}, mdirs, names, options);
0413         synopsis{i}   = s.synopsis;
0414         h1line{i}     = s.h1line;
0415         subroutine{i} = s.subroutine;
0416         hrefs(i,:)    = s.hrefs;
0417         todo.mfile    = [todo.mfile repmat(i,1,length(s.todo.line))];
0418         todo.line     = [todo.line s.todo.line];
0419         todo.comment  = {todo.comment{:} s.todo.comment{:}};
0420         ismex(i,:)    = s.ismex;
0421         <span class="keyword">if</span> options.search
0422             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'search...'</span>); <span class="keyword">end</span>
0423             [kw{i}, freq{i}] = searchindex(mfiles{i});
0424             statlist = union(statlist, kw{i});
0425         <span class="keyword">end</span>
0426         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0427     <span class="keyword">end</span>
0428     hrefs = hrefs &gt; 0;
0429     <span class="keyword">if</span> options.search
0430         <span class="keyword">if</span> options.verbose
0431             fprintf(<span class="string">'Creating the search index...'</span>);
0432         <span class="keyword">end</span>
0433         statinfo = sparse(length(statlist),length(mfiles));
0434         <span class="keyword">for</span> i=1:length(mfiles)
0435             i1 = find(ismember(statlist, kw{i}));
0436             i2 = repmat(i,1,length(i1));
0437             <span class="keyword">if</span> ~isempty(i1)
0438                 statinfo(sub2ind(size(statinfo),i1,i2)) = freq{i};
0439             <span class="keyword">end</span>
0440             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'.'</span>); <span class="keyword">end</span>
0441         <span class="keyword">end</span>
0442         clear kw freq;
0443         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0444     <span class="keyword">end</span>
0445 <span class="keyword">end</span>
0446 
0447 <span class="comment">%-------------------------------------------------------------------------------</span>
0448 <span class="comment">%- Save M-filenames and cross-references for further analysis</span>
0449 <span class="comment">%-------------------------------------------------------------------------------</span>
0450 matfilesave = <span class="string">'m2html.mat'</span>;
0451 
0452 <span class="keyword">if</span> options.save
0453     <span class="keyword">if</span> options.verbose
0454         fprintf(<span class="string">'Saving MAT file %s...\n'</span>,matfilesave);
0455     <span class="keyword">end</span>
0456     save(fullfile(options.htmlDir,matfilesave), <span class="keyword">...</span>
0457         <span class="string">'mfiles'</span>, <span class="string">'names'</span>, <span class="string">'mdirs'</span>, <span class="string">'name'</span>, <span class="string">'mdir'</span>, <span class="string">'options'</span>, <span class="keyword">...</span>
0458         <span class="string">'hrefs'</span>, <span class="string">'synopsis'</span>, <span class="string">'h1line'</span>, <span class="string">'subroutine'</span>, <span class="string">'todo'</span>, <span class="string">'ismex'</span>, <span class="keyword">...</span>
0459         <span class="string">'statlist'</span>, <span class="string">'statinfo'</span>);
0460 <span class="keyword">end</span>
0461 
0462 <span class="comment">%-------------------------------------------------------------------------------</span>
0463 <span class="comment">%- Setup the output directories</span>
0464 <span class="comment">%-------------------------------------------------------------------------------</span>
0465 <span class="keyword">for</span> i=1:length(mdir)
0466     <span class="keyword">if</span> exist(fullfile(options.htmlDir,mdir{i})) ~= 7
0467         ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
0468         <span class="keyword">for</span> j=1:length(ldir)
0469             <span class="keyword">if</span> exist(fullfile(options.htmlDir,ldir{1:j})) ~= 7
0470                 <span class="comment">%- Create the output directory</span>
0471                 <span class="keyword">if</span> options.verbose
0472                     fprintf(<span class="string">'Creating directory %s...\n'</span>,<span class="keyword">...</span>
0473                             fullfile(options.htmlDir,ldir{1:j}));
0474                 <span class="keyword">end</span>
0475                 <span class="keyword">if</span> j == 1
0476                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0477                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(ldir{1}));
0478                 <span class="keyword">else</span>
0479                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0480                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(fullfile(ldir{1:j})));
0481                 <span class="keyword">end</span>
0482                 error(msg);
0483             <span class="keyword">end</span>
0484         <span class="keyword">end</span>
0485     <span class="keyword">end</span>
0486 <span class="keyword">end</span>
0487 
0488 <span class="comment">%-------------------------------------------------------------------------------</span>
0489 <span class="comment">%- Write the master index file</span>
0490 <span class="comment">%-------------------------------------------------------------------------------</span>
0491 tpl_master = <span class="string">'master.tpl'</span>;
0492 tpl_master_identifier_nbyline = 4;
0493 php_search = <span class="string">'search.php'</span>;
0494 dotbase = <span class="string">'graph'</span>;
0495 
0496 <span class="comment">%- Create the HTML template</span>
0497 tpl = template(options.template,<span class="string">'remove'</span>);
0498 tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MASTER'</span>,tpl_master);
0499 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'rowdir'</span>,<span class="string">'rowdirs'</span>);
0500 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'idrow'</span>,<span class="string">'idrows'</span>);
0501 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'idrow'</span>,<span class="string">'idcolumn'</span>,<span class="string">'idcolumns'</span>);
0502 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'search'</span>,<span class="string">'searchs'</span>);
0503 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0504 
0505 <span class="comment">%- Open for writing the HTML master index file</span>
0506 curfile = fullfile(options.htmlDir,[options.indexFile options.extension]);
0507 <span class="keyword">if</span> options.verbose
0508     fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0509 <span class="keyword">end</span>
0510 fid = openfile(curfile,<span class="string">'w'</span>);
0511 
0512 <span class="comment">%- Set some template variables</span>
0513 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0514                             datestr(now,13)]);
0515 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0516 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DIRS'</span>, sprintf(<span class="string">'%s '</span>,mdir{:}));
0517 
0518 <span class="comment">%- Print list of unique directories</span>
0519 <span class="keyword">for</span> i=1:length(mdir)
0520     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_DIR'</span>,<span class="keyword">...</span>
0521               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdir{i},[options.indexFile options.extension]));
0522     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DIR'</span>,mdir{i});
0523     tpl = parse(tpl,<span class="string">'rowdirs'</span>,<span class="string">'rowdir'</span>,1);
0524 <span class="keyword">end</span>
0525 
0526 <span class="comment">%- Print full list of M-files (sorted by column)</span>
0527 [sortnames, ind] = sort(names);
0528 m_mod = mod(length(sortnames), tpl_master_identifier_nbyline);
0529 ind = [ind zeros(1,tpl_master_identifier_nbyline-m_mod)];
0530 m_floor = floor(length(ind) / tpl_master_identifier_nbyline);
0531 ind = reshape(ind,m_floor,tpl_master_identifier_nbyline)';
0532 
0533 <span class="keyword">for</span> i=1:prod(size(ind))
0534     <span class="keyword">if</span> ind(i)
0535         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="keyword">...</span>
0536             <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{ind(i)},[names{ind(i)} options.extension]));
0537         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,mdirs{ind(i)});
0538         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,names{ind(i)});
0539         tpl = parse(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0540     <span class="keyword">else</span>
0541         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="string">''</span>);
0542         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,<span class="string">''</span>);
0543         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,<span class="string">''</span>);
0544         tpl = parse(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0545     <span class="keyword">end</span>
0546     <span class="keyword">if</span> mod(i,tpl_master_identifier_nbyline) == 0
0547         tpl = parse(tpl,<span class="string">'idrows'</span>,<span class="string">'idrow'</span>,1);
0548         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'idcolumns'</span>,<span class="string">''</span>);
0549     <span class="keyword">end</span>
0550 <span class="keyword">end</span>
0551 
0552 <span class="comment">%- Add a search form if necessary</span>
0553 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'searchs'</span>,<span class="string">''</span>);
0554 <span class="keyword">if</span> options.search
0555     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0556     tpl = parse(tpl,<span class="string">'searchs'</span>,<span class="string">'search'</span>,1);
0557 <span class="keyword">end</span>
0558 
0559 <span class="comment">%- Link to a full dependency graph, if necessary</span>
0560 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0561 <span class="keyword">if</span> options.graph &amp; options.globalHypertextLinks &amp; length(mdir) &gt; 1
0562     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0563     tpl = parse(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0564 <span class="keyword">end</span>
0565 
0566 <span class="comment">%- Print the template in the HTML file</span>
0567 tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MASTER'</span>);
0568 fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0569 fclose(fid);
0570 
0571 <span class="comment">%-------------------------------------------------------------------------------</span>
0572 <span class="comment">%- Copy template files (CSS, images, ...)</span>
0573 <span class="comment">%-------------------------------------------------------------------------------</span>
0574 <span class="comment">% Get list of files</span>
0575 d = dir(options.template);
0576 d = {d(~[d.isdir]).name};
0577 <span class="comment">% Copy files</span>
0578 <span class="keyword">for</span> i=1:length(d)
0579     [p, n, ext] = fileparts(d{i});
0580     <span class="keyword">if</span> ~strcmp(ext,<span class="string">'.tpl'</span>) <span class="keyword">...</span><span class="comment"> % do not copy .tpl files</span>
0581        &amp; ~strcmp([n ext],<span class="string">'Thumbs.db'</span>) <span class="comment">% do not copy this Windows generated file</span>
0582         <span class="keyword">if</span> isempty(dir(fullfile(options.htmlDir,d{i})))
0583             <span class="keyword">if</span> options.verbose
0584                 fprintf(<span class="string">'Copying template file %s...\n'</span>,d{i});
0585             <span class="keyword">end</span>
0586             <span class="comment">%- there is a bug with &lt;copyfile&gt; in Matlab 6.5 :</span>
0587             <span class="comment">%   http://www.mathworks.com/support/solutions/data/1-1B5JY.html</span>
0588             <span class="comment">%- and &lt;copyfile&gt; does not overwrite files even if newer...</span>
0589             [status, errmsg] = copyfile(fullfile(options.template,d{i}),<span class="keyword">...</span>
0590                                         options.htmlDir);
0591             <span class="comment">%- If you encounter this bug, please uncomment one of the following lines</span>
0592             <span class="comment">% eval(['!cp -rf ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0593             <span class="comment">% eval(['!copy ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0594             <span class="comment">% status = 1;</span>
0595             <span class="keyword">if</span> ~status
0596                 <span class="keyword">if</span> ~isempty(errmsg)
0597                     error(errmsg)
0598                 <span class="keyword">else</span>
0599                     warning(sprintf([<span class="string">'&lt;copyfile&gt; failed to do its job...\n'</span> <span class="keyword">...</span>
0600                 <span class="string">'This is a known bug in Matlab 6.5 (R13).\n'</span> <span class="keyword">...</span>
0601                 <span class="string">'See http://www.mathworks.com/support/solutions/data/1-1B5JY.html'</span>]));
0602                 <span class="keyword">end</span>
0603             <span class="keyword">end</span>
0604         <span class="keyword">end</span>
0605     <span class="keyword">end</span>
0606 <span class="keyword">end</span>
0607 
0608 <span class="comment">%-------------------------------------------------------------------------------</span>
0609 <span class="comment">%- Search engine (index file and PHP script)</span>
0610 <span class="comment">%-------------------------------------------------------------------------------</span>
0611 tpl_search = <span class="string">'search.tpl'</span>;
0612 idx_search = <span class="string">'search.idx'</span>;
0613 
0614 <span class="comment">% TODO % improving the fill in of 'statlist' and 'statinfo'</span>
0615 <span class="comment">% TODO % improving the search template file and update the CSS file</span>
0616 
0617 <span class="keyword">if</span> options.search
0618     <span class="comment">%- Write the search index file in output directory</span>
0619     <span class="keyword">if</span> options.verbose
0620         fprintf(<span class="string">'Creating Search Index file %s...\n'</span>, idx_search);
0621     <span class="keyword">end</span>
0622     docinfo = cell(length(mfiles),2);
0623     <span class="keyword">for</span> i=1:length(mfiles)
0624         docinfo{i,1} = h1line{i};
0625         docinfo{i,2} = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{i}, [names{i} options.extension]);
0626     <span class="keyword">end</span>
0627     doxywrite(fullfile(options.htmlDir,idx_search),statlist,statinfo,docinfo);
0628     
0629     <span class="comment">%- Create the PHP template</span>
0630     tpl = template(options.template,<span class="string">'remove'</span>);
0631     tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_SEARCH'</span>,tpl_search);
0632     
0633     <span class="comment">%- Open for writing the PHP search script</span>
0634     curfile = fullfile(options.htmlDir, php_search); 
0635     <span class="keyword">if</span> options.verbose
0636         fprintf(<span class="string">'Creating PHP script %s...\n'</span>,curfile);
0637     <span class="keyword">end</span>
0638     fid = openfile(curfile,<span class="string">'w'</span>);
0639     
0640     <span class="comment">%- Set template fields</span>
0641     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0642     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<span class="string">'./'</span>);
0643     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0644                                 datestr(now,13)]);
0645     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'IDXFILE'</span>,idx_search);
0646     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0647     
0648     <span class="comment">%- Print the template in the HTML file</span>
0649     tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_SEARCH'</span>);
0650     fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0651     fclose(fid);
0652 <span class="keyword">end</span>
0653 
0654 <span class="comment">%-------------------------------------------------------------------------------</span>
0655 <span class="comment">%- Create &lt;helptoc.xml&gt; needed to display hierarchical entries in Contents panel</span>
0656 <span class="comment">%-------------------------------------------------------------------------------</span>
0657 <span class="comment">% See http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_env/guiref16.html</span>
0658 <span class="comment">% and http://www.mathworks.com/support/solutions/data/1-18U6Q.html?solution=1-18U6Q</span>
0659 
0660 <span class="comment">% TODO % display directories in TOC hierarchically instead of linearly</span>
0661 <span class="keyword">if</span> options.helptocxml
0662     curfile = fullfile(options.htmlDir, <span class="string">'helptoc.xml'</span>);
0663     <span class="keyword">if</span> options.verbose
0664         fprintf(<span class="string">'Creating XML Table-Of-Content %s...\n'</span>,curfile);
0665     <span class="keyword">end</span>
0666     fid = openfile(curfile,<span class="string">'w'</span>);
0667     fprintf(fid,<span class="string">'&lt;?xml version=''1.0'' encoding=''ISO-8859-1'' ?&gt;\n'</span>);
0668     fprintf(fid,<span class="string">'&lt;!-- $Date: %s $ --&gt;\n\n'</span>, datestr(now,31));
0669     fprintf(fid,<span class="string">'&lt;toc version=&quot;1.0&quot;&gt;\n\n'</span>);
0670     fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0671         <span class="string">'image=&quot;$toolbox/matlab/icons/book_mat.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0672         [options.indexFile options.extension],<span class="string">'Toolbox'</span>);
0673     <span class="keyword">for</span> i=1:length(mdir)
0674         fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0675             <span class="string">'image=&quot;$toolbox/matlab/icons/reficon.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0676             fullfile(mdir{i}, <span class="keyword">...</span>
0677                 [options.indexFile options.extension]),mdir{i});
0678         <span class="keyword">if</span> options.graph
0679             fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0680             <span class="string">'image=&quot;$toolbox/matlab/icons/simulinkicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0681                 fullfile(mdir{i},<span class="keyword">...</span>
0682                 [dotbase options.extension]),<span class="string">'Dependency Graph'</span>);
0683         <span class="keyword">end</span>
0684         <span class="keyword">if</span> options.todo
0685             <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0686                 fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0687                 <span class="string">'image=&quot;$toolbox/matlab/icons/demoicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0688                     fullfile(mdir{i},<span class="keyword">...</span>
0689                     [<span class="string">'todo'</span> options.extension]),<span class="string">'Todo list'</span>);
0690             <span class="keyword">end</span>
0691         <span class="keyword">end</span>
0692         <span class="keyword">for</span> j=1:length(mdirs)
0693             <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0694                 curfile = fullfile(mdir{i},<span class="keyword">...</span>
0695                     [names{j} options.extension]);
0696                 fprintf(fid,<span class="string">'\t&lt;tocitem target=&quot;%s&quot;&gt;%s&lt;/tocitem&gt;\n'</span>, <span class="keyword">...</span>
0697                     curfile,names{j});
0698             <span class="keyword">end</span>
0699         <span class="keyword">end</span>
0700         fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0701     <span class="keyword">end</span>
0702     fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0703     fprintf(fid,<span class="string">'\n&lt;/toc&gt;\n'</span>);
0704     fclose(fid);
0705 <span class="keyword">end</span>
0706 
0707 <span class="comment">%-------------------------------------------------------------------------------</span>
0708 <span class="comment">%- Write an index for each output directory</span>
0709 <span class="comment">%-------------------------------------------------------------------------------</span>
0710 tpl_mdir = <span class="string">'mdir.tpl'</span>;
0711 tpl_mdir_link = <span class="string">'&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0712 <span class="comment">%dotbase defined earlier</span>
0713 
0714 <span class="comment">%- Create the HTML template</span>
0715 tpl = template(options.template,<span class="string">'remove'</span>);
0716 tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MDIR'</span>,tpl_mdir);
0717 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'row-m'</span>,<span class="string">'rows-m'</span>);
0718 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'row-m'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0719 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'othermatlab'</span>,<span class="string">'other'</span>);
0720 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'othermatlab'</span>,<span class="string">'row-other'</span>,<span class="string">'rows-other'</span>);
0721 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'subfolder'</span>,<span class="string">'subfold'</span>);
0722 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'subfolder'</span>,<span class="string">'subdir'</span>,<span class="string">'subdirs'</span>);
0723 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'todolist'</span>,<span class="string">'todolists'</span>);
0724 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0725 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0726                             datestr(now,13)]);
0727 
0728 <span class="keyword">for</span> i=1:length(mdir)
0729     <span class="comment">%- Open for writing each output directory index file</span>
0730     curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0731                        [options.indexFile options.extension]);
0732     <span class="keyword">if</span> options.verbose
0733         fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0734     <span class="keyword">end</span>
0735     fid = openfile(curfile,<span class="string">'w'</span>);
0736 
0737     <span class="comment">%- Set template fields</span>
0738     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,     [options.indexFile options.extension]);
0739     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0740     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,      mdir{i});
0741     
0742     <span class="comment">%- Display Matlab m-files, their H1 line and their Mex status</span>
0743     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'rows-m'</span>,<span class="string">''</span>);
0744     <span class="keyword">for</span> j=1:length(mdirs)
0745         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0746             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME'</span>, [names{j} options.extension]);
0747             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,   names{j});
0748             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>, h1line{j});
0749             <span class="keyword">if</span> any(ismex(j,:))
0750                 tpl = parse(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
0751             <span class="keyword">else</span>
0752                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>,<span class="string">''</span>);
0753             <span class="keyword">end</span>
0754             tpl = parse(tpl,<span class="string">'rows-m'</span>,<span class="string">'row-m'</span>,1);
0755         <span class="keyword">end</span>
0756     <span class="keyword">end</span>
0757     
0758     <span class="comment">%- Display other Matlab-specific files (.mat,.mdl,.p)</span>
0759     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'other'</span>,<span class="string">''</span>);
0760     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'rows-other'</span>,<span class="string">''</span>);
0761     w = what(mdir{i}); w = w(1);
0762     w = {w.mat{:} w.mdl{:} w.p{:}};
0763     <span class="keyword">for</span> j=1:length(w)
0764         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'OTHERFILE'</span>,w{j});
0765         tpl = parse(tpl,<span class="string">'rows-other'</span>,<span class="string">'row-other'</span>,1);
0766     <span class="keyword">end</span>
0767     <span class="keyword">if</span> ~isempty(w)
0768         tpl = parse(tpl,<span class="string">'other'</span>,<span class="string">'othermatlab'</span>);
0769     <span class="keyword">end</span>
0770     
0771     <span class="comment">%- Display subsequent directories and classes</span>
0772     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'subdirs'</span>,<span class="string">''</span>);
0773     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'subfold'</span>,<span class="string">''</span>);
0774     d = dir(mdir{i});
0775     d = {d([d.isdir]).name};
0776     d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> options.ignoredDir{:}})}};
0777     <span class="keyword">for</span> j=1:length(d)
0778         <span class="keyword">if</span> ismember(fullfile(mdir{i},d{j}),mdir)
0779             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,<span class="keyword">...</span>
0780                 sprintf(tpl_mdir_link,<span class="keyword">...</span>
0781                 <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(d{j},[options.indexFile options.extension]),d{j}));
0782         <span class="keyword">else</span>
0783             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,d{j});
0784         <span class="keyword">end</span>
0785         tpl = parse(tpl,<span class="string">'subdirs'</span>,<span class="string">'subdir'</span>,1);
0786     <span class="keyword">end</span>
0787     <span class="keyword">if</span> ~isempty(d)
0788         tpl = parse(tpl,<span class="string">'subfold'</span>,<span class="string">'subfolder'</span>);
0789     <span class="keyword">end</span>
0790     
0791     <span class="comment">%- Link to the TODO list if necessary</span>
0792     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'todolists'</span>,<span class="string">''</span>);
0793     <span class="keyword">if</span> options.todo
0794         <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0795             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LTODOLIST'</span>,[<span class="string">'todo'</span> options.extension]);
0796             tpl = parse(tpl,<span class="string">'todolists'</span>,<span class="string">'todolist'</span>,1);
0797         <span class="keyword">end</span>
0798     <span class="keyword">end</span>
0799     
0800     <span class="comment">%- Link to the dependency graph if necessary</span>
0801     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0802     <span class="keyword">if</span> options.graph
0803         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0804         tpl = parse(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0805     <span class="keyword">end</span>
0806     
0807     <span class="comment">%- Print the template in the HTML file</span>
0808     tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MDIR'</span>);
0809     fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0810     fclose(fid);
0811 <span class="keyword">end</span>
0812 
0813 <span class="comment">%-------------------------------------------------------------------------------</span>
0814 <span class="comment">%- Write a TODO list file for each output directory, if necessary</span>
0815 <span class="comment">%-------------------------------------------------------------------------------</span>
0816 tpl_todo = <span class="string">'todo.tpl'</span>;
0817 
0818 <span class="keyword">if</span> options.todo
0819     <span class="comment">%- Create the HTML template</span>
0820     tpl = template(options.template,<span class="string">'remove'</span>);
0821     tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_TODO'</span>,tpl_todo);
0822     tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_TODO'</span>,<span class="string">'filelist'</span>,<span class="string">'filelists'</span>);
0823     tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'filelist'</span>,<span class="string">'row'</span>,<span class="string">'rows'</span>);
0824     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0825                                 datestr(now,13)]);
0826 
0827     <span class="keyword">for</span> i=1:length(mdir)
0828         mfilestodo = intersect(find(strcmp(mdir{i},mdirs)),todo.mfile);
0829         <span class="keyword">if</span> ~isempty(mfilestodo)
0830             <span class="comment">%- Open for writing each TODO list file</span>
0831             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0832                                [<span class="string">'todo'</span> options.extension]);
0833             <span class="keyword">if</span> options.verbose
0834                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0835             <span class="keyword">end</span>
0836             fid = openfile(curfile,<span class="string">'w'</span>);
0837             
0838             <span class="comment">%- Set template fields</span>
0839             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0840             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0841             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0842             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'filelists'</span>,  <span class="string">''</span>);
0843     
0844             <span class="keyword">for</span> k=1:length(mfilestodo)
0845                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MFILE'</span>,names{mfilestodo(k)});
0846                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'rows'</span>,<span class="string">''</span>);
0847                 nbtodo = find(todo.mfile == mfilestodo(k));
0848                 <span class="keyword">for</span> l=1:length(nbtodo)
0849                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NBLINE'</span>,<span class="keyword">...</span>
0850                         [names{mfilestodo(k)} <span class="keyword">...</span>
0851                             options.extension <span class="keyword">...</span>
0852                             <span class="string">'#l'</span> num2str(todo.line(nbtodo(l)))]);
0853                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NBLINE'</span>,num2str(todo.line(nbtodo(l))));
0854                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'COMMENT'</span>,todo.comment{nbtodo(l)});
0855                     tpl = parse(tpl,<span class="string">'rows'</span>,<span class="string">'row'</span>,1);
0856                 <span class="keyword">end</span>
0857                 tpl = parse(tpl,<span class="string">'filelists'</span>,<span class="string">'filelist'</span>,1);
0858             <span class="keyword">end</span>
0859     
0860             <span class="comment">%- Print the template in the HTML file</span>
0861             tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_TODO'</span>);
0862             fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0863             fclose(fid);
0864         <span class="keyword">end</span>
0865     <span class="keyword">end</span>
0866 <span class="keyword">end</span>
0867 
0868 <span class="comment">%-------------------------------------------------------------------------------</span>
0869 <span class="comment">%- Create dependency graphs using GraphViz, if requested</span>
0870 <span class="comment">%-------------------------------------------------------------------------------</span>
0871 tpl_graph = <span class="string">'graph.tpl'</span>;
0872 <span class="comment">% You may have to modify the following line with Matlab7 (R14) to specify</span>
0873 <span class="comment">% the full path to where GraphViz is installed</span>
0874 dot_exec  = <span class="string">'dot'</span>;
0875 <span class="comment">%dotbase defined earlier</span>
0876 
0877 <span class="keyword">if</span> options.graph
0878     <span class="comment">%- Create the HTML template</span>
0879     tpl = template(options.template,<span class="string">'remove'</span>);
0880     tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_GRAPH'</span>,tpl_graph);
0881     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0882                                 datestr(now,13)]);
0883     
0884     <span class="comment">%- Create a full dependency graph for all directories if possible</span>
0885     <span class="keyword">if</span> options.globalHypertextLinks &amp; length(mdir) &gt; 1
0886         mdotfile = fullfile(options.htmlDir,[dotbase <span class="string">'.dot'</span>]);
0887         <span class="keyword">if</span> options.verbose
0888             fprintf(<span class="string">'Creating full dependency graph %s...'</span>,mdotfile);
0889         <span class="keyword">end</span>
0890         <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({hrefs, names, options, mdirs}, mdotfile); <span class="comment">%mfiles</span>
0891         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0892                 fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0893                 fullfile(options.htmlDir,[dotbase <span class="string">'.png'</span>]));
0894         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0895         fid = openfile(fullfile(options.htmlDir, [dotbase options.extension]),<span class="string">'w'</span>);
0896         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0897         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0898         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       <span class="string">'the whole toolbox'</span>);
0899         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0900         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed...</span>
0901             fmap = openfile(fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0902             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0903             fclose(fmap);
0904         <span class="keyword">end</span>
0905         tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0906         fprintf(fid,<span class="string">'%s'</span>, get(tpl,<span class="string">'OUT'</span>));
0907         fclose(fid);
0908     <span class="keyword">end</span>
0909     
0910     <span class="comment">%- Create a dependency graph for each output directory</span>
0911     <span class="keyword">for</span> i=1:length(mdir)
0912         mdotfile = fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.dot'</span>]);
0913         <span class="keyword">if</span> options.verbose
0914             fprintf(<span class="string">'Creating dependency graph %s...'</span>,mdotfile);
0915         <span class="keyword">end</span>
0916         ind = find(strcmp(mdirs,mdir{i}));
0917         href1 = zeros(length(ind),length(hrefs));
0918         <span class="keyword">for</span> j=1:length(hrefs), href1(:,j) = hrefs(ind,j); <span class="keyword">end</span>
0919         href2 = zeros(length(ind));
0920         <span class="keyword">for</span> j=1:length(ind), href2(j,:) = href1(j,ind); <span class="keyword">end</span>
0921         <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({href2, {names{ind}}, options}, mdotfile); <span class="comment">%{mfiles{ind}}</span>
0922         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0923                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0924                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.png'</span>]));
0925         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0926         fid = openfile(fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0927             [dotbase options.extension]),<span class="string">'w'</span>);
0928         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0929         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0930         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0931         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0932         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed, no '.map' file has been created</span>
0933             fmap = openfile(fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0934             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0935             fclose(fmap);
0936         <span class="keyword">end</span>
0937         tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0938         fprintf(fid,<span class="string">'%s'</span>, get(tpl,<span class="string">'OUT'</span>));
0939         fclose(fid);
0940     <span class="keyword">end</span>
0941 <span class="keyword">end</span>
0942 
0943 <span class="comment">%-------------------------------------------------------------------------------</span>
0944 <span class="comment">%- Write an HTML file for each M-file</span>
0945 <span class="comment">%-------------------------------------------------------------------------------</span>
0946 <span class="comment">%- List of Matlab keywords (output from iskeyword)</span>
0947 matlabKeywords = {<span class="string">'break'</span>, <span class="string">'case'</span>, <span class="string">'catch'</span>, <span class="string">'continue'</span>, <span class="string">'elseif'</span>, <span class="string">'else'</span>, <span class="keyword">...</span>
0948                   <span class="string">'end'</span>, <span class="string">'for'</span>, <span class="string">'function'</span>, <span class="string">'global'</span>, <span class="string">'if'</span>, <span class="string">'otherwise'</span>, <span class="keyword">...</span>
0949                   <span class="string">'persistent'</span>, <span class="string">'return'</span>, <span class="string">'switch'</span>, <span class="string">'try'</span>, <span class="string">'while'</span>};
0950                   <span class="comment">%'keyboard', 'pause', 'eps', 'NaN', 'Inf'</span>
0951 
0952 tpl_mfile = <span class="string">'mfile.tpl'</span>;
0953 
0954 tpl_mfile_code     = <span class="string">'&lt;a href=&quot;%s&quot; class=&quot;code&quot; title=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0955 tpl_mfile_keyword  = <span class="string">'&lt;span class=&quot;keyword&quot;&gt;%s&lt;/span&gt;'</span>;
0956 tpl_mfile_comment  = <span class="string">'&lt;span class=&quot;comment&quot;&gt;%s&lt;/span&gt;'</span>;
0957 tpl_mfile_string   = <span class="string">'&lt;span class=&quot;string&quot;&gt;%s&lt;/span&gt;'</span>;
0958 tpl_mfile_aname    = <span class="string">'&lt;a name=&quot;%s&quot; href=&quot;#_subfunctions&quot; class=&quot;code&quot;&gt;%s&lt;/a&gt;'</span>;
0959 tpl_mfile_line     = <span class="string">'%04d %s\n'</span>;
0960 
0961 <span class="comment">%- Delimiters used in strtok: some of them may be useless (% &quot; .), removed '.'</span>
0962 strtok_delim = sprintf(<span class="string">' \t\n\r(){}[]&lt;&gt;+-*~!|\\@&amp;/,:;=&quot;''%%'</span>);
0963 
0964 <span class="comment">%- Create the HTML template</span>
0965 tpl = template(options.template,<span class="string">'remove'</span>);
0966 tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MFILE'</span>,tpl_mfile);
0967 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'pathline'</span>,<span class="string">'pl'</span>);
0968 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0969 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'script'</span>,<span class="string">'scriptfile'</span>);
0970 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcall'</span>,<span class="string">'crossrefcalls'</span>);
0971 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcalled'</span>,<span class="string">'crossrefcalleds'</span>);
0972 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'subfunction'</span>,<span class="string">'subf'</span>);
0973 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'subfunction'</span>,<span class="string">'onesubfunction'</span>,<span class="string">'onesubf'</span>);
0974 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'source'</span>,<span class="string">'thesource'</span>);
0975 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'download'</span>,<span class="string">'downloads'</span>);
0976 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0977                             datestr(now,13)]);
0978 
0979 nblinetot = 0;
0980 <span class="keyword">for</span> i=1:length(mdir)
0981     <span class="keyword">for</span> j=1:length(mdirs)
0982         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0983         
0984             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0985                                [names{j} options.extension]);
0986                                
0987             <span class="comment">%- Copy M-file for download, if necessary</span>
0988             <span class="keyword">if</span> options.download
0989                 <span class="keyword">if</span> options.verbose
0990                     fprintf(<span class="string">'Copying M-file %s.m to %s...\n'</span>,names{j},<span class="keyword">...</span>
0991                         fullfile(options.htmlDir,mdir{i}));
0992                 <span class="keyword">end</span>
0993                 [status, errmsg] = copyfile(mfiles{j},<span class="keyword">...</span>
0994                     fullfile(options.htmlDir,mdir{i}));
0995                 error(errmsg);
0996             <span class="keyword">end</span>
0997             
0998             <span class="comment">%- Open for writing the HTML file</span>
0999             <span class="keyword">if</span> options.verbose
1000                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
1001             <span class="keyword">end</span>
1002             fid = openfile(curfile,<span class="string">'w'</span>);
1003             <span class="keyword">if</span> strcmp(names{j},options.indexFile)
1004                 fprintf([<span class="string">'Warning: HTML index file %s will be '</span> <span class="keyword">...</span>
1005                         <span class="string">'overwritten by Matlab function %s.\n'</span>], <span class="keyword">...</span>
1006                         [options.indexFile options.extension], mfiles{j});
1007             <span class="keyword">end</span>
1008             
1009             <span class="comment">%- Open for reading the M-file</span>
1010             fid2 = openfile(mfiles{j},<span class="string">'r'</span>);
1011             
1012             <span class="comment">%- Set some template fields</span>
1013             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>, [options.indexFile options.extension]);
1014             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,       <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
1015             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,             mdirs{j});
1016             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,             names{j});
1017             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>,           <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(h1line{j}));
1018             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'scriptfile'</span>,       <span class="string">''</span>);
1019             <span class="keyword">if</span> isempty(synopsis{j})
1020                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>,get(tpl,<span class="string">'var'</span>,<span class="string">'script'</span>));
1021             <span class="keyword">else</span>
1022                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>, synopsis{j});
1023             <span class="keyword">end</span>
1024             s = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
1025             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'pl'</span>,<span class="string">''</span>);
1026             <span class="keyword">for</span> k=1:length(s)
1027                 c = cell(1,k); <span class="keyword">for</span> l=1:k, c{l} = filesep; <span class="keyword">end</span>
1028                 cpath = {s{1:k};c{:}}; cpath = [cpath{:}];
1029                 <span class="keyword">if</span> ~isempty(cpath), cpath = cpath(1:end-1); <span class="keyword">end</span>
1030                 <span class="keyword">if</span> ismember(cpath,mdir)
1031                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,[repmat(<span class="string">'../'</span>,<span class="keyword">...</span>
1032                         1,length(s)-k) options.indexFile options.extension]);
1033                 <span class="keyword">else</span>
1034                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,<span class="string">'#'</span>);
1035                 <span class="keyword">end</span>
1036                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PATHDIR'</span>,s{k});
1037                 tpl = parse(tpl,<span class="string">'pl'</span>,<span class="string">'pathline'</span>,1);
1038             <span class="keyword">end</span>
1039             
1040             <span class="comment">%- Handle mex files</span>
1041             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>, <span class="string">''</span>);
1042             samename = dir(fullfile(mdir{i},[names{j}    <span class="string">'.*'</span>]));
1043             samename = {samename.name};
1044             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'mex'</span>);
1045             <span class="keyword">for</span> k=1:length(samename)
1046                 [dummy, dummy, ext] = fileparts(samename{k});
1047                 <span class="keyword">switch</span> ext
1048                     <span class="keyword">case</span> <span class="string">'.c'</span>
1049                         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c'</span>);
1050                     <span class="keyword">case</span> {<span class="string">'.cpp'</span> <span class="string">'.c++'</span> <span class="string">'.cxx'</span> <span class="string">'.C'</span>}
1051                         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c++'</span>);
1052                     <span class="keyword">case</span> {<span class="string">'.for'</span> <span class="string">'.f'</span> <span class="string">'.FOR'</span> <span class="string">'.F'</span>}
1053                         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'fortran'</span>);
1054                     <span class="keyword">otherwise</span>
1055                         <span class="comment">%- Unknown mex file source</span>
1056                 <span class="keyword">end</span>
1057             <span class="keyword">end</span>
1058             [exts, platform] = mexexts;
1059             mexplatforms = sprintf(<span class="string">'%s, '</span>,platform{find(ismex(j,:))});
1060             <span class="keyword">if</span> ~isempty(mexplatforms)
1061                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PLATFORMS'</span>, mexplatforms(1:end-2));
1062                 tpl = parse(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
1063             <span class="keyword">end</span>
1064             
1065             <span class="comment">%- Set description template field</span>
1066             descr = <span class="string">''</span>;
1067             flagsynopcont = 0;
1068             flag_seealso  = 0;
1069             <span class="keyword">while</span> 1
1070                 tline = fgets(fid2);
1071                 <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1072                 tline = <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(fliplr(deblank(fliplr(tline))));
1073                 <span class="comment">%- Synopsis line</span>
1074                 <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'function'</span>,tline))
1075                     <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1076                         flagsynopcont = 1;
1077                     <span class="keyword">end</span>
1078                 <span class="comment">%- H1 line and description</span>
1079                 <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'%'</span>,tline))
1080                     <span class="comment">%- Hypertext links on the &quot;See also&quot; line</span>
1081                     ind = findstr(lower(tline),<span class="string">'see also'</span>);
1082                     <span class="keyword">if</span> ~isempty(ind) | flag_seealso
1083                         <span class="comment">%- &quot;See also&quot; only in files in the same directory</span>
1084                         indsamedir = find(strcmp(mdirs{j},mdirs));
1085                         hrefnames = {names{indsamedir}};
1086                         r = deblank(tline);
1087                         flag_seealso = 1; <span class="comment">%(r(end) == ',');</span>
1088                         tline = <span class="string">''</span>;
1089                         <span class="keyword">while</span> 1
1090                             [t,r,q] = strtok(r,sprintf(<span class="string">' \t\n\r.,;%%'</span>));
1091                             tline = [tline q];
1092                             <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>;
1093                             ii = strcmpi(hrefnames,t);
1094                             <span class="keyword">if</span> any(ii)
1095                                 jj = find(ii);
1096                                 tline = [tline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1097                                     [hrefnames{jj(1)} options.extension],<span class="keyword">...</span>
1098                                     synopsis{indsamedir(jj(1))},t)];
1099                             <span class="keyword">else</span>
1100                                 tline = [tline t];
1101                             <span class="keyword">end</span>
1102                         <span class="keyword">end</span>
1103                         tline = sprintf(<span class="string">'%s\n'</span>,tline);
1104                     <span class="keyword">end</span>
1105                     descr = [descr tline(2:end)];
1106                 <span class="keyword">elseif</span> isempty(tline)
1107                     <span class="keyword">if</span> ~isempty(descr), <span class="keyword">break</span>, <span class="keyword">end</span>;
1108                 <span class="keyword">else</span>
1109                     <span class="keyword">if</span> flagsynopcont
1110                         <span class="keyword">if</span> isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1111                             flagsynopcont = 0;
1112                         <span class="keyword">end</span>
1113                     <span class="keyword">else</span>
1114                         <span class="keyword">break</span>;
1115                     <span class="keyword">end</span>
1116                 <span class="keyword">end</span>
1117             <span class="keyword">end</span>
1118             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DESCRIPTION'</span>,<span class="keyword">...</span>
1119                 <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(descr,options.tabs));
1120             
1121             <span class="comment">%- Set cross-references template fields:</span>
1122             <span class="comment">%  Function called</span>
1123             ind = find(hrefs(j,:) == 1);
1124             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalls'</span>,<span class="string">''</span>);
1125             <span class="keyword">for</span> k=1:length(ind)
1126                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1127                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1128                         [names{ind(k)} options.extension]);
1129                 <span class="keyword">else</span>
1130                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1131                               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}), <span class="keyword">...</span>
1132                                          mdirs{ind(k)}, <span class="keyword">...</span>
1133                                        [names{ind(k)} options.extension]));
1134                 <span class="keyword">end</span>
1135                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALL'</span>,   synopsis{ind(k)});
1136                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALL'</span>,   names{ind(k)});
1137                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALL'</span>, h1line{ind(k)});
1138                 tpl = parse(tpl,<span class="string">'crossrefcalls'</span>,<span class="string">'crossrefcall'</span>,1);
1139             <span class="keyword">end</span>
1140             <span class="comment">%  Callers</span>
1141             ind = find(hrefs(:,j) == 1);
1142             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalleds'</span>,<span class="string">''</span>);
1143             <span class="keyword">for</span> k=1:length(ind)
1144                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1145                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1146                         [names{ind(k)} options.extension]);
1147                 <span class="keyword">else</span>
1148                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1149                         <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1150                             mdirs{ind(k)}, <span class="keyword">...</span>
1151                             [names{ind(k)} options.extension]));
1152                 <span class="keyword">end</span>
1153                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALLED'</span>,   synopsis{ind(k)});
1154                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALLED'</span>,   names{ind(k)});
1155                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALLED'</span>, h1line{ind(k)});
1156                 tpl = parse(tpl,<span class="string">'crossrefcalleds'</span>,<span class="string">'crossrefcalled'</span>,1);
1157             <span class="keyword">end</span>
1158             
1159             <span class="comment">%- Set subfunction template field</span>
1160             tpl = set(tpl,<span class="string">'var'</span>,{<span class="string">'subf'</span> <span class="string">'onesubf'</span>},{<span class="string">''</span> <span class="string">''</span>});
1161             <span class="keyword">if</span> ~isempty(subroutine{j}) &amp; options.source
1162                 <span class="keyword">for</span> k=1:length(subroutine{j})
1163                     tpl = set(tpl, <span class="string">'var'</span>, <span class="string">'L_SUB'</span>, [<span class="string">'#_sub'</span> num2str(k)]);
1164                     tpl = set(tpl, <span class="string">'var'</span>, <span class="string">'SUB'</span>,   subroutine{j}{k});
1165                     tpl = parse(tpl, <span class="string">'onesubf'</span>, <span class="string">'onesubfunction'</span>,1);
1166                 <span class="keyword">end</span>
1167                 tpl = parse(tpl,<span class="string">'subf'</span>,<span class="string">'subfunction'</span>);
1168             <span class="keyword">end</span>
1169             subname = <a href="#_sub5" class="code" title="subfunction name = extractname(synopsis)">extractname</a>(subroutine{j});
1170             
1171             <span class="comment">%- Link to M-file (for download)</span>
1172             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'downloads'</span>,<span class="string">''</span>);
1173             <span class="keyword">if</span> options.download
1174                 tpl = parse(tpl,<span class="string">'downloads'</span>,<span class="string">'download'</span>,1);
1175             <span class="keyword">end</span>
1176             
1177             <span class="comment">%- Display source code with cross-references</span>
1178             <span class="keyword">if</span> options.source &amp; ~strcmpi(names{j},<span class="string">'contents'</span>)
1179                 fseek(fid2,0,-1);
1180                 it = 1;
1181                 matlabsource = <span class="string">''</span>;
1182                 nbsubroutine = 1;
1183                 <span class="comment">%- Get href function names of this file</span>
1184                 indhrefnames = find(hrefs(j,:) == 1);
1185                 hrefnames = {names{indhrefnames}};
1186                 <span class="comment">%- Loop over lines</span>
1187                 <span class="keyword">while</span> 1
1188                     tline = fgetl(fid2);
1189                     <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1190                     myline = <span class="string">''</span>;
1191                     splitc = splitcode(<a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(tline));
1192                     <span class="keyword">for</span> k=1:length(splitc)
1193                         <span class="keyword">if</span> isempty(splitc{k})
1194                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'function'</span>, <span class="keyword">...</span>
1195                                         fliplr(deblank(fliplr(splitc{k})))))
1196                             <span class="keyword">if</span> isspace(splitc{k}(1))
1197                                 nbs = find(diff(isspace(splitc{k}))==-1);
1198                                 myline = [myline splitc{k}(1:nbs(1))];
1199                                 splitc{k} = splitc{k}(nbs(1)+1:end);
1200                             <span class="keyword">end</span>
1201                             <span class="comment">%- Subfunctions definition</span>
1202                             myline = [myline <span class="keyword">...</span>
1203                                 sprintf(tpl_mfile_aname,<span class="keyword">...</span>
1204                                     [<span class="string">'_sub'</span> num2str(nbsubroutine-1)],splitc{k})];
1205                             nbsubroutine = nbsubroutine + 1;
1206                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">''''</span>
1207                             myline = [myline <span class="keyword">...</span>
1208                                 sprintf(tpl_mfile_string,splitc{k})];
1209                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">'%'</span>
1210                             myline = [myline <span class="keyword">...</span>
1211                                 sprintf(tpl_mfile_comment,deblank(splitc{k}))];
1212                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'...'</span>,splitc{k}))
1213                             myline = [myline sprintf(tpl_mfile_keyword,<span class="string">'...'</span>)];
1214                             <span class="keyword">if</span> ~isempty(splitc{k}(4:end))
1215                                 myline = [myline <span class="keyword">...</span>
1216                                     sprintf(tpl_mfile_comment,splitc{k}(4:end))];
1217                             <span class="keyword">end</span>
1218                         <span class="keyword">else</span>
1219                             <span class="comment">%- Look for keywords</span>
1220                             r = splitc{k};
1221                             <span class="keyword">while</span> 1
1222                                 [t,r,q] = strtok(r,strtok_delim);
1223                                 myline = [myline q];
1224                                 <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>;
1225                                 <span class="comment">%- Highlight Matlab keywords &amp;</span>
1226                                 <span class="comment">%  cross-references on known functions</span>
1227                                 <span class="keyword">if</span> options.syntaxHighlighting &amp; <span class="keyword">...</span>
1228                                         any(strcmp(matlabKeywords,t))
1229                                     <span class="keyword">if</span> strcmp(<span class="string">'end'</span>,t)
1230                                         rr = fliplr(deblank(fliplr(r)));
1231                                         icomma = strmatch(<span class="string">','</span>,rr);
1232                                         isemicolon = strmatch(<span class="string">';'</span>,rr);
1233                                         <span class="keyword">if</span> ~(isempty(rr) | ~isempty([icomma isemicolon]))
1234                                             myline = [myline t];
1235                                         <span class="keyword">else</span>
1236                                             myline = [myline sprintf(tpl_mfile_keyword,t)];
1237                                         <span class="keyword">end</span>
1238                                     <span class="keyword">else</span>
1239                                         myline = [myline sprintf(tpl_mfile_keyword,t)];
1240                                     <span class="keyword">end</span>
1241                                 <span class="keyword">elseif</span> any(strcmp(hrefnames,t))
1242                                     indt = indhrefnames(logical(strcmp(hrefnames,t)));
1243                                     flink = [t options.extension];
1244                                     ii = ismember({mdirs{indt}},mdirs{j});
1245                                     <span class="keyword">if</span> ~any(ii)
1246                                         <span class="comment">% take the first one...</span>
1247                                         flink = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1248                                                           mdirs{indt(1)}, flink);
1249                                     <span class="keyword">else</span>
1250                                         indt = indt(logical(ii));
1251                                     <span class="keyword">end</span>
1252                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1253                                               flink, synopsis{indt(1)}, t)];
1254                                 <span class="keyword">elseif</span> any(strcmp(subname,t))
1255                                     ii = find(strcmp(subname,t));
1256                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1257                                         [<span class="string">'#_sub'</span> num2str(ii)],<span class="keyword">...</span>
1258                                         [<span class="string">'sub'</span> subroutine{j}{ii}],t)];
1259                                 <span class="keyword">else</span>
1260                                     myline = [myline t];
1261                                 <span class="keyword">end</span>
1262                             <span class="keyword">end</span>
1263                         <span class="keyword">end</span>
1264                     <span class="keyword">end</span>
1265                     matlabsource = [matlabsource sprintf(tpl_mfile_line,it,myline)];
1266                     it = it + 1;
1267                 <span class="keyword">end</span>
1268                 nblinetot = nblinetot + it - 1;
1269                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SOURCECODE'</span>,<span class="keyword">...</span>
1270                           <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(matlabsource,options.tabs));
1271                 tpl = parse(tpl,<span class="string">'thesource'</span>,<span class="string">'source'</span>);
1272             <span class="keyword">else</span>
1273                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'thesource'</span>,<span class="string">''</span>);
1274             <span class="keyword">end</span>
1275             tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MFILE'</span>);
1276             fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
1277             fclose(fid2);
1278             fclose(fid);
1279         <span class="keyword">end</span>
1280     <span class="keyword">end</span>
1281 <span class="keyword">end</span>
1282 
1283 <span class="comment">%-------------------------------------------------------------------------------</span>
1284 <span class="comment">%- Display Statistics</span>
1285 <span class="comment">%-------------------------------------------------------------------------------</span>
1286 <span class="keyword">if</span> options.verbose
1287     prnbline = <span class="string">''</span>;
1288     <span class="keyword">if</span> options.source
1289         prnbline = sprintf(<span class="string">'(%d lines) '</span>, nblinetot);
1290     <span class="keyword">end</span>
1291     fprintf(<span class="string">'Stats: %d M-files %sin %d directories documented in %d s.\n'</span>, <span class="keyword">...</span>
1292             length(mfiles), prnbline, length(mdir), round(etime(clock,t0)));
1293 <span class="keyword">end</span>
1294 
1295 <span class="comment">%===============================================================================</span>
1296 <a name="_sub1" href="#_subfunctions" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)</a>
1297     <span class="comment">%- Extract M-files from a list of directories and/or M-files</span>
1298 
1299     <span class="keyword">if</span> nargin &lt; 4, ignoredDir = {}; <span class="keyword">end</span>
1300     <span class="keyword">for</span> i=1:length(mdirs)
1301         currentdir = fullfile(pwd, mdirs{i});
1302         <span class="keyword">if</span> exist(currentdir) == 2 <span class="comment">% M-file</span>
1303             mfiles{end+1} = mdirs{i};
1304         <span class="keyword">elseif</span> exist(currentdir) == 7 <span class="comment">% Directory</span>
1305             d = dir(fullfile(currentdir, <span class="string">'*.m'</span>));
1306             d = {d(~[d.isdir]).name};
1307             <span class="keyword">for</span> j=1:length(d)
1308                 <span class="comment">%- don't take care of files containing ','</span>
1309                 <span class="comment">%  probably a sccs file...</span>
1310                 <span class="keyword">if</span> isempty(findstr(<span class="string">','</span>,d{j}))
1311                     mfiles{end+1} = fullfile(mdirs{i}, d{j});
1312                 <span class="keyword">end</span>
1313             <span class="keyword">end</span>
1314             <span class="keyword">if</span> recursive
1315                 d = dir(currentdir);
1316                 d = {d([d.isdir]).name};
1317                 d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> ignoredDir{:}})}};
1318                 <span class="keyword">for</span> j=1:length(d)
1319                     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)">getmfiles</a>(cellstr(fullfile(mdirs{i},d{j})), <span class="keyword">...</span>
1320                                        mfiles, recursive, ignoredDir);
1321                 <span class="keyword">end</span>
1322             <span class="keyword">end</span>
1323         <span class="keyword">else</span>
1324             fprintf(<span class="string">'Warning: Unprocessed file %s.\n'</span>,mdirs{i});
1325             <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'/'</span>,mdirs{i})) | findstr(<span class="string">':'</span>,mdirs{i})
1326                 fprintf(<span class="string">'         Use relative paths in ''mfiles'' option\n'</span>);
1327             <span class="keyword">end</span> 
1328         <span class="keyword">end</span>
1329     <span class="keyword">end</span>
1330 
1331 <span class="comment">%===============================================================================</span>
1332 <a name="_sub2" href="#_subfunctions" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a>
1333     <span class="comment">%- Draw a dependency graph in a PNG image using &lt;dot&gt; from GraphViz</span>
1334 
1335     <span class="keyword">if</span> nargin == 4, opt = <span class="string">''</span>; <span class="keyword">end</span>
1336     <span class="keyword">try</span>
1337         <span class="comment">%- See &lt;http://www.graphviz.org/&gt;</span>
1338         <span class="comment">%  &lt;dot&gt; must be in your system path, see M2HTML FAQ:</span>
1339         <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/faq.php&gt;</span>
1340 
1341         eval([<span class="string">'!&quot;'</span> dotexec <span class="string">'&quot; '</span> opt <span class="string">' -Tcmap -Tpng &quot;'</span> mdotfile <span class="keyword">...</span>
1342               <span class="string">'&quot; -o &quot;'</span> mapfile <span class="keyword">...</span><span class="comment"> </span>
1343               <span class="string">'&quot; -o &quot;'</span> pngfile <span class="string">'&quot;'</span>]);
1344         <span class="comment">% use '!' rather than 'system' for backward compability with Matlab 5.3</span>
1345     <span class="keyword">catch</span> <span class="comment">% use of '!' prevents errors to be catched...</span>
1346         fprintf(<span class="string">'&lt;dot&gt; failed.'</span>);
1347     <span class="keyword">end</span>
1348     
1349 <span class="comment">%===============================================================================</span>
1350 <a name="_sub3" href="#_subfunctions" class="code">function s = backtomaster(mdir)</a>
1351     <span class="comment">%- Provide filesystem path to go back to the root folder</span>
1352 
1353     ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir);
1354     s = repmat(<span class="string">'../'</span>,1,length(ldir));
1355     
1356 <span class="comment">%===============================================================================</span>
1357 <a name="_sub4" href="#_subfunctions" class="code">function ldir = splitpath(p)</a>
1358     <span class="comment">%- Split a filesystem path into parts using filesep as separator</span>
1359 
1360     ldir = {};
1361     p = deblank(p);
1362     <span class="keyword">while</span> 1
1363         [t,p] = strtok(p,filesep);
1364         <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>; <span class="keyword">end</span>
1365         <span class="keyword">if</span> ~strcmp(t,<span class="string">'.'</span>)
1366             ldir{end+1} = t;
1367         <span class="keyword">end</span>
1368     <span class="keyword">end</span>
1369     <span class="keyword">if</span> isempty(ldir)
1370         ldir{1} = <span class="string">'.'</span>; <span class="comment">% should be removed</span>
1371     <span class="keyword">end</span>
1372 
1373 <span class="comment">%===============================================================================</span>
1374 <a name="_sub5" href="#_subfunctions" class="code">function name = extractname(synopsis)</a>
1375     <span class="comment">%- Extract function name in a synopsis</span>
1376 
1377     <span class="keyword">if</span> ischar(synopsis), synopsis = {synopsis}; <span class="keyword">end</span>
1378     name = cell(size(synopsis));
1379     <span class="keyword">for</span> i=1:length(synopsis)
1380         ind = findstr(synopsis{i},<span class="string">'='</span>);
1381         <span class="keyword">if</span> isempty(ind)
1382             ind = findstr(synopsis{i},<span class="string">'function'</span>);
1383             s = synopsis{i}(ind(1)+8:end);
1384         <span class="keyword">else</span>
1385             s = synopsis{i}(ind(1)+1:end);
1386         <span class="keyword">end</span>
1387         name{i} = strtok(s,[9:13 32 40]); <span class="comment">% white space characters and '('</span>
1388     <span class="keyword">end</span>
1389     <span class="keyword">if</span> length(name) == 1, name = name{1}; <span class="keyword">end</span>
1390 
1391 <span class="comment">%===============================================================================</span>
1392 <a name="_sub6" href="#_subfunctions" class="code">function f = fullurl(varargin)</a>
1393     <span class="comment">%- Build full url from parts (using '/' and not filesep)</span>
1394     
1395     f = strrep(fullfile(varargin{:}),<span class="string">'\'</span>,<span class="string">'/'</span>);
1396 
1397 <span class="comment">%===============================================================================</span>
1398 <a name="_sub7" href="#_subfunctions" class="code">function str = escapeblank(str)</a>
1399     <span class="comment">%- Escape white spaces using '\'</span>
1400     
1401     str = deblank(fliplr(deblank(fliplr(str))));
1402     str = strrep(str,<span class="string">' '</span>,<span class="string">'\ '</span>);
1403 
1404 <span class="comment">%===============================================================================</span>
1405 <a name="_sub8" href="#_subfunctions" class="code">function str = entity(str)</a>
1406     <span class="comment">%- Escape HTML special characters</span>
1407     <span class="comment">%- See http://www.w3.org/TR/html4/charset.html#h-5.3.2</span>
1408     
1409     str = strrep(str,<span class="string">'&amp;'</span>,<span class="string">'&amp;amp;'</span>);
1410     str = strrep(str,<span class="string">'&lt;'</span>,<span class="string">'&amp;lt;'</span>);
1411     str = strrep(str,<span class="string">'&gt;'</span>,<span class="string">'&amp;gt;'</span>);
1412     str = strrep(str,<span class="string">'&quot;'</span>,<span class="string">'&amp;quot;'</span>);
1413     
1414 <span class="comment">%===============================================================================</span>
1415 <a name="_sub9" href="#_subfunctions" class="code">function str = horztab(str,n)</a>
1416     <span class="comment">%- For browsers, the horizontal tab character is the smallest non-zero</span>
1417     <span class="comment">%- number of spaces necessary to line characters up along tab stops that are</span>
1418     <span class="comment">%- every 8 characters: behaviour obtained when n = 0.</span>
1419     
1420     <span class="keyword">if</span> n &gt; 0
1421         str = strrep(str,sprintf(<span class="string">'\t'</span>),blanks(n));
1422     <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 29-Oct-2019 21:04:54 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>